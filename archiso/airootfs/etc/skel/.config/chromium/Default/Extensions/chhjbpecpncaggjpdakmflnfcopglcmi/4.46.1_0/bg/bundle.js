/*! For license information please see bundle.js.LICENSE.txt */
var source=function(e){function t(t){for(var r,o,s=t[0],c=t[1],u=t[2],h=0,d=[];h<s.length;h++)o=s[h],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&d.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);d.length;)d.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={1:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window.webpackJsonpsource=window.webpackJsonpsource||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;return a.push([274,0]),n()}([,,function(e,t,n){"use strict";var r=n(12),i=n.n(r),a=n(73),o=class extends a.a{constructor(){super();const e=this;let t={},n={};function r(t){if(t){let n={action:"event",data:{name:e.TABCHANGED,tabId:t.id,url:t.url}};t.url&&0!==t.url.indexOf("chrome://")&&i.a.tabs.sendMessage(t.id,n).catch(e=>{}),e.fireEvent(e.TABCHANGED,n.data)}}this.navigate=function(t,r=function(){}){let a=new Promise(r=>{"string"==typeof t&&(t={url:t,tabId:e.NEWTAB});let a=t.tabId||e.CURRENTTAB,o={url:t.url};switch(a){case e.NEWTAB:o.active=!0,void 0!==t.active&&(o.active=t.active),void 0!==t.pinned&&(o.pinned=t.pinned),i.a.tabs.create(o).then(r);break;case e.BACKGROUNDTAB:o.active=!1,void 0!==t.pinned&&(o.pinned=t.pinned),i.a.tabs.create(o).then(r);break;case e.CURRENTTAB:e.redirect(t.url).then(r);break;case e.NEWWINDOW:o.focused=!0,i.a.windows.create(o).then(r);break;case e.ALLTABS:i.a.windows.getAll({populate:!0}).then(e=>{e.forEach((function(e){e.tabs.forEach((function(e){i.a.tabs.update(e.id,o)}))})),r()});break;default:i.a.tabs.get(t.tabId).then(e=>{!i.a.runtime.lastError&&e?(i.a.tabs.update(t.tabId,o).then(r),delete n[t.tabId]):n[t.tabId]=t})}});return a.then(r),a},this.redirect=function(e,t=function(){}){var n=new Promise((function(t){let n="string"==typeof e?e:e.url;i.a.tabs.query({active:!0,currentWindow:!0}).then(e=>{e.length>0&&i.a.tabs.update(e[0].id,{url:n}),t(e[0])})}));return n.then(t,t),n},this.on=this.attachEvent=function(e,n){t[e]||(t[e]=[]),t[e].push(n)},this.detachEvent=function(e,n){if(t[e])for(var r=t[e].length-1;r>=0;r--)t[e][r]&&n===t[e][r]&&(delete t[e][r],t[e][r]=null,t[e].splice(r,1))},this.emit=this.fireEvent=function(e,n){t[e]&&t[e].forEach((function(e){e&&e(n)}))},this.closeTab=this.removeTab=function(e){i.a.tabs.remove("number"==typeof e?e:e.id)};var a=[];i.a.extension.getBackgroundPage()===window&&(i.a.tabs.onActivated.addListener((function(t){n[t.tabId]&&e.navigate(n[t.tabId]),i.a.tabs.get(t.tabId).then(e=>{i.a.runtime.lastError||r({url:e&&e.url?e.url:"",id:t.tabId})})})),i.a.windows.onFocusChanged.addListener((function(e){e!==i.a.windows.WINDOW_ID_NONE&&i.a.tabs.query({windowId:e,active:!0}).then(e=>{e&&r(e.pop())})})),i.a.tabs.onRemoved.addListener((function(t){a.splice(t,1),e.fireEvent(e.TABCLOSED,{name:e.TABCLOSED,tabId:t,url:a[t]&&a[t].url?a[t].url:""})})),i.a.tabs.onUpdated.addListener((function(e,t){t.url&&(a[e]={url:t.url})})),i.a.webNavigation.onDOMContentLoaded.addListener((function(t){0===t.frameId&&i.a.tabs.get(t.tabId).then(n=>{!i.a.runtime.lastError&&n&&e.fireEvent(e.DOCUMENTCOMPLETE,{name:e.DOCUMENTCOMPLETE,tabId:t.tabId,url:t.url,active:n.active})}).catch(()=>{})})),i.a.webRequest.onBeforeRequest.addListener((function(t){0===t.frameId&&t.url&&e.fireEvent(e.BEFORENAVIGATE,{name:e.BEFORENAVIGATE,tabId:t.tabId,url:t.url})}),{urls:["<all_urls>"],types:["main_frame"]}))}};function s(e){const t=this;let n=localStorage.getItem("id");var r={};const a=i.a.runtime.getManifest(),o={name:a.name,version:a.version};function s(e){return i.a.windows.getAll({populate:!0}).then(t=>new Promise(n=>{t.forEach(t=>{t.tabs.forEach(t=>{t.id&&-1===t.url.indexOf("chrome://")&&-1===t.url.indexOf("about:")&&i.a.tabs.sendMessage(t.id,e).then(n).catch(e=>{})})})}))}a.options_page&&(o.optionsPage=a.options_page),function(){for(let n=localStorage.length-1;n>=0;n--){var e=localStorage.key(n);if("id"!==e){try{t.setItem(e,JSON.parse(localStorage.getItem(e)))}catch(e){}localStorage.removeItem(e)}}}(),i.a.runtime.onMessage.addListener((function(n,a){return new Promise(o=>{let c,u;switch(n.action){case"event":u=n.name,c={name:u,url:a.tab?a.tab.url:a.url},a.tab&&(c.tabId=a.tab.id),n.data&&(c.data=n.data.data),n.data&&n.data.tabId?(c.action="event",n.data.tabId===e.browser.ALLTABS?s(c).then(o):i.a.tabs.sendMessage(n.data.tabId,c).then(o)):r[u]&&r[u].forEach(e=>{2===e.length?e.call(t,c,o):(e.call(t,c),o())});break;case"ci_browser_navigate":e.browser.navigate(n).then(o);break;case"ci_browser_redirect":e.browser.redirect(n).then(o);break;case"ci_extension_getSettings":o({name:t.name,version:t.version})}})})),i.a.runtime.onMessageExternal&&i.a.runtime.onMessageExternal.addListener((function(e,n){return new Promise(i=>{if("event"===e.action&&n.id){let a=e.name,o={name:a,url:n.tab?n.tab.url:n.url,extensionId:n.id};e.data&&(o.data=e.data.data),n.tab&&(o.tabId=n.tab.id),r[a]?r[a].forEach(e=>{2===e.length?e.call(t,o,i):(e.call(t,o),i())}):i()}else i()})})),this.on=this.attachEvent=function(e,t){r[e]||(r[e]=[]),r[e].push(t)},this.detachEvent=function(e,t){if(r[e])for(var n=r[e].length-1;n>=0;n--)r[e][n]&&t===r[e][n]&&(delete r[e][n],r[e][n]=null,r[e].splice(n,1))},this.emit=this.fireEvent=function(n,a={},o=function(){}){let c={action:"event",name:n,data:a};var u=new Promise((function(o){if(a.extensionId)i.a.runtime.sendMessage(a.extensionId,c).then(o);else if(a.tabId===e.browser.ALLTABS)s(c).then(o);else if(u=a.tabId,!isNaN(parseInt(u,10))&&isFinite(u)&&a.tabId>=0)i.a.tabs.sendMessage(a.tabId,c).then(o).catch(e=>{});else if(t.getBackgroundPage()!==window){t.getBackgroundPage().framework.extension.fireEvent(n,a).then(o)}else i.a.tabs.query({active:!0,currentWindow:!0}).then(e=>{e&&e[0]&&e[0].id&&-1===e[0].url.indexOf("chrome://")&&i.a.tabs.sendMessage(e[0].id,c).then(o).catch(e=>{})});var u;r[n]&&r[n].forEach((function(e){e.call(t,a,o)}))}));return u.then(o,o),u},this.getId=function(e){e(n)},this.getItem=function(e,t=function(){}){var n=new Promise((function(t){"string"==typeof e||"object"==typeof e&&e.length>0?i.a.storage.local.get(e).then(n=>{t("string"==typeof e?n?n[e]:null:n)}):t(null)}));return n.then(t),n},this.setItem=function(e,t){if("string"==typeof e)if(void 0===t)i.a.storage.local.remove(e);else{var n={};n[e]=t,i.a.storage.local.set(n)}else"object"==typeof e&&i.a.storage.local.set(e)},this.getBackgroundPage=function(){return i.a.extension.getBackgroundPage()},this.getURL=function(e){return i.a.extension.getURL(e)},n||(n=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}(),localStorage.setItem("id",n),r.Installed&&r.Installed.forEach((function(e){e({id:n})}))),t.__defineGetter__("name",(function(){return o.name})),t.__defineGetter__("version",(function(){return o.version})),t.__defineGetter__("optionsPage",(function(){return o.optionsPage}))}function c(){const e="ButtonClick";let t=null,n=null,r=null,a=null;const o=i.a.runtime.getManifest();function s(e){t.show(e),n&&t.setPopup({tabId:e,popup:n}),r&&t.setIcon({tabId:e,path:r}),a&&t.setTitle({tabId:e,title:a})}o.page_action?(n=o.page_action.default_popup,r=o.page_action.default_icon,a=o.page_action.default_title,t=i.a.pageAction,i.a.tabs.query({active:!0,windowId:i.a.windows.WINDOW_ID_CURRENT}).then(e=>{t.show(e[0].id)}),i.a.tabs.onUpdated.addListener(s),i.a.tabs.onActivated.addListener((function(e){s(e.tabId)}))):o.browser_action&&(t=i.a.browserAction);let c=!1;var u=[];function l(t){for(var n=0;n<u.length;n++)try{u[n]({tabId:t.id,url:t.url,name:e})}catch(e){}}this.attachEvent=function(n,r){n===e&&(c||(t&&t.onClicked.addListener(l),c=!0),u.push(r))},this.detachEvent=function(n,r){if(n===e){for(var i=0;i<u.length;i++)u[i]===r&&(u.splice(i,1),i--);0===u.length&&(c=!1,t&&t.onClicked.removeListener(l))}},this.setIcon=function(e){t&&(r=e,t===i.a.browserAction?t.setIcon({path:e}):i.a.tabs.query({active:!0,windowId:i.a.windows.WINDOW_ID_CURRENT}).then(e=>{t.setIcon({tabId:e[0].id,path:r})}))},this.setPopup=function(e){t&&(n=e?e.url:"",t===i.a.browserAction?t.setPopup({popup:n}):i.a.tabs.query({active:!0,windowId:i.a.windows.WINDOW_ID_CURRENT}).then(e=>{t.setPopup({tabId:e[0].id,popup:n})}))},this.setTitle=function(e){t&&(a=e,t===i.a.browserAction?t.setTitle({title:a}):i.a.tabs.query({active:!0,windowId:i.a.windows.WINDOW_ID_CURRENT}).then(e=>{t.setTitle({tabId:e[0].id,title:a})}))},this.setBadgeText=function(e){"string"!=typeof e&&(e=e.toString()),t&&t.setBadgeText({text:e.toString()})},this.setBadgeBackgroundColor=function(e){t&&t.setBadgeBackgroundColor({color:function(e){var t=/rgb\((\d+), (\d+), (\d+)\)/;if(t.test(e)){var n=t.exec(e);return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),255]}var r=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return[r>>16,(65280&r)>>8,255&r,255]}(e)})},this.setBadgeColor=function(){},this.CLICK=e}function u(e){this.open=function(){if(i.a.runtime.openOptionsPage)i.a.runtime.openOptionsPage();else{let t=e.extension.optionsPage;t&&e.browser.navigate({url:t,tabId:e.browser.NEWTAB})}}}t.a=new class{constructor(){this.browser=new o(this),this.extension=new s(this),this.ui={button:new c(this),settings:new u(this)},this.extension.getBackgroundPage()===window&&(window.framework=this)}}},,,,,,function(e,t,n){"use strict";n.d(t,"i",(function(){return c})),n.d(t,"k",(function(){return u})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return h})),n.d(t,"b",(function(){return d})),n.d(t,"g",(function(){return f})),n.d(t,"e",(function(){return p})),n.d(t,"h",(function(){return g}));var r=n(0),i=n(2),a=n(7),o=(n(26),n(23));function s(e,t,n){return"string"==typeof e&&e.startsWith("/")&&(n&&n.search(/pattern/i)<0||!n)?t?u(t+e):e.search(/\.(png|jpg|jpeg|gif|svg)$/)>0?u(a.a.CDN+e):u(a.a.BASE+e):"object"==typeof e&&null!==e?c(e,t):e}function c(e,t){return r.default.isArray(e)?r.default.map(e,(e,n)=>s(e,t,n)):r.default.mapObject(e,(e,n)=>s(e,t,n))}function u(e){return s(e).replace(/%domain%?/g,a.a.domain).replace(/%api%?/g,a.a.api).replace(/%member_api%?/g,a.a.member_api).replace(/%CDN%?/g,a.a.CDN).replace(/%version%?/g,i.a.extension.version).replace(/%browser%?/g,i.a.browser.name.toLowerCase().replace("webkitedge","edge")).replace(/%installVersion%?/g,window.installVersion||"").replace(/%userid%?/g,window.toolbarId).replace(/%toolbarId%?/g,window.toolbarId).replace(/%targetSet%?/g,EBATES&&EBATES.member&&EBATES.member.get("targetSet")||"").replace(/%uid%?/g,EBATES&&EBATES.member&&EBATES.member.id||"").replace(/%ebtoken%?/g,EBATES&&EBATES.ebToken||"").replace(/AutoLoginID=%autologinid%?/g,"ebtoken=".concat(EBATES&&EBATES.ebToken||"")).replace(/%autologinid%?/g,"")}function l(e){let t=e.match(/\.(.*)\./);try{if(t&&t.length>0){let e=t.pop();return JSON.parse(atob(e))}}catch(e){}return null}function h(e,t,n){var r=n&&n.lexicographical,i=n&&n.zeroExtend,a=e.split("."),o=t.split(".");function s(e){return(r?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!a.every(s)||!o.every(s))return NaN;if(i){for(;a.length<o.length;)a.push("0");for(;o.length<a.length;)o.push("0")}r||(a=a.map(Number),o=o.map(Number));for(var c=0;c<a.length;++c){if(o.length===c)return 1;if(a[c]!==o[c])return a[c]>o[c]?1:-1}return a.length!==o.length?-1:0}function d(e,t){let n=e=>e.range?e.range.high:e.amount;return(e=n(e))>(t=n(t))?1:e===t?0:-1}function f(e){return!!e&&/(?:ebates\.(?:com|int)\/|\/\/(?!global).*\.rakuten\.(?:com|int)\/(?!shop\/))/i.test(e)}function p(e,t){return new Promise((n,r)=>{browser&&browser.cookies?"string"==typeof t?browser.cookies.getAll({domain:e,name:t}).then(e=>{e.length>0?n(e[0].value):r()}):browser.cookies.getAll({domain:e}).then(e=>{let i=e.reduce((e,n)=>((t===n.name||t.includes(n.name))&&(e[n.name]=n.value),e),{});var a;a=i,0===Object.keys(a).length&&a.constructor===Object?r():n(i)}):r()})}function g({url:e,width:t=650,height:n=400}){if(i.a.browser.isSafari)i.a.browser.navigate(e);else{let r=Math.floor((screen.availWidth-t)/2),i=Math.floor((screen.availHeight-n)/2);browser.windows.create({type:"popup",height:n,width:t,top:r,left:i,url:e})}}n.d(t,"f",(function(){return o.c})),n.d(t,"j",(function(){return o.e})),n.d(t,"a",(function(){return o.a}))},function(e,t,n){"use strict";n.d(t,"g",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return f})),n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return m})),n.d(t,"e",(function(){return E})),n.d(t,"f",(function(){return v}));var r=n(0),i=n(1),a=n.n(i),o=n(5),s=n.n(o),c=n(2),u=n(8),l=s.a.Model.extend({toJSON(){return Object(u.i)(r.default.clone(this.attributes))}});let h={idle:!1,timeout:null,errorAttempt:0,dynamic:!0,MAX_ERROR_ATTEMPT:4,DEFAULT_UPDATE_INTERVAL:9e5,UPDATE_INTERVAL:null,initialize(){this.IDLE_INTERVAL&&c.a.browser.attachEvent(c.a.browser.DOCUMENTCOMPLETE,()=>{this.idle&&(this.idle=!1,this.fetch().catch(()=>{})),window.clearInterval(this.idleInterval),this.idleInterval=window.setInterval(()=>{this.idle=!0,window.clearInterval(this.idleInterval)},this.IDLE_INTERVAL)}),this.once("sync",()=>this._dataSynced=!0)},clearCache(){c.a.extension.setItem(this.key,0),c.a.extension.setItem("".concat(this.key,".nextUpdateTime"),0)},getCache(e){c.a.extension.getItem(this.key,e)},setCache(e){c.a.extension.setItem(this.key,e)},readCache(e){return new Promise((t,n)=>{e.reset||e.force&&!e.cache?t():this.key?this.idle?n():c.a.extension.getItem("".concat(this.key,".nextUpdateTime"),i=>{this.getCache(o=>{if(o&&o.responseText&&(r.default.now()<i||e.cache)){this.etag=o.etag;try{if(!this.length){let e=a.a.parseJSON(o.responseText);this.set(this.parse(e))}}catch(e){return void t()}try{this.trigger("sync",this)}catch(e){}this.dynamic&&(window.clearInterval(this.timeout),this.timeout=window.setInterval(()=>{this.fetch().catch(()=>{})},Math.max(i-r.default.now(),1e3))),n()}else t()})}):this.nextUpdateTime&&r.default.now()<this.nextUpdateTime?n():t()})},sync(e,t,n={}){return"read"===e?new Promise((i,o)=>{this.readCache(n).then(()=>{t.etag&&!n.reset&&(n.beforeSend=function(e){e.setRequestHeader("If-None-Match",t.etag),a.a.ajaxSettings.beforeSend&&a.a.ajaxSettings.beforeSend.apply(this,arguments)});let u=n.success;n.success=function(e,i,o){try{200===o.status&&a.a.parseJSON(o.responseText.toString()),t.errorAttempt=0;let e=t.DEFAULT_UPDATE_INTERVAL;if(t.UPDATE_INTERVAL)e=t.UPDATE_INTERVAL;else{let t=o.getResponseHeader("Cache-Control");if(t&&t.indexOf("max-age=")>=0){let t=1e3*parseInt(o.getResponseHeader("Cache-Control").split("max-age=").pop().split(";").shift(),10);t>0&&(e=t)}}t.etag=o.getResponseHeader("ETag"),t.key&&o.responseText&&t.setCache({etag:t.etag,responseText:o.responseText.toString()}),t.key?c.a.extension.setItem("".concat(t.key,".nextUpdateTime"),r.default.now()+e):t.nextUpdateTime=r.default.now()+e,t.dynamic&&(window.clearInterval(t.timeout),t.timeout=window.setInterval(()=>{t.fetch(r.default.pick(n,"dataType")).catch(()=>{})},e)),u&&200===o.status?u.apply(t,arguments):t.trigger("sync",t)}catch(e){n.error(o)}},n.error=function(e){if(Object(r.default)([401,403]).includes(e.status));else{let e=t.ERROR_UPDATE_INTERVAL||10*Math.pow(3,Math.min(t.MAX_ERROR_ATTEMPT,++t.errorAttempt))*1e3;t.key&&c.a.extension.setItem("".concat(t.key,".nextUpdateTime"),r.default.now()+e),t.dynamic&&(window.clearInterval(t.timeout),t.timeout=window.setInterval(()=>{t.fetch(r.default.pick(n,"dataType")).catch(()=>{})},e))}t.trigger("error",t,e,n)},s.a.Collection.prototype.sync.call(t,e,t,n).then(i,o)},()=>{i()})}):s.a.Collection.prototype.sync.apply(t,arguments)},stop(){window.clearInterval(this.timeout),this.timeout=null,this.etag=null,c.a.extension.setItem("".concat(this.key,".nextUpdateTime"),0)},ready(){return new Promise(e=>{this._dataSynced?e(this):this.once("sync",()=>e(this))})}};var d=s.a.Collection.extend(h),f=s.a.Model.extend(h);function p(e,t,n={}){if("read"===e){if(r.default.now()<t.nextUpdateTime&&!n.reset&&!n.force)return new Promise((function(e){t.trigger("sync",t,null,n),e()}));if(t.loading)return new Promise((function(e){t.once("sync",(function(){t.trigger("sync",t,null,n),e()}))}));c.a.browser.isSafari&&(n.reset||n.force)&&(n.data=r.default.extend({_:r.default.now()},n.data)),n.beforeSend=function(e){t.ETag&&e.setRequestHeader("If-None-Match",t.ETag),(n.reset||n.force)&&(c.a.browser.isLegacyEdge?e.setRequestHeader("strict-transport-security","max-age=0, no-cache"):e.setRequestHeader("Cache-Control","max-age=0, no-cache"),e.setRequestHeader("Pragma","no-cache")),a.a.ajaxSettings.beforeSend&&a.a.ajaxSettings.beforeSend.apply(this,arguments)},t.loading=!0;var i=n.success;n.success=function(e,a,o){t.loading=!1,t.nextUpdateTime=r.default.now()+t.timeout,t.ETag=o.getResponseHeader("ETag"),304!==o.status?i&&i.apply(t,arguments):t.trigger("sync",t,e,n)};var o=n.error;n.error=function(){t.loading=!1,t.nextUpdateTime=r.default.now()+t.errorTimeout,o&&o.apply(t,arguments)}}return s.a.sync.call(this,e,t,n)}var g=s.a.Collection.extend({timeout:6e5,nextUpdateTime:0,initialize(e,t){r.default.extend(this,t)},stop(){this.nextUpdateTime=0},sync:p}),m=l.extend({timeout:18e5,errorTimeout:3e4,loading:!1,nextUpdateTime:0,sync:p}),E=s.a.Collection.extend({sync:(e,t,n)=>new Promise(r=>{"read"===e&&c.a.extension.getItem(t.key,e=>{n.success(e),r()})}),save(){c.a.extension.setItem(this.key,this.toJSON())}}),v=s.a.Model.extend({sync(e,t,n){return new Promise(t=>{"read"===e?c.a.extension.getItem(this.key,e=>{t(),n.success(e)}):"update"!==e&&"create"!==e||(c.a.extension.setItem(this.key,r.default.clone(this.attributes)),t())})}})},,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return g}));var r=n(2),i=n(84),a=n(110),o=n.n(a),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};function c(){return o.a.asString("ddMMyyyy hhmmss",new Date)}function u(e){return Object.keys(e).reduce((t,n)=>(void 0!==e[n]&&t.push("".concat(n,"=").concat(encodeURIComponent(e[n]))),t),[]).join("&")}class l extends Error{constructor(e,t){super(),this.message=e,this.name="InternalLoggingError",this.properties=t}}var h=n(77),d=n.n(h),f=n(32);const p=new i.a("RRkzrctEwtmgt8PgYWkF6SzN62oaAiID",{host:"https://events.engager.ecbsn.com",context:{library:{name:"Toolbar"}},properties:{browser:r.a.browser.name,browser_agent:navigator.userAgent,app_version:r.a.extension.version,application_type:"Toolbar",application_subtype:"Toolbar",client:"toolbar",tenant:"ebates.com",platform:"Toolbar"}});p.identify=async function(e,t){if(this.disabled)return;let n=(new d.a.SHA256).hex(JSON.stringify({userId:e,...t}));if(n!==await r.a.extension.getItem("segment-signature"))return r.a.extension.setItem("segment-signature",n),i.a.prototype.identify.call(this,e,t);p.userId=e},p.track=async function(e){if(!this.disabled||["Install Application"].includes(e))return["Install Application","Update Application"].includes(e)||await this.validateSession(),i.a.prototype.track.apply(this,arguments)},r.a.extension.attachEvent("segment.track",e=>{p.track(e.data.event,e.data.parameters)}),r.a.extension.attachEvent("segment.anonymousId",(e,t)=>{t(p.anonymousId)}),f.a.init({clientToken:"pub5c8940d1d60d49fa1ad47b86997d8ed9",datacenter:"us",forwardErrorsToLogs:!1,sampleRate:100}),f.a.addLoggerGlobalContext("service","rr-button"),window.addEventListener("error",e=>{f.a.logger.error(e.message,{colno:e.colno,error:e.error,filename:e.filename,lineno:e.lineno})}),window.addEventListener("unhandledrejection",(function(e){const t=e.reason;t&&t.message&&f.a.logger.warn(t.message,t)})),r.a.extension.attachEvent("datadogTrack",({data:{type:e,name:t,data:n}})=>{var r,i;null===(r=(i=f.a.logger)[e])||void 0===r||r.call(i,t,n)});const g=new class{constructor(e){this.tenant="ebates.com",this.userId="",this.toolbarId="",this.version="",this.source="Button",this.disabled=!1,this.sessionId=null,this.session_event=null,Object.assign(this,e)}get url(){return"https://bl.ecbsn.com/index.php"}logSessionEvent(e){this.session_event&&(this.log(Object.assign(Object.assign({},e),this.session_event)),this.session_event=null)}log(e,t={}){return s(this,void 0,void 0,(function*(){if(this.disabled&&(!t||!t.force))return;if(e&&!e.event_type)throw new l("Misformatted Event Data",e);const n=()=>{var t;if(!this.sessionId)switch(e.event_type){case"install":case"activation_source":case"non_cb_visit":case"icon_click_non_merchant_open":case"slider_open":case"icon_click_merchant_open":case"serp_with_button_label":case"Nordstrom_no_CB_homepage":case"wiki_click":case"serp_display":case"PriceMagic_click_rec":return this._createSessionID(),this._sendData({event_type:"session_start_event",browser_agent:navigator.userAgent,user_id:this.userId,source:this.source,button_version:this.version,session_id:null!==(t=this.sessionId)&&void 0!==t?t:"",tenant:this.tenant,toolbarId:this.toolbarId,created_ts:c(),ip_address:"null"})}},r=()=>{var t,n;switch(e.event_type){case"activate_slider":case"activate_widget":if(!e.tracking_ticket)return void(this.session_event=Object.assign({session_id:null!==(t=this.sessionId)&&void 0!==t?t:"",toolbarId:this.toolbarId,created_ts:c(),tenant:this.tenant},e));default:return this._sendData(Object.assign({session_id:null!==(n=this.sessionId)&&void 0!==n?n:"",toolbarId:this.toolbarId,user_id:this.userId,created_ts:c(),tenant:this.tenant,source:this.source,button_version:this.version},e))}};try{yield n(),yield r(),yield void e.event_type}catch(e){}}))}closeSession(){this.sessionId&&(this._sendData({event_type:"session_end_event",session_id:this.sessionId,created_ts:c(),tenant:this.tenant}),this.sessionId=null)}_createSessionID(){return this.sessionId="".concat(this.toolbarId,"||").concat(o.a.asString("yyyyMMddhhmmss",new Date)),this.sessionId}_sendData(e){return fetch(this.url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Button-Version":this.version},body:"".concat(u(e),"&")})}}({version:r.a.extension.version,source:"Button",tenant:"ebates.com"})},,function(e,t,n){(function(e){e.EBATES=null}).call(this,n(27))},,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return Ye}));var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function o(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}function s(){var e={};return{get:function(){return e},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},set:function(t){e=t}}}var c=function(e){return Array.isArray(e)},u=function(e){return!Array.isArray(e)&&"object"==typeof e&&null!==e};function l(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];null!=a&&(e=d(e,a,h()))}return e}function h(){if("undefined"!=typeof WeakSet){var e=new WeakSet;return{hasAlreadyBeenSeen:function(t){var n=e.has(t);return n||e.add(t),n}}}var t=[];return{hasAlreadyBeenSeen:function(e){var n=t.indexOf(e)>=0;return n||t.push(e),n}}}function d(e,t,n){if(void 0===t)return e;if(!u(t)&&!c(t))return t;if(!n.hasAlreadyBeenSeen(t)){if(u(t)&&(void 0===e||u(e))){var r=e||{};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=d(r[i],t[i],n));return r}if(c(t)&&(void 0===e||c(e))){(r=e||[]).length=Math.max(r.length,t.length);for(var a=0;a<t.length;a+=1)r[a]=d(r[a],t[a],n);return r}return t}}var f,p,g,m,E;function v(e){return e?(parseInt(e,10)^16*Math.random()>>parseInt(e,10)/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,v)}function _(){}function y(e,t,n){if(null==e)return JSON.stringify(e);var r=[!1,void 0];b(e)&&(r=[!0,e.toJSON],delete e.toJSON);var i,a,o=[!1,void 0];"object"==typeof e&&b(i=Object.getPrototypeOf(e))&&(o=[!0,i.toJSON],delete i.toJSON);try{a=JSON.stringify(e,void 0,n)}catch(e){a="<error: unable to serialize object>"}finally{r[0]&&(e.toJSON=r[1]),o[0]&&(i.toJSON=o[1])}return a}function b(e){return"object"==typeof e&&null!==e&&e.hasOwnProperty("toJSON")}function I(){return void 0===m&&(m=performance.timing.navigationStart),m}function w(e){if(e.origin)return e.origin;var t=e.host.replace(/(:80|:443)$/,"");return e.protocol+"//"+t}function T(e){var t=(e.name||"Error")+": "+e.message;return e.stack.forEach((function(e){var n="?"===e.func?"<anonymous>":e.func,r=e.args&&e.args.length>0?"("+e.args.join(", ")+")":"",i=e.line?":"+e.line:"",a=e.line&&e.column?":"+e.column:"";t+="\n  at "+n+r+" @ "+e.url+i+a})),t}!function(e){e.BEFORE_UNLOAD="beforeunload",e.CLICK="click",e.KEY_DOWN="keydown",e.LOAD="load",e.POP_STATE="popstate",e.SCROLL="scroll",e.TOUCH_START="touchstart",e.VISIBILITY_CHANGE="visibilitychange",e.DOM_CONTENT_LOADED="DOMContentLoaded"}(f||(f={})),function(e){e.DOCUMENT="document",e.XHR="xhr",e.BEACON="beacon",e.FETCH="fetch",e.CSS="css",e.JS="js",e.IMAGE="image",e.FONT="font",e.MEDIA="media",e.OTHER="other"}(p||(p={})),function(e){e.FETCH="fetch",e.XHR="xhr"}(g||(g={})),function(e){e.AGENT="agent",e.CONSOLE="console",e.NETWORK="network",e.SOURCE="source",e.LOGGER="logger",e.CUSTOM="custom"}(E||(E={}));var A=/[^\u0000-\u007F]/,S=function(){function e(e,t,n){void 0===n&&(n=!1),this.endpointUrl=e,this.bytesLimit=t,this.withBatchTime=n}return e.prototype.send=function(e,t){var n=this.withBatchTime?function(e){return e+(-1===e.indexOf("?")?"?":"&")+"batch_time="+(new Date).getTime()}(this.endpointUrl):this.endpointUrl;if(navigator.sendBeacon&&t<this.bytesLimit&&navigator.sendBeacon(n,e))return;var r=new XMLHttpRequest;r.open("POST",n,!0),r.send(e)},e}();var O=function(){function e(e,t,n,r,i,a){void 0===a&&(a=_),this.request=e,this.maxSize=t,this.bytesLimit=n,this.maxMessageSize=r,this.flushTimeout=i,this.beforeUnloadCallback=a,this.pushOnlyBuffer=[],this.upsertBuffer={},this.bufferBytesSize=0,this.bufferMessageCount=0,this.flushOnVisibilityHidden(),this.flushPeriodically()}return e.prototype.add=function(e){this.addOrUpdate(e)},e.prototype.upsert=function(e,t){this.addOrUpdate(e,t)},e.prototype.flush=function(){if(0!==this.bufferMessageCount){var e=o(this.pushOnlyBuffer,(t=this.upsertBuffer,n=[],Object.keys(t).forEach((function(e){n.push(t[e])})),n));this.request.send(e.join("\n"),this.bufferBytesSize),this.pushOnlyBuffer=[],this.upsertBuffer={},this.bufferBytesSize=0,this.bufferMessageCount=0}var t,n},e.prototype.sizeInBytes=function(e){return A.test(e)?void 0!==window.TextEncoder?(new TextEncoder).encode(e).length:new Blob([e]).size:e.length},e.prototype.addOrUpdate=function(e,t){var n=this.process(e),r=n.processedMessage,i=n.messageBytesSize;i>=this.maxMessageSize||(this.hasMessageFor(t)&&this.remove(t),this.willReachedBytesLimitWith(i)&&this.flush(),this.push(r,i,t),this.isFull()&&this.flush())},e.prototype.process=function(e){var t=y(e);return{processedMessage:t,messageBytesSize:this.sizeInBytes(t)}},e.prototype.push=function(e,t,n){this.bufferMessageCount>0&&(this.bufferBytesSize+=1),void 0!==n?this.upsertBuffer[n]=e:this.pushOnlyBuffer.push(e),this.bufferBytesSize+=t,this.bufferMessageCount+=1},e.prototype.remove=function(e){var t=this.upsertBuffer[e];delete this.upsertBuffer[e];var n=this.sizeInBytes(t);this.bufferBytesSize-=n,this.bufferMessageCount-=1,this.bufferMessageCount>0&&(this.bufferBytesSize-=1)},e.prototype.hasMessageFor=function(e){return void 0!==e&&void 0!==this.upsertBuffer[e]},e.prototype.willReachedBytesLimitWith=function(e){return this.bufferBytesSize+e+1>=this.bytesLimit},e.prototype.isFull=function(){return this.bufferMessageCount===this.maxSize||this.bufferBytesSize>=this.bytesLimit},e.prototype.flushPeriodically=function(){var e=this;setTimeout((function(){e.flush(),e.flushPeriodically()}),this.flushTimeout)},e.prototype.flushOnVisibilityHidden=function(){var e=this;navigator.sendBeacon&&(window.addEventListener(f.BEFORE_UNLOAD,F(this.beforeUnloadCallback)),document.addEventListener(f.VISIBILITY_CHANGE,F((function(){"hidden"===document.visibilityState&&e.flush()}))),window.addEventListener(f.BEFORE_UNLOAD,F((function(){return e.flush()}))))},e}(),R=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var k,x=function(){var e,t,n,r,i,a,o=[];function s(e,t,n){var r;for(var i in o)if(N(o,i))try{o[i](e,t,n)}catch(e){r=e}if(r)throw r}function c(e,r,i,a,o){if(t)B.augmentStackTraceWithInitialElement(t,r,i,""+e),l();else if(o)s(B(o),!0,o);else{var c,u={url:r,column:a,line:i},h=e;if("[object String]"==={}.toString.call(e)){var d=h.match(R);d&&(c=d[1],h=d[2])}s({name:c,message:h,stack:[u]},!0)}return!!n&&n.apply(this,arguments)}function u(e){var t=e.reason||"Empty reason";s(B(t),!0,t)}function l(){var n=t,r=e;t=void 0,e=void 0,s(n,!1,r)}function h(n){if(t){if(e===n)return;l()}var r=B(n);throw t=r,e=n,setTimeout((function(){e===n&&l()}),r.incomplete?2e3:0),n}return h.subscribe=function(e){!function(){if(r)return;n=window.onerror,window.onerror=F(c),r=!0}(),function(){if(a)return;i=null!==window.onunhandledrejection?window.onunhandledrejection:void 0,window.onunhandledrejection=F(u),a=!0}(),o.push(e)},h.unsubscribe=function(e){for(var t=o.length-1;t>=0;t-=1)o[t]===e&&o.splice(t,1);0===o.length&&(r&&(window.onerror=n,r=!1),a&&(window.onunhandledrejection=i,a=!1))},h.traceKitWindowOnError=c,h}(),B=function(){function e(e){if(e.stack){for(var t,n,r,i,a=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,o=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,s=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,c=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,u=/\((\S*)(?::(\d+))(?::(\d+))\)/,l=e.stack.split("\n"),h=[],d=0,f=l.length;d<f;d+=1){if(a.exec(l[d])){var p=(r=a.exec(l[d]))[2]&&0===r[2].indexOf("native");t=r[2]&&0===r[2].indexOf("eval"),n=u.exec(r[2]),t&&n&&(r[2]=n[1],r[3]=n[2],r[4]=n[3]),i={args:p?[r[2]]:[],column:r[4]?+r[4]:void 0,func:r[1]||"?",line:r[3]?+r[3]:void 0,url:p?void 0:r[2]}}else if(s.exec(l[d]))i={args:[],column:(r=s.exec(l[d]))[4]?+r[4]:void 0,func:r[1]||"?",line:+r[3],url:r[2]};else{if(!o.exec(l[d]))continue;t=(r=o.exec(l[d]))[3]&&r[3].indexOf(" > eval")>-1,n=c.exec(r[3]),t&&n?(r[3]=n[1],r[4]=n[2],r[5]=void 0):0!==d||r[5]||void 0===e.columnNumber||(h[0].column=e.columnNumber+1),i={args:r[2]?r[2].split(","):[],column:r[5]?+r[5]:void 0,func:r[1]||"?",line:r[4]?+r[4]:void 0,url:r[3]}}!i.func&&i.line&&(i.func="?"),h.push(i)}if(h.length)return{stack:h,message:e.message,name:e.name}}}function t(e,t,n,r){var i={url:t,line:n?+n:void 0};if(i.url&&i.line){e.incomplete=!1;var a=e.stack;if(a.length>0&&a[0].url===i.url){if(a[0].line===i.line)return!1;if(!a[0].line&&a[0].func===i.func)return a[0].line=i.line,a[0].context=i.context,!1}return a.unshift(i),e.partial=!0,!0}return e.incomplete=!0,!1}function n(e,r){for(var i,a,o=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,s=[],c={},u=!1,l=n.caller;l&&!u;l=l.caller)l!==B&&l!==x&&(a={args:[],column:void 0,func:"?",line:void 0,url:void 0},i=o.exec(l.toString()),l.name?a.func=l.name:i&&(a.func=i[1]),void 0===a.func&&(a.func=i?i.input.substring(0,i.input.indexOf("{")):void 0),c[""+l]?u=!0:c[""+l]=!0,s.push(a));r&&s.splice(0,r);var h={stack:s,message:e.message,name:e.name};return t(h,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),h}function r(t,r){var i,a=void 0===r?0:+r;try{if(i=function(e){var t=e.stacktrace;if(t){for(var n,r=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,i=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,a=t.split("\n"),o=[],s=0;s<a.length;s+=2){var c=void 0;r.exec(a[s])?c={args:[],column:void 0,func:(n=r.exec(a[s]))[3],line:+n[1],url:n[2]}:i.exec(a[s])&&(c={args:(n=i.exec(a[s]))[5]?n[5].split(","):[],column:+n[2],func:n[3]||n[4],line:+n[1],url:n[6]}),c&&(!c.func&&c.line&&(c.func="?"),c.context=[a[s+1]],o.push(c))}if(o.length)return{stack:o,message:e.message,name:e.name}}}(t))return i}catch(e){0}try{if(i=e(t))return i}catch(e){0}try{if(i=function(e){var t=e.message.split("\n");if(!(t.length<4)){var n,r=/^\s*Line (\d+) of linked script ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,i=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,a=/^\s*Line (\d+) of function script\s*$/i,o=[],s=window&&window.document&&window.document.getElementsByTagName("script"),c=[];for(var u in s)N(s,u)&&!s[u].src&&c.push(s[u]);for(var l=2;l<t.length;l+=2){var h=void 0;if(r.exec(t[l]))h={args:[],column:void 0,func:(n=r.exec(t[l]))[3],line:+n[1],url:n[2]};else if(i.exec(t[l]))h={args:[],column:void 0,func:(n=i.exec(t[l]))[4],line:+n[1],url:n[3]};else if(a.exec(t[l])){n=a.exec(t[l]),h={url:window.location.href.replace(/#.*$/,""),args:[],column:void 0,func:"",line:+n[1]}}h&&(h.func||(h.func="?"),h.context=[t[l+1]],o.push(h))}if(o.length)return{stack:o,message:t[0],name:e.name}}}(t))return i}catch(e){0}try{if(i=n(t,a+1))return i}catch(e){0}return{message:t.message,name:t.name,stack:[]}}return r.augmentStackTraceWithInitialElement=t,r.computeStackTraceFromStackProp=e,r.ofCaller=function(e){var t=1+(void 0===e?0:+e);try{throw new Error}catch(e){return B(e,t+1)}},r}();!function(e){e.info="info",e.error="error"}(k||(k={}));var C,D,L,U={maxMessagesPerPage:0,sentMessageCount:0};function P(e){if(e.internalMonitoringEndpoint){var t=function(e){var t,n=r(e.internalMonitoringEndpoint);void 0!==e.replica&&(t=r(e.replica.internalMonitoringEndpoint));function r(t){return new O(new S(t,e.batchBytesLimit),e.maxBatchSize,e.batchBytesLimit,e.maxMessageSize,e.flushTimeout)}return{add:function(e){var r=function(e){return l({date:(new Date).getTime(),view:{referrer:document.referrer,url:window.location.href}},void 0!==C?C():{},e)}(e);n.add(r),t&&t.add(r)}}}(e);!function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];t.forEach((function(t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))}(U,{batch:t,maxMessagesPerPage:e.maxInternalMonitoringMessagesPerPage,sentMessageCount:0})}return{setExternalContextProvider:function(e){C=e}}}function M(e,t,n){var r=n.value;n.value=function(){var e=U.batch?F(r):r;return e.apply(this,arguments)}}function F(e){return function(){try{return e.apply(this,arguments)}catch(e){G(e);try{j(e)}catch(e){G(e)}}}}function j(e){V(r(r({},function(e){if(e instanceof Error){var t=B(e);return{error:{kind:t.name,stack:T(t)},message:t.message}}return{error:{stack:"Not an instance of error"},message:"Uncaught "+y(e)}}(e)),{status:k.error}))}function V(e){U.batch&&U.sentMessageCount<U.maxMessagesPerPage&&(U.sentMessageCount+=1,U.batch.add(e))}function z(e){U.debugMode=e}function G(e){U.debugMode}!function(e){e.debug="debug",e.info="info",e.warn="warn",e.error="error"}(L||(L={}));var H,K=((D={})[L.debug]=0,D[L.info]=1,D[L.warn]=2,D[L.error]=3,D);Object.keys(L);!function(e){e.http="http",e.console="console",e.silent="silent"}(H||(H={}));var J,Y,q=function(){function e(e,t,n,r){void 0===t&&(t=H.http),void 0===n&&(n=L.debug),void 0===r&&(r={}),this.sendLog=e,this.handlerType=t,this.level=n,this.contextManager=s(),this.contextManager.set(r)}return e.prototype.log=function(e,t,n){if(void 0===n&&(n=L.info),K[n]>=K[this.level])switch(this.handlerType){case H.http:this.sendLog(r({message:e,status:n},l(this.contextManager.get(),t)));break;case H.console:case H.silent:}},e.prototype.debug=function(e,t){this.log(e,t,L.debug)},e.prototype.info=function(e,t){this.log(e,t,L.info)},e.prototype.warn=function(e,t){this.log(e,t,L.warn)},e.prototype.error=function(e,t){var n={error:{origin:E.LOGGER}};this.log(e,l(n,t),L.error)},e.prototype.setContext=function(e){this.contextManager.set(e)},e.prototype.addContext=function(e,t){this.contextManager.add(e,t)},e.prototype.removeContext=function(e){this.contextManager.remove(e)},e.prototype.setHandler=function(e){this.handlerType=e},e.prototype.setLevel=function(e){this.level=e},function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);a>3&&o&&Object.defineProperty(t,n,o)}([M],e.prototype,"log",null),e}();function W(e,t,n,r){var i=new Date;i.setTime(i.getTime()+n);var a="expires="+i.toUTCString(),o=r&&r.crossSite?"none":"strict",s=r&&r.domain?";domain="+r.domain:"",c=r&&r.secure?";secure":"";document.cookie=e+"="+t+";"+a+";path=/;samesite="+o+s+c}function X(e){return function(e,t){var n=e.match("(?:^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return n?n[1]:void 0}(document.cookie,e)}function Z(e){if(void 0===document.cookie||null===document.cookie)return!1;try{var t="dd_cookie_test_"+v();return W(t,"test",1e3,e),"test"===X(t)}catch(e){return!1}}function $(e){return te(e,w(window.location)).href}function Q(e,t){return ee(e)===ee(t)}function ee(e){return w(te(e))}function te(e,t){if(function(){if(void 0!==Y)return Y;try{var e=new URL("http://test/path");return Y="http://test/path"===e.href}catch(e){Y=!1}return Y}())return void 0!==t?new URL(e,t):new URL(e);if(void 0===t&&!/:/.test(e))throw new Error("Invalid URL: '"+e+"'");var n=document,r=n.createElement("a");if(void 0!==t){var i=(n=document.implementation.createHTMLDocument("")).createElement("base");i.href=t,n.head.appendChild(i),n.body.appendChild(r)}return r.href=e,r}var ne,re,ie={allowedTracingOrigins:[],maxErrorsByMinute:3e3,maxInternalMonitoringMessagesPerPage:15,resourceSampleRate:100,sampleRate:100,silentMultipleInit:!1,trackInteractions:!1,requestErrorResponseLengthLimit:32768,flushTimeout:3e4,maxBatchSize:50,maxMessageSize:262144,batchBytesLimit:16384};function ae(e){var t={};return t.secure=function(e){return!!e.useSecureSessionCookie||!!e.useCrossSiteSessionCookie}(e),t.crossSite=!!e.useCrossSiteSessionCookie,e.trackSessionAcrossSubdomains&&(t.domain=function(){if(void 0===J){for(var e="dd_site_test_"+v(),t=window.location.hostname.split("."),n=t.pop();t.length&&!X(e);)W(e,"test",1e3,{domain:n=t.pop()+"."+n});J=n}return J}()),t}function oe(e,t,n){var r="sdk_version:"+t.sdkVersion+(t.env?",env:"+t.env:"")+(t.service?",service:"+t.service:"")+(t.version?",version:"+t.version:""),i=e+"-http-intake.logs."+t.site,a=t.proxyHost?t.proxyHost:i,o=t.proxyHost?"ddhost="+i+"&":"",s=""+(t.applicationId?"_dd.application_id="+t.applicationId+"&":"")+o+"ddsource="+(n||"browser")+"&ddtags="+r;return"https://"+a+"/v1/input/"+t.clientToken+"?"+s}function se(e,t){return-1!==function(e){var t=te(e).pathname;return"/"===t[0]?t:"/"+t}(e).indexOf("/v1/input/")&&(Q(e,t.logsEndpoint)||Q(e,t.rumEndpoint)||Q(e,t.traceEndpoint)||!!t.internalMonitoringEndpoint&&Q(e,t.internalMonitoringEndpoint)||!!t.replica&&(Q(e,t.replica.logsEndpoint)||Q(e,t.replica.rumEndpoint)||Q(e,t.replica.internalMonitoringEndpoint)))}!function(e){e.US="us",e.EU="eu"}(re||(re={}));var ce,ue=((ne={})[re.EU]="datadoghq.eu",ne[re.US]="datadoghq.com",ne);function le(e,t){var n=function(e,t){var n={applicationId:e.applicationId,buildMode:t.buildMode,clientToken:e.clientToken,env:e.env,proxyHost:e.proxyHost,sdkVersion:t.sdkVersion,service:e.service,site:e.site||ue[e.datacenter||t.datacenter],version:e.version},i=Array.isArray(e.enableExperimentalFeatures)?e.enableExperimentalFeatures:[],a=r({cookieOptions:ae(e),isEnabled:function(e){return t=e,-1!==i.indexOf(t);var t},logsEndpoint:oe("browser",n),proxyHost:e.proxyHost,rumEndpoint:oe("rum",n),service:e.service,traceEndpoint:oe("public-trace",n)},ie);if(e.internalMonitoringApiKey&&(a.internalMonitoringEndpoint=oe("browser",n,"browser-agent-internal-monitoring")),"allowedTracingOrigins"in e&&(a.allowedTracingOrigins=e.allowedTracingOrigins),"sampleRate"in e&&(a.sampleRate=e.sampleRate),"resourceSampleRate"in e&&(a.resourceSampleRate=e.resourceSampleRate),"trackInteractions"in e&&(a.trackInteractions=!!e.trackInteractions),n.buildMode===ce.E2E_TEST&&(a.internalMonitoringEndpoint="<<< E2E INTERNAL MONITORING ENDPOINT >>>",a.logsEndpoint="<<< E2E LOGS ENDPOINT >>>",a.rumEndpoint="<<< E2E RUM ENDPOINT >>>"),n.buildMode===ce.STAGING&&void 0!==e.replica){var o=r(r({},n),{applicationId:e.replica.applicationId,clientToken:e.replica.clientToken,site:ue[re.US]});a.replica={applicationId:e.replica.applicationId,internalMonitoringEndpoint:oe("browser",o,"browser-agent-internal-monitoring"),logsEndpoint:oe("browser",o),rumEndpoint:oe("rum",o)}}return a}(e,t);return{configuration:n,internalMonitoring:P(n)}}function he(){return"file:"!==window.location.protocol}!function(e){e.RELEASE="release",e.STAGING="staging",e.E2E_TEST="e2e-test"}(ce||(ce={}));var de,fe,pe,ge=function(){function e(e){void 0===e&&(e=1e4),this.limit=e,this.buffer=[]}return e.prototype.add=function(e){this.buffer.push(e)>this.limit&&this.buffer.splice(0,1)},e.prototype.drain=function(e){this.buffer.forEach((function(t){return e(t)})),this.buffer.length=0},e}(),me=[],Ee=[];function ve(){return de||(!function(){if(!window.fetch)return;fe=window.fetch,window.fetch=F((function(e,t){var n=this,r=t&&t.method||"object"==typeof e&&e.method||"GET",o=$("object"==typeof e&&e.url||e),s={init:t,method:r,startTime:performance.now(),url:o},c=function(e){return i(n,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return s.duration=performance.now()-s.startTime,"stack"in e||e instanceof Error?(s.status=0,s.response=T(B(e)),Ee.forEach((function(e){return e(s)})),[3,6]):[3,1];case 1:if(!("status"in e))return[3,6];t=void 0,r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.clone().text()];case 3:return t=r.sent(),[3,5];case 4:return n=r.sent(),t="Unable to retrieve response: "+n,[3,5];case 5:s.response=t,s.responseType=e.type,s.status=e.status,Ee.forEach((function(e){return e(s)})),r.label=6;case 6:return[2]}}))}))};me.forEach((function(e){return e(s)}));var u=fe.call(this,e,s.init);return u.then(F(c),F(c)),u}))}(),de={beforeSend:function(e){me.push(e)},onRequestComplete:function(e){Ee.push(e)}}),de}var _e,ye,be=[],Ie=[];function we(){return pe||(_e=XMLHttpRequest.prototype.open,ye=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.open=F((function(e,t){return this._datadog_xhr={method:e,startTime:-1,url:$(t)},_e.apply(this,arguments)})),XMLHttpRequest.prototype.send=F((function(e){var t=this;if(this._datadog_xhr){this._datadog_xhr.startTime=performance.now();var n=this.onreadystatechange;this.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&F(i)(),n&&n.apply(this,arguments)};var r=!1,i=function(){r||(r=!0,t._datadog_xhr.duration=performance.now()-t._datadog_xhr.startTime,t._datadog_xhr.response=t.response,t._datadog_xhr.status=t.status,Ie.forEach((function(e){return e(t._datadog_xhr)})))};this.addEventListener("loadend",F(i)),be.forEach((function(e){return e(t._datadog_xhr,t)}))}return ye.apply(this,arguments)})),pe={beforeSend:function(e){be.push(e)},onRequestComplete:function(e){Ie.push(e)}}),pe}var Te,Ae,Se,Oe=function(){function e(){this.observers=[]}return e.prototype.subscribe=function(e){this.observers.push(e)},e.prototype.notify=function(e){this.observers.forEach((function(t){return t(e)}))},e}();function Re(e){if(!Te){var t=new Oe;!function(e,t){function n(n,r){se(r.url,e)||!function(e){return 0===e.status&&"opaque"!==e.responseType}(r)&&!function(e){return e.status>=500}(r)||t.notify({message:xe(n)+" error "+r.method+" "+r.url,resource:{method:r.method,statusCode:r.status,url:r.url},source:E.NETWORK,stack:ke(r.response,e)||"Failed to load",startTime:r.startTime})}we().onRequestComplete((function(e){return n(g.XHR,e)})),ve().onRequestComplete((function(e){return n(g.FETCH,e)}))}(e,t),function(e){Ae=console.error,console.error=F((function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ae.apply(console,o([t],n)),e.notify({message:o(["console error:",t],n).map(Ne).join(" "),source:E.CONSOLE,startTime:performance.now()})}))}(t),function(e){Se=function(t,n,r){var i=function(e,t,n){return e&&(void 0!==e.message||t instanceof Error)?{message:e.message||"Empty message",stack:T(e),type:e.name}:{message:n+" "+y(t),stack:"No stack, consider using an instance of Error",type:e&&e.name}}(t,r,"Uncaught"),a=i.stack,o=i.message,s=i.type;e.notify({message:o,stack:a,type:s,source:E.SOURCE,startTime:performance.now()})},x.subscribe(Se)}(t),Te=function(e,t){var n=0,r=new Oe;return t.subscribe((function(t){n<e.maxErrorsByMinute?(n+=1,r.notify(t)):n===e.maxErrorsByMinute&&(n+=1,r.notify({message:"Reached max number of errors by minute: "+e.maxErrorsByMinute,source:E.AGENT,startTime:performance.now()}))})),setInterval((function(){return n=0}),6e4),r}(e,t)}return Te}function Ne(e){return"string"==typeof e?e:e instanceof Error?T(B(e)):y(e,0,2)}function ke(e,t){return e&&e.length>t.requestErrorResponseLengthLimit?e.substring(0,t.requestErrorResponseLengthLimit)+"...":e}function xe(e){return g.XHR===e?"XHR":"Fetch"}function Be(e,t,n){var r=function(e,t){var n,r,i=!1,a=function(){i=!0,window.clearTimeout(n),n=window.setTimeout((function(){i=!1}),1e3)};return{get:function(){return i||(r=X(e),a()),r},set:function(n,i){W(e,n,i,t),r=n,a()}}}("_dd_s",e);!function(e){var t=e.get(),n=X("_dd"),r=X("_dd_r"),i=X("_dd_l");if(!t){var a={};n&&(a.id=n),i&&/^[01]$/.test(i)&&(a.logs=i),r&&/^[012]$/.test(r)&&(a.rum=r),Le(a,e)}}(r);var i=new Oe,a=De(r).id,o=function(e,t,n){var r,i=!n||void 0===n.leading||n.leading,a=!n||void 0===n.trailing||n.trailing,o=!1,s=!1;return{throttled:function(){var n=this;o?s=!0:(i?e.apply(this):s=!0,o=!0,r=window.setTimeout((function(){a&&s&&e.apply(n),o=!1,s=!1}),t))},cancel:function(){window.clearTimeout(r),o=!1,s=!1}}}((function(){var e=De(r),o=n(e[t]),s=o.trackingType,c=o.isTracked;e[t]=s,c&&!e.id&&(e.id=v(),e.created=String(Date.now())),Le(e,r),c&&a!==e.id&&(a=e.id,i.notify())}),1e3).throttled;return o(),function(e){var t=F(e),n={capture:!0,passive:!0};[f.CLICK,f.TOUCH_START,f.KEY_DOWN,f.SCROLL].forEach((function(e){document.addEventListener(e,t,n),Pe.push((function(){return document.removeEventListener(e,t,n)}))}))}(o),function(e){var t=F((function(){"visible"===document.visibilityState&&e()})),n=window.setInterval(t,6e4);document.addEventListener(f.VISIBILITY_CHANGE,t),Pe.push((function(){clearInterval(n),document.removeEventListener(f.VISIBILITY_CHANGE,t)}))}((function(){Le(De(r),r)})),{getId:function(){return De(r).id},getTrackingType:function(){return De(r)[t]},renewObservable:i}}var Ce=/^([a-z]+)=([a-z0-9-]+)$/;function De(e){var t=function(e){var t=e.get(),n={};(function(e){return void 0!==e&&(-1!==e.indexOf("&")||Ce.test(e))})(t)&&t.split("&").forEach((function(e){var t=Ce.exec(e);if(null!==t){var r=t[1],i=t[2];n[r]=i}}));return n}(e);return function(e){return(void 0===e.created||Date.now()-Number(e.created)<144e5)&&(void 0===e.expire||Date.now()<Number(e.expire))}(t)?t:(Ue(e),{})}function Le(e,t){if(n=e,0!==Object.keys(n).length){var n;e.expire=String(Date.now()+9e5);var r=function(e){return Object.keys(e).map((function(t){return[t,e[t]]}))}(e).map((function(e){return e[0]+"="+e[1]})).join("&");t.set(r,9e5)}else Ue(t)}function Ue(e){e.set("",0)}var Pe=[];var Me;function Fe(e,t){if(!t){var n=je(e)===Me.TRACKED;return{getId:function(){},isTracked:function(){return n}}}var r=Be(e.cookieOptions,"logs",(function(t){return function(e,t){var n=function(e){return e===Me.NOT_TRACKED||e===Me.TRACKED}(t)?t:je(e);return{trackingType:n,isTracked:n===Me.TRACKED}}(e,t)}));return{getId:r.getId,isTracked:function(){return r.getTrackingType()===Me.TRACKED}}}function je(e){return 0!==(t=e.sampleRate)&&100*Math.random()<=t?Me.TRACKED:Me.NOT_TRACKED;var t}!function(e){e.NOT_TRACKED="0",e.TRACKED="1"}(Me||(Me={}));var Ve={buildMode:"release",datacenter:"us",sdkVersion:"1.25.4"};function ze(e){var t=window.DD_RUM,n=t&&t.getInternalContext?t.getInternalContext(e):void 0;if(!n||!n.session)return n;var r=n;return r.session_id=r.session.id,r.application_id=r.application.id,r.action&&(r.user_action={id:r.action.id}),r}var Ge,He,Ke,Je,Ye=function(e){var t=!1,n=s(),i={},a=new ge,o=function(e,t){a.add([e,t])},c=new q(d);return u={logger:c,init:F((function(r){he()&&function(e){return t?(e.silentMultipleInit,!1):!(!e||!e.publicApiKey&&!e.clientToken)&&!!(void 0===e.sampleRate||(n=e.sampleRate,function(e){return"number"==typeof e}(n)&&n>=0&&n<=100));var n}(r)&&(r.publicApiKey&&(r.clientToken=r.publicApiKey),o=e(r,c,n.get),a.drain((function(e){var t=e[0],n=e[1];return o(t,n)})),t=!0)})),getLoggerGlobalContext:F(n.get),setLoggerGlobalContext:F(n.set),addLoggerGlobalContext:F(n.add),removeLoggerGlobalContext:F(n.remove),createLogger:F((function(e,t){return void 0===t&&(t={}),i[e]=new q(d,t.handler,t.level,r(r({},t.context),{logger:{name:e}})),i[e]})),getLogger:F((function(e){return i[e]}))},h=r(r({},u),{onReady:function(e){e()}}),Object.defineProperty(h,"_setDebug",{get:function(){return z},enumerable:!1}),h;var u,h;function d(e){o(e,l({date:Date.now(),view:{referrer:document.referrer,url:window.location.href}},n.get()))}}((function(e,t,n){var r=le(e,Ve),i=r.configuration,a=r.internalMonitoring;return function(e,t,n,r,i,a){n.setExternalContextProvider((function(){return l({session_id:r.getId()},a(),ze())}));var o=function(e,t){var n,r=i(e.logsEndpoint);void 0!==e.replica&&(n=i(e.replica.logsEndpoint));function i(t){return new O(new S(t,e.batchBytesLimit),e.maxBatchSize,e.batchBytesLimit,e.maxMessageSize,e.flushTimeout)}return{add:function(i,a){var o=function(e,t,n,r){return l(e,t,n,r)}({service:e.service,session_id:t.getId()},a,ze(),i);r.add(o),n&&n.add(o)}}}(e,r);return t.subscribe((function(e){var t;i.error(e.message,l({date:(t=e.startTime,Math.floor(I()+t)),error:{kind:e.type,origin:e.source,stack:e.stack}},e.resource?{http:{method:e.resource.method,status_code:e.resource.statusCode,url:e.resource.url}}:void 0,ze(e.startTime)))})),function(e,t){r.isTracked()&&o.add(e,t)}}(i,!1!==e.forwardErrorsToLogs?Re(i):new Oe,a,Fe(i,Z(i.cookieOptions)),t,n)}));Ge=function(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"_dd_temp_",{get:function(){return this},configurable:!0});var e=_dd_temp_;return delete Object.prototype._dd_temp_,"object"!=typeof e&&(e="object"==typeof self?self:"object"==typeof window?window:{}),e}(),Ke=Ye,Je=Ge[He="DD_LOGS"],Ge[He]=Ke,Je&&Je.q&&Je.q.forEach((function(e){return e()}))},,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));const r=4,i=23},,,function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u}));var r=n(0),i=n(9),a=n(8),o=(n(26),i.a.extend({fetch(e){return EBATES.merchants.length&&EBATES.merchants.rewardsSynced?i.a.prototype.fetch.call(this,e):new Promise((t,n)=>{EBATES.merchants.length&&!EBATES.merchants.rewardsUpdating&&EBATES.merchants.updateAttributes(),EBATES.merchants.once("sync-rewards",()=>{this.fetch(e).then(t,n)})})}})),s=o.extend({initialize(){this.on({error:function(e,t){Object(r.default)([401,403]).includes(t.status)&&EBATES.onTokenExpired()}})}});let c=i.g.extend({store:null,defaults:{storeId:11095},initialize(){this.get("code")&&this.get("code").indexOf("&amp;")&&this.set({code:this.get("code").replace("&amp;","&")})},toJSON(){var e=EBATES.merchants.findWhere({storeId:this.get("storeId")});if(e&&e.get("shoppingURL")){let t=e.toJSON(),n=Object(a.a)(t.shoppingURL.replace("&store_url=%deepLinkUrl%",""),{special:this.id,tb:"yes",domainName:t.domainName,sourceName:"toolbar",channel:4,toolbarFeatureId:"DDD",eeid:t.mpl?"40874":"26141",mpl_id:t.mpl});return r.default.extend(i.g.prototype.toJSON.apply(this,arguments),r.default.pick(t,"images","storeName","cashBackAmount","reward","rewardsExpired"),{shoppingURL:n})}return null}});var u=o.extend({model:c,comparator:e=>[e.has("code")?0:1,["Store Wide","Department","Free Gift","Free Shipping","Product",null].indexOf(e.get("scope")),e.get("scores")?e.get("scores").score1:0],parse:e=>r.default.chain(e.storeDeals).map((function(e){return r.default.map(e.deals,(function(t){return r.default.extend({storeId:e.storeId},t)}))})).flatten().value(),search(e){return r.default.chain(this.filter((function(t){return t.get("description").toLowerCase().indexOf(e)>=0}))).invoke("toJSON").value()}})},,,,,function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(128)),r(n(129)),r(n(283))},,function(e,t,n){"use strict";var r=n(2);class i extends Map{constructor(){super(),this._currentTabId=0;let e=e=>{(e.name===r.a.browser.TABCHANGED||e.name===r.a.browser.DOCUMENTCOMPLETE&&e.active)&&(this._currentTabId=e.tabId),delete e.name,this.set(e.tabId,e)};r.a.browser.attachEvent(r.a.browser.DOCUMENTCOMPLETE,e),r.a.browser.attachEvent(r.a.browser.TABCHANGED,e),r.a.browser.attachEvent(r.a.browser.TABCLOSED,e=>{this.delete(e.tabId)}),r.a.extension.attachEvent("currentTab",(e,t)=>{t(this.active)})}get active(){return this.get(this._currentTabId)||{tabId:0,url:"about:blank"}}}t.a=new i},,function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return h})),n.d(t,"a",(function(){return d}));var r=n(0),i=n(5),a=n.n(i),o=n(11),s=n.n(o),c=n(2),u=n(9),l=(n(26),a.a.Model.extend({idAttribute:"created",defaults:{created:null,removed:!1,shown:!1,text:""},initialize(){this.get("created")||this.set("created",r.default.now()),this.on("change:unread",()=>{this.collection.trigger("change")})},toJSON(){let e=a.a.Model.prototype.toJSON.apply(this,arguments);if("bonus"===this.get("type")){let t=EBATES.member.bonuses.get(this.get("bonus_id"));if(t&&(e.bonus=t.toJSON(),e.bonus.description=e.bonus.description.replace(/\$[\d.,]+ Cash Bonus /,""),e.bonus.storeIds&&e.bonus.storeIds.length)){let t=EBATES.merchants.get(e.bonus.storeIds[0]);t&&(e.bonus.store=t.toJSON())}}else if("cashback"===this.get("type")){let t=EBATES.merchants.get(this.get("storeId"));t&&(e.store=t.toJSON())}return e}})),h=u.e.extend({key:"messages",model:l,initialize(){this.fetch({silent:!0}),this.on({"add remove change reset":function(){let e=this.where({shown:!1}).length;EBATES.badge.update("message",e),this.save()},add:function(e){c.a.browser.isWebkit&&e.get("desktop")&&this.checkPermission().then(()=>{new d({model:e}).render()}).catch(()=>{})}})},flush(){return this.remove(this.filter(e=>e.has("created")&&e.get("shown")&&e.get("created")<s()().subtract(EBATES.settings.get("messageExpires")))),Promise.resolve()},checkPermission:()=>new Promise((e,t)=>{browser.permissions.contains({permissions:["notifications"]}).then(n=>{n?e():t()}).catch(()=>{})})}),d=a.a.View.extend({eventsHandler:{},category:"Desktop Message",events:{onButtonClicked:function(e){e===this.notificationId&&this.click()},onClicked:function(e){e===this.notificationId&&this.model.has("url")&&!this.model.has("cta")&&this.click()},onClosed:function(e){e===this.notificationId&&!this.model.get("popup")&&this.model.get("desktop")&&this.collection&&this.model.collection.remove(this.model),this.detachEvents()}},click(){c.a.browser.navigate({url:this.model.get("url"),tabId:c.a.browser.NEWTAB}),browser.notifications.clear(this.notificationId),this.model.set({shown:!0})},initialize(){this.attachEvents()},attachEvents(){Object.keys(this.events).forEach(e=>{this.eventsHandler[e]=this.events[e].bind(this),browser.notifications[e].addListener(this.eventsHandler[e])})},detachEvents(){Object.keys(this.events).forEach(e=>{browser.notifications[e].removeListener(this.eventsHandler[e])})},render(){browser.notifications.create({type:"basic",title:this.model.get("title")||c.a.extension.name,iconUrl:this.model.get("image")||"/img/rakuten/icon-rakuten-gradient.svg",message:this.model.get("text"),buttons:this.model.has("url")&&this.model.has("cta")?[{title:this.model.get("cta")}]:null}).then(e=>{this.notificationId=e}).catch(e=>{})}})},function(e,t,n){"use strict";var r=n(76),i=n(2),a=n(8);n(26);t.a=new class{constructor(){this.sessions=new Map,this.disabled=!1,i.a.extension.attachEvent("orderConfirmation",({data:e})=>{if(!EBATES)return;let{url:t}=e,n=EBATES.merchants.match(t);if(n){let e=n.get("storeId");this.sessions.has(e)&&this.flush(e)}})}isStoreEligible(e){if(EBATES.settings.featureFlags.variation("immerseAllStores",!0))return!0;{const t=EBATES.settings.promos.get("immerse");if(t&&t.get("active")&&t.campaigns){return!!t.campaigns.find(t=>t.stores.get(e))}}return!1}isEnabled(){return!this.disabled&&EBATES.settings.featureFlags.variation("immerse",!0)}start(e){if(!this.isEnabled())return;const t=e.get("storeId");if(this.isStoreEligible(t)&&!this.sessions.has(t)){let n=null;n=setTimeout(this.sessionTimeout.bind(this),9e5,t),this.sessions.set(t,{storeName:e.get("storeName"),ttn:e.get("ttn"),storeId:t,timeoutId:n,content:[]})}}stop(e){const t=e.get("storeId");let n=this.sessions.get(t);n&&(this.send(n),this.sessions.delete(t),n.timeoutId&&clearTimeout(n.timeoutId))}sessionTimeout(e){this.flush(e)}visit(e,t){if(!this.isEnabled())return;let n=e.get("storeId"),r=this.sessions.get(n);r&&(e.get("activated")||e.get("suppressed"))&&(e.get("ttn")!==r.ttn&&(this.flush(n),r.ttn=e.get("ttn")),r.content.push({timestamp:(new Date).toISOString(),url:Object(a.j)(t)}),r.content.length>=10&&this.flush(n),this.sessions.set(n,r))}flush(e){let t=this.sessions.get(e);if(t){this.send(t),t.content.length=0;let n=null;t.timeoutId&&(clearTimeout(t.timeoutId),n=setTimeout(this.sessionTimeout.bind(this),9e5,e)),t.timeoutId=n}}send(e){if(!this.isEnabled()||0===e.content.length)return;const t={content:e.content,store_name:e.storeName,store_id:e.storeId.toString(),user_agent:navigator.userAgent,source_name:"toolbar",shopping_trip_id:"ebs"+e.ttn+"sbe",rr_member_guid:EBATES.member.id};return fetch(Object(a.k)("https://immerse.onereceipt.com/api/1.0/immerse"),{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip","X-Button-Version":i.a.extension.version,"X-Api-Key":"92e14077-2d12-4429-b580-f658e0fc04bf"},body:new Uint8Array(new r.gzip(JSON.stringify(t)))})}}},,function(e,t,n){var r=n(126),i=n(127);e.exports=function(e,t,n){var a=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[a+s]=o[s];return t||i(o)}},,,function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var r=n(5),i=n.n(r),a=n(9);let o=i.a.Model.extend({idAttribute:"storeId"}),s=(i.a.Collection.extend({model:o}),a.a.extend({dynamic:!1,timeout:864e5,model:o,parse:e=>e&&e.campaigns&&e.campaigns[0]&&e.campaigns[0].stores}))},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(130);function i(e){return Object.keys(e).map((function(t){return e[t]}))}t.generateUUID=function(){return r.v4()},t.getTimestamp=function(){return(new Date).getTime()},t.isValidEnum=function(e,t){for(var n=!1,r=Object.keys(e),i=0;i<r.length;i++)if(t===e[r[i]]){n=!0;break}return n},t.groupBy=function(e,t){var n={};return e.forEach((function(e){var r=t(e);n[r]=n[r]||[],n[r].push(e)})),i(n)},t.objectValues=i,t.objectEntries=function(e){return Object.keys(e).map((function(t){return[t,e[t]]}))},t.find=function(e,t){for(var n,r=0,i=e;r<i.length;r++){var a=i[r];if(t(a)){n=a;break}}return n},t.keyBy=function(e,t){var n={};return e.forEach((function(e){var r=t(e);n[r]=e})),n},t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=0;return e.replace(/%s/g,(function(){var e=t[r++],n=typeof e;return"function"===n?e():"string"===n?e:String(e)}))},function(e){e.ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",e.DECISION="DECISION:type, userId, attributes, decisionInfo",e.LOG_EVENT="LOG_EVENT:logEvent",e.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",e.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"}(t.NOTIFICATION_TYPES||(t.NOTIFICATION_TYPES={}))},,,,,,,,,,function(e,t,n){"use strict";var r={};(0,n(48).assign)(r,n(275),n(278),n(125)),e.exports=r},function(e,t,n){(function(r){var i;!function(){var a;function o(e){var t,n,r,i="",a=-1;if(e&&e.length)for(r=e.length;(a+=1)<r;)t=e.charCodeAt(a),n=a+1<r?e.charCodeAt(a+1):0,55296<=t&&t<=56319&&56320<=n&&n<=57343&&(t=65536+((1023&t)<<10)+(1023&n),a+=1),t<=127?i+=String.fromCharCode(t):t<=2047?i+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?i+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(i+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return i}function s(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function c(e,t){return e<<t|e>>>32-t}function u(e,t){for(var n,r=t?"0123456789ABCDEF":"0123456789abcdef",i="",a=0,o=e.length;a<o;a+=1)n=e.charCodeAt(a),i+=r.charAt(n>>>4&15)+r.charAt(15&n);return i}function l(e){var t,n=32*e.length,r="";for(t=0;t<n;t+=8)r+=String.fromCharCode(e[t>>5]>>>24-t%32&255);return r}function h(e){var t,n=32*e.length,r="";for(t=0;t<n;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function d(e){var t,n=8*e.length,r=Array(e.length>>2),i=r.length;for(t=0;t<i;t+=1)r[t]=0;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function f(e){var t,n=8*e.length,r=Array(e.length>>2),i=r.length;for(t=0;t<i;t+=1)r[t]=0;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<24-t%32;return r}function p(e,t){var n,r,i,a,o,s,c,u,l=t.length,h=Array();for(a=(s=Array(Math.ceil(e.length/2))).length,n=0;n<a;n+=1)s[n]=e.charCodeAt(2*n)<<8|e.charCodeAt(2*n+1);for(;s.length>0;){for(o=Array(),i=0,n=0;n<s.length;n+=1)i=(i<<16)+s[n],i-=(r=Math.floor(i/l))*l,(o.length>0||r>0)&&(o[o.length]=r);h[h.length]=i,s=o}for(c="",n=h.length-1;n>=0;n--)c+=t.charAt(h[n]);for(u=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),n=c.length;n<u;n+=1)c=t[0]+c;return c}function g(e,t){var n,r,i,a="",o=e.length;for(t=t||"=",n=0;n<o;n+=3)for(i=e.charCodeAt(n)<<16|(n+1<o?e.charCodeAt(n+1)<<8:0)|(n+2<o?e.charCodeAt(n+2):0),r=0;r<4;r+=1)8*n+6*r>8*e.length?a+=t:a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-r)&63);return a}a={VERSION:"1.0.6",Base64:function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t="=",n=!0;this.encode=function(r){var i,a,s,c="",u=r.length;for(t=t||"=",r=n?o(r):r,i=0;i<u;i+=3)for(s=r.charCodeAt(i)<<16|(i+1<u?r.charCodeAt(i+1)<<8:0)|(i+2<u?r.charCodeAt(i+2):0),a=0;a<4;a+=1)c+=8*i+6*a>8*u?t:e.charAt(s>>>6*(3-a)&63);return c},this.decode=function(r){var i,a,o,s,c,u,l,h,d="",f=[];if(!r)return r;i=h=0,r=r.replace(new RegExp("\\"+t,"gi"),"");do{a=(l=e.indexOf(r.charAt(i+=1))<<18|e.indexOf(r.charAt(i+=1))<<12|(c=e.indexOf(r.charAt(i+=1)))<<6|(u=e.indexOf(r.charAt(i+=1))))>>16&255,o=l>>8&255,s=255&l,f[h+=1]=64===c?String.fromCharCode(a):64===u?String.fromCharCode(a,o):String.fromCharCode(a,o,s)}while(i<r.length);return d=f.join(""),d=n?function(e){var t,n,r,i,a,o,s=[];if(t=n=r=i=a=0,e&&e.length)for(o=e.length,e+="";t<o;)n+=1,(r=e.charCodeAt(t))<128?(s[n]=String.fromCharCode(r),t+=1):r>191&&r<224?(i=e.charCodeAt(t+1),s[n]=String.fromCharCode((31&r)<<6|63&i),t+=2):(i=e.charCodeAt(t+1),a=e.charCodeAt(t+2),s[n]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&a),t+=3);return s.join("")}(d):d},this.setPad=function(e){return t=e||t,this},this.setTab=function(t){return e=t||e,this},this.setUTF8=function(e){return"boolean"==typeof e&&(n=e),this}},CRC32:function(e){var t,n,r,i=0,a=0;for(e=o(e),t=["00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 ","79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 ","84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F ","63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD ","A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC ","51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 ","B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 ","06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 ","E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 ","12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 ","D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 ","33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 ","CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 ","9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E ","7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D ","806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 ","60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA ","AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 ","5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 ","B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 ","05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 ","F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA ","11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 ","D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F ","30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E ","C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D"].join(""),i^=-1,n=0,r=e.length;n<r;n+=1)a=255&(i^e.charCodeAt(n)),i=i>>>8^"0x"+t.substr(9*a,8);return(-1^i)>>>0},MD5:function(e){var t=!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase,n=e&&"string"==typeof e.pad?e.pad:"=",r=!e||"boolean"!=typeof e.utf8||e.utf8;function i(e){return h(l(d(e=r?o(e):e),8*e.length))}function a(e,t){var n,i,a,s,c;for(e=r?o(e):e,t=r?o(t):t,(n=d(e)).length>16&&(n=l(n,8*e.length)),i=Array(16),a=Array(16),c=0;c<16;c+=1)i[c]=909522486^n[c],a[c]=1549556828^n[c];return s=l(i.concat(d(t)),512+8*t.length),h(l(a.concat(s),640))}function l(e,t){var n,r,i,a,o,c=1732584193,u=-271733879,l=-1732584194,h=271733878;for(e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t,n=0;n<e.length;n+=16)r=c,i=u,a=l,o=h,c=m(c,u,l,h,e[n+0],7,-680876936),h=m(h,c,u,l,e[n+1],12,-389564586),l=m(l,h,c,u,e[n+2],17,606105819),u=m(u,l,h,c,e[n+3],22,-1044525330),c=m(c,u,l,h,e[n+4],7,-176418897),h=m(h,c,u,l,e[n+5],12,1200080426),l=m(l,h,c,u,e[n+6],17,-1473231341),u=m(u,l,h,c,e[n+7],22,-45705983),c=m(c,u,l,h,e[n+8],7,1770035416),h=m(h,c,u,l,e[n+9],12,-1958414417),l=m(l,h,c,u,e[n+10],17,-42063),u=m(u,l,h,c,e[n+11],22,-1990404162),c=m(c,u,l,h,e[n+12],7,1804603682),h=m(h,c,u,l,e[n+13],12,-40341101),l=m(l,h,c,u,e[n+14],17,-1502002290),c=E(c,u=m(u,l,h,c,e[n+15],22,1236535329),l,h,e[n+1],5,-165796510),h=E(h,c,u,l,e[n+6],9,-1069501632),l=E(l,h,c,u,e[n+11],14,643717713),u=E(u,l,h,c,e[n+0],20,-373897302),c=E(c,u,l,h,e[n+5],5,-701558691),h=E(h,c,u,l,e[n+10],9,38016083),l=E(l,h,c,u,e[n+15],14,-660478335),u=E(u,l,h,c,e[n+4],20,-405537848),c=E(c,u,l,h,e[n+9],5,568446438),h=E(h,c,u,l,e[n+14],9,-1019803690),l=E(l,h,c,u,e[n+3],14,-187363961),u=E(u,l,h,c,e[n+8],20,1163531501),c=E(c,u,l,h,e[n+13],5,-1444681467),h=E(h,c,u,l,e[n+2],9,-51403784),l=E(l,h,c,u,e[n+7],14,1735328473),c=v(c,u=E(u,l,h,c,e[n+12],20,-1926607734),l,h,e[n+5],4,-378558),h=v(h,c,u,l,e[n+8],11,-2022574463),l=v(l,h,c,u,e[n+11],16,1839030562),u=v(u,l,h,c,e[n+14],23,-35309556),c=v(c,u,l,h,e[n+1],4,-1530992060),h=v(h,c,u,l,e[n+4],11,1272893353),l=v(l,h,c,u,e[n+7],16,-155497632),u=v(u,l,h,c,e[n+10],23,-1094730640),c=v(c,u,l,h,e[n+13],4,681279174),h=v(h,c,u,l,e[n+0],11,-358537222),l=v(l,h,c,u,e[n+3],16,-722521979),u=v(u,l,h,c,e[n+6],23,76029189),c=v(c,u,l,h,e[n+9],4,-640364487),h=v(h,c,u,l,e[n+12],11,-421815835),l=v(l,h,c,u,e[n+15],16,530742520),c=_(c,u=v(u,l,h,c,e[n+2],23,-995338651),l,h,e[n+0],6,-198630844),h=_(h,c,u,l,e[n+7],10,1126891415),l=_(l,h,c,u,e[n+14],15,-1416354905),u=_(u,l,h,c,e[n+5],21,-57434055),c=_(c,u,l,h,e[n+12],6,1700485571),h=_(h,c,u,l,e[n+3],10,-1894986606),l=_(l,h,c,u,e[n+10],15,-1051523),u=_(u,l,h,c,e[n+1],21,-2054922799),c=_(c,u,l,h,e[n+8],6,1873313359),h=_(h,c,u,l,e[n+15],10,-30611744),l=_(l,h,c,u,e[n+6],15,-1560198380),u=_(u,l,h,c,e[n+13],21,1309151649),c=_(c,u,l,h,e[n+4],6,-145523070),h=_(h,c,u,l,e[n+11],10,-1120210379),l=_(l,h,c,u,e[n+2],15,718787259),u=_(u,l,h,c,e[n+9],21,-343485551),c=s(c,r),u=s(u,i),l=s(l,a),h=s(h,o);return Array(c,u,l,h)}function f(e,t,n,r,i,a){return s(c(s(s(t,e),s(r,a)),i),n)}function m(e,t,n,r,i,a,o){return f(t&n|~t&r,e,t,i,a,o)}function E(e,t,n,r,i,a,o){return f(t&r|n&~r,e,t,i,a,o)}function v(e,t,n,r,i,a,o){return f(t^n^r,e,t,i,a,o)}function _(e,t,n,r,i,a,o){return f(n^(t|~r),e,t,i,a,o)}this.hex=function(e){return u(i(e),t)},this.b64=function(e){return g(i(e),n)},this.any=function(e,t){return p(i(e),t)},this.raw=function(e){return i(e)},this.hex_hmac=function(e,n){return u(a(e,n),t)},this.b64_hmac=function(e,t){return g(a(e,t),n)},this.any_hmac=function(e,t,n){return p(a(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&(t=e),this},this.setPad=function(e){return n=e||n,this},this.setUTF8=function(e){return"boolean"==typeof e&&(r=e),this}},SHA1:function(e){var t=!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase,n=e&&"string"==typeof e.pad?e.pad:"=",r=!e||"boolean"!=typeof e.utf8||e.utf8;function i(e){return l(h(f(e=r?o(e):e),8*e.length))}function a(e,t){var n,i,a,s,c;for(e=r?o(e):e,t=r?o(t):t,(n=f(e)).length>16&&(n=h(n,8*e.length)),i=Array(16),a=Array(16),s=0;s<16;s+=1)i[s]=909522486^n[s],a[s]=1549556828^n[s];return c=h(i.concat(f(t)),512+8*t.length),l(h(a.concat(c),672))}function h(e,t){var n,r,i,a,o,u,l,h,f=Array(80),p=1732584193,g=-271733879,E=-1732584194,v=271733878,_=-1009589776;for(e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t,n=0;n<e.length;n+=16){for(a=p,o=g,u=E,l=v,h=_,r=0;r<80;r+=1)f[r]=r<16?e[n+r]:c(f[r-3]^f[r-8]^f[r-14]^f[r-16],1),i=s(s(c(p,5),d(r,g,E,v)),s(s(_,f[r]),m(r))),_=v,v=E,E=c(g,30),g=p,p=i;p=s(p,a),g=s(g,o),E=s(E,u),v=s(v,l),_=s(_,h)}return Array(p,g,E,v,_)}function d(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function m(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}this.hex=function(e){return u(i(e),t)},this.b64=function(e){return g(i(e),n)},this.any=function(e,t){return p(i(e),t)},this.raw=function(e){return i(e)},this.hex_hmac=function(e,t){return u(a(e,t))},this.b64_hmac=function(e,t){return g(a(e,t),n)},this.any_hmac=function(e,t,n){return p(a(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&(t=e),this},this.setPad=function(e){return n=e||n,this},this.setUTF8=function(e){return"boolean"==typeof e&&(r=e),this}},SHA256:function(e){!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase;var t,n=e&&"string"==typeof e.pad?e.pad:"=",r=!e||"boolean"!=typeof e.utf8||e.utf8;function i(e,t){return l(y(f(e=t?o(e):e),8*e.length))}function a(e,t){e=r?o(e):e,t=r?o(t):t;var n,i=0,a=f(e),s=Array(16),c=Array(16);for(a.length>16&&(a=y(a,8*e.length));i<16;i+=1)s[i]=909522486^a[i],c[i]=1549556828^a[i];return n=y(s.concat(f(t)),512+8*t.length),l(y(c.concat(n),768))}function c(e,t){return e>>>t|e<<32-t}function h(e,t){return e>>>t}function d(e,t,n){return e&t^~e&n}function m(e,t,n){return e&t^e&n^t&n}function E(e){return c(e,2)^c(e,13)^c(e,22)}function v(e){return c(e,6)^c(e,11)^c(e,25)}function _(e){return c(e,7)^c(e,18)^h(e,3)}function y(e,n){var r,i,a,o,u,l,f,p,g,y,b,I,w,T=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],A=new Array(64);for(e[n>>5]|=128<<24-n%32,e[15+(n+64>>9<<4)]=n,g=0;g<e.length;g+=16){for(r=T[0],i=T[1],a=T[2],o=T[3],u=T[4],l=T[5],f=T[6],p=T[7],y=0;y<64;y+=1)A[y]=y<16?e[y+g]:s(s(s(c(w=A[y-2],17)^c(w,19)^h(w,10),A[y-7]),_(A[y-15])),A[y-16]),b=s(s(s(s(p,v(u)),d(u,l,f)),t[y]),A[y]),I=s(E(r),m(r,i,a)),p=f,f=l,l=u,u=s(o,b),o=a,a=i,i=r,r=s(b,I);T[0]=s(r,T[0]),T[1]=s(i,T[1]),T[2]=s(a,T[2]),T[3]=s(o,T[3]),T[4]=s(u,T[4]),T[5]=s(l,T[5]),T[6]=s(f,T[6]),T[7]=s(p,T[7])}return T}this.hex=function(e){return u(i(e,r))},this.b64=function(e){return g(i(e,r),n)},this.any=function(e,t){return p(i(e,r),t)},this.raw=function(e){return i(e,r)},this.hex_hmac=function(e,t){return u(a(e,t))},this.b64_hmac=function(e,t){return g(a(e,t),n)},this.any_hmac=function(e,t,n){return p(a(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&e,this},this.setPad=function(e){return n=e||n,this},this.setUTF8=function(e){return"boolean"==typeof e&&(r=e),this},t=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998]},SHA512:function(e){!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase;var t,n=e&&"string"==typeof e.pad?e.pad:"=",r=!e||"boolean"!=typeof e.utf8||e.utf8;function i(e){return l(s(f(e=r?o(e):e),8*e.length))}function a(e,t){e=r?o(e):e,t=r?o(t):t;var n,i=0,a=f(e),c=Array(32),u=Array(32);for(a.length>32&&(a=s(a,8*e.length));i<32;i+=1)c[i]=909522486^a[i],u[i]=1549556828^a[i];return n=s(c.concat(f(t)),1024+8*t.length),l(s(u.concat(n),1536))}function s(e,n){var r,i,a,o=new Array(80),s=new Array(16),u=[new c(1779033703,-205731576),new c(-1150833019,-2067093701),new c(1013904242,-23791573),new c(-1521486534,1595750129),new c(1359893119,-1377402159),new c(-1694144372,725511199),new c(528734635,-79577749),new c(1541459225,327033209)],l=new c(0,0),f=new c(0,0),p=new c(0,0),g=new c(0,0),b=new c(0,0),I=new c(0,0),w=new c(0,0),T=new c(0,0),A=new c(0,0),S=new c(0,0),O=new c(0,0),R=new c(0,0),N=new c(0,0),k=new c(0,0),x=new c(0,0),B=new c(0,0),C=new c(0,0);for(void 0===t&&(t=[new c(1116352408,-685199838),new c(1899447441,602891725),new c(-1245643825,-330482897),new c(-373957723,-2121671748),new c(961987163,-213338824),new c(1508970993,-1241133031),new c(-1841331548,-1357295717),new c(-1424204075,-630357736),new c(-670586216,-1560083902),new c(310598401,1164996542),new c(607225278,1323610764),new c(1426881987,-704662302),new c(1925078388,-226784913),new c(-2132889090,991336113),new c(-1680079193,633803317),new c(-1046744716,-815192428),new c(-459576895,-1628353838),new c(-272742522,944711139),new c(264347078,-1953704523),new c(604807628,2007800933),new c(770255983,1495990901),new c(1249150122,1856431235),new c(1555081692,-1119749164),new c(1996064986,-2096016459),new c(-1740746414,-295247957),new c(-1473132947,766784016),new c(-1341970488,-1728372417),new c(-1084653625,-1091629340),new c(-958395405,1034457026),new c(-710438585,-1828018395),new c(113926993,-536640913),new c(338241895,168717936),new c(666307205,1188179964),new c(773529912,1546045734),new c(1294757372,1522805485),new c(1396182291,-1651133473),new c(1695183700,-1951439906),new c(1986661051,1014477480),new c(-2117940946,1206759142),new c(-1838011259,344077627),new c(-1564481375,1290863460),new c(-1474664885,-1136513023),new c(-1035236496,-789014639),new c(-949202525,106217008),new c(-778901479,-688958952),new c(-694614492,1432725776),new c(-200395387,1467031594),new c(275423344,851169720),new c(430227734,-1194143544),new c(506948616,1363258195),new c(659060556,-544281703),new c(883997877,-509917016),new c(958139571,-976659869),new c(1322822218,-482243893),new c(1537002063,2003034995),new c(1747873779,-692930397),new c(1955562222,1575990012),new c(2024104815,1125592928),new c(-2067236844,-1578062990),new c(-1933114872,442776044),new c(-1866530822,593698344),new c(-1538233109,-561857047),new c(-1090935817,-1295615723),new c(-965641998,-479046869),new c(-903397682,-366583396),new c(-779700025,566280711),new c(-354779690,-840897762),new c(-176337025,-294727304),new c(116418474,1914138554),new c(174292421,-1563912026),new c(289380356,-1090974290),new c(460393269,320620315),new c(685471733,587496836),new c(852142971,1086792851),new c(1017036298,365543100),new c(1126000580,-1676669620),new c(1288033470,-885112138),new c(1501505948,-60457430),new c(1607167915,987167468),new c(1816402316,1246189591)]),i=0;i<80;i+=1)o[i]=new c(0,0);for(e[n>>5]|=128<<24-(31&n),e[31+(n+128>>10<<5)]=n,a=e.length,i=0;i<a;i+=32){for(h(p,u[0]),h(g,u[1]),h(b,u[2]),h(I,u[3]),h(w,u[4]),h(T,u[5]),h(A,u[6]),h(S,u[7]),r=0;r<16;r+=1)o[r].h=e[i+2*r],o[r].l=e[i+2*r+1];for(r=16;r<80;r+=1)d(x,o[r-2],19),m(B,o[r-2],29),E(C,o[r-2],6),R.l=x.l^B.l^C.l,R.h=x.h^B.h^C.h,d(x,o[r-15],1),d(B,o[r-15],8),E(C,o[r-15],7),O.l=x.l^B.l^C.l,O.h=x.h^B.h^C.h,_(o[r],R,o[r-7],O,o[r-16]);for(r=0;r<80;r+=1)N.l=w.l&T.l^~w.l&A.l,N.h=w.h&T.h^~w.h&A.h,d(x,w,14),d(B,w,18),m(C,w,9),R.l=x.l^B.l^C.l,R.h=x.h^B.h^C.h,d(x,p,28),m(B,p,2),m(C,p,7),O.l=x.l^B.l^C.l,O.h=x.h^B.h^C.h,k.l=p.l&g.l^p.l&b.l^g.l&b.l,k.h=p.h&g.h^p.h&b.h^g.h&b.h,y(l,S,R,N,t[r],o[r]),v(f,O,k),h(S,A),h(A,T),h(T,w),v(w,I,l),h(I,b),h(b,g),h(g,p),v(p,l,f);v(u[0],u[0],p),v(u[1],u[1],g),v(u[2],u[2],b),v(u[3],u[3],I),v(u[4],u[4],w),v(u[5],u[5],T),v(u[6],u[6],A),v(u[7],u[7],S)}for(i=0;i<8;i+=1)s[2*i]=u[i].h,s[2*i+1]=u[i].l;return s}function c(e,t){this.h=e,this.l=t}function h(e,t){e.h=t.h,e.l=t.l}function d(e,t,n){e.l=t.l>>>n|t.h<<32-n,e.h=t.h>>>n|t.l<<32-n}function m(e,t,n){e.l=t.h>>>n|t.l<<32-n,e.h=t.l>>>n|t.h<<32-n}function E(e,t,n){e.l=t.l>>>n|t.h<<32-n,e.h=t.h>>>n}function v(e,t,n){var r=(65535&t.l)+(65535&n.l),i=(t.l>>>16)+(n.l>>>16)+(r>>>16),a=(65535&t.h)+(65535&n.h)+(i>>>16),o=(t.h>>>16)+(n.h>>>16)+(a>>>16);e.l=65535&r|i<<16,e.h=65535&a|o<<16}function _(e,t,n,r,i){var a=(65535&t.l)+(65535&n.l)+(65535&r.l)+(65535&i.l),o=(t.l>>>16)+(n.l>>>16)+(r.l>>>16)+(i.l>>>16)+(a>>>16),s=(65535&t.h)+(65535&n.h)+(65535&r.h)+(65535&i.h)+(o>>>16),c=(t.h>>>16)+(n.h>>>16)+(r.h>>>16)+(i.h>>>16)+(s>>>16);e.l=65535&a|o<<16,e.h=65535&s|c<<16}function y(e,t,n,r,i,a){var o=(65535&t.l)+(65535&n.l)+(65535&r.l)+(65535&i.l)+(65535&a.l),s=(t.l>>>16)+(n.l>>>16)+(r.l>>>16)+(i.l>>>16)+(a.l>>>16)+(o>>>16),c=(65535&t.h)+(65535&n.h)+(65535&r.h)+(65535&i.h)+(65535&a.h)+(s>>>16),u=(t.h>>>16)+(n.h>>>16)+(r.h>>>16)+(i.h>>>16)+(a.h>>>16)+(c>>>16);e.l=65535&o|s<<16,e.h=65535&c|u<<16}this.hex=function(e){return u(i(e))},this.b64=function(e){return g(i(e),n)},this.any=function(e,t){return p(i(e),t)},this.raw=function(e){return i(e)},this.hex_hmac=function(e,t){return u(a(e,t))},this.b64_hmac=function(e,t){return g(a(e,t),n)},this.any_hmac=function(e,t,n){return p(a(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&e,this},this.setPad=function(e){return n=e||n,this},this.setUTF8=function(e){return"boolean"==typeof e&&(r=e),this}},RMD160:function(e){!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase;var t=e&&"string"==typeof e.pad?e.pa:"=",n=!e||"boolean"!=typeof e.utf8||e.utf8,r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],i=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],a=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],l=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];function h(e){return m(E(d(e=n?o(e):e),8*e.length))}function f(e,t){e=n?o(e):e,t=n?o(t):t;var r,i,a=d(e),s=Array(16),c=Array(16);for(a.length>16&&(a=E(a,8*e.length)),r=0;r<16;r+=1)s[r]=909522486^a[r],c[r]=1549556828^a[r];return i=E(s.concat(d(t)),512+8*t.length),m(E(c.concat(i),672))}function m(e){var t,n="",r=32*e.length;for(t=0;t<r;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function E(e,t){var n,o,u,h,d,f,p,g,m,E,b,I,w,T,A=1732584193,S=4023233417,O=2562383102,R=271733878,N=3285377520;for(e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t,h=e.length,u=0;u<h;u+=16){for(d=E=A,f=b=S,p=I=O,g=w=R,m=T=N,o=0;o<=79;o+=1)n=s(d,v(o,f,p,g)),n=s(n,e[u+r[o]]),n=s(n,_(o)),n=s(c(n,a[o]),m),d=m,m=g,g=c(p,10),p=f,f=n,n=s(E,v(79-o,b,I,w)),n=s(n,e[u+i[o]]),n=s(n,y(o)),n=s(c(n,l[o]),T),E=T,T=w,w=c(I,10),I=b,b=n;n=s(S,s(p,w)),S=s(O,s(g,T)),O=s(R,s(m,E)),R=s(N,s(d,b)),N=s(A,s(f,I)),A=n}return[A,S,O,R,N]}function v(e,t,n,r){return 0<=e&&e<=15?t^n^r:16<=e&&e<=31?t&n|~t&r:32<=e&&e<=47?(t|~n)^r:48<=e&&e<=63?t&r|n&~r:64<=e&&e<=79?t^(n|~r):"rmd160_f: j out of range"}function _(e){return 0<=e&&e<=15?0:16<=e&&e<=31?1518500249:32<=e&&e<=47?1859775393:48<=e&&e<=63?2400959708:64<=e&&e<=79?2840853838:"rmd160_K1: j out of range"}function y(e){return 0<=e&&e<=15?1352829926:16<=e&&e<=31?1548603684:32<=e&&e<=47?1836072691:48<=e&&e<=63?2053994217:64<=e&&e<=79?0:"rmd160_K2: j out of range"}this.hex=function(e){return u(h(e))},this.b64=function(e){return g(h(e),t)},this.any=function(e,t){return p(h(e),t)},this.raw=function(e){return h(e)},this.hex_hmac=function(e,t){return u(f(e,t))},this.b64_hmac=function(e,n){return g(f(e,n),t)},this.any_hmac=function(e,t,n){return p(f(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&e,this},this.setPad=function(e){return void 0!==e&&(t=e),this},this.setUTF8=function(e){return"boolean"==typeof e&&(n=e),this}}},t&&"object"==typeof r&&r&&r.global,void 0===(i=function(){return a}.call(t,n,t,e))||(e.exports=i)}()}).call(this,n(27))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var r=n(0),i=n(7),a=n(8);function o(){let t=window.EBATES;return 1500!==t.member.get("rakutenStatusType")?e.ajax({url:Object(a.k)(i.a.MEMBER_R3_UPDATE),type:"POST",data:JSON.stringify({state:1500}),contentType:"application/json",processData:!1,dataType:"json",success:()=>{t.member.set({rakutenStatusType:1500},{event:!1}),t.log({event_type:"R4_Transition_Post",rakutenStatusType:1500})},error:()=>{}}):Promise.resolve()}function s(){let e=window.EBATES,t=()=>{e.member.overlays.get("r3-pre-message")?!e.member.overlays.get("r3-pre-message").get("shown")&&(e.settings.promos.get("r3-pre-message")&&!e.settings.promos.get("r3-pre-message").get("active")||e.member.get("rakutenStatusType")&&200!==e.member.get("rakutenStatusType"))&&(e.member.overlays.remove("r3-pre-message"),e.member.overlays.save()):!e.member.overlays.get("r3-pre-message")&&200===e.member.get("rakutenStatusType")&&e.settings.promos.get("r3-pre-message")&&e.settings.promos.get("r3-pre-message").get("active")&&(e.member.overlays.add({id:"r3-pre-message",category:"R4 Pre Message",view:"RakutenTrasitionView"}),e.log({event_type:"R4 Pre Message Push".replace(/ /g,"_"),rakutenStatusType:e.member.get("rakutenStatusType")}),e.member.overlays.save())};e.member.on("change:rakutenStatusType",t),e.settings.promos.on("add change:active",t),r.default.delay(()=>t(),1500)}}).call(this,n(1))},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));const r=function(){function e(){}return e.prototype.then=function(t,n){const r=new e,a=this.s;if(a){const e=1&a?t:n;if(e){try{i(r,1,e(this.v))}catch(e){i(r,2,e)}return r}return this}return this.o=function(e){try{const a=e.v;1&e.s?i(r,1,t?t(a):a):n?i(r,1,n(a)):i(r,2,a)}catch(e){i(r,2,e)}},r},e}();function i(e,t,n){if(!e.s){if(n instanceof r){if(!n.s)return void(n.o=i.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(i.bind(null,e,t),i.bind(null,e,2));e.s=t,e.v=n;const a=e.o;a&&a(e)}}var a=0,o="function"==typeof WeakMap?WeakMap:function(){var e="function"==typeof Symbol?Symbol(0):"__weak$"+ ++a;this.set=function(t,n){t[e]=n},this.get=function(t){return t[e]}};function s(e,t){return new Promise((function(n,r){e.onsuccess=function(){var r=e.result;t&&(r=t(r)),n(r)},e.onerror=function(){r(e.error)}}))}function c(e,t){return s(e.openCursor(t),(function(e){return e?[e.key,e.value]:[]}))}function u(e){return new Promise((function(t,n){e.oncomplete=function(){t()},e.onabort=function(){n(e.error)},e.onerror=function(){n(e.error)}}))}function l(e){if(!function(e){if("number"==typeof e||"string"==typeof e)return!0;if("object"==typeof e&&e){if(Array.isArray(e))return!0;if("setUTCFullYear"in e)return!0;if("function"==typeof ArrayBuffer&&ArrayBuffer.isView(e))return!0;if("byteLength"in e&&"length"in e)return!0}return!1}(e))throw Error("kv-storage: The given value is not allowed as a key")}var h={};function d(e,t){return c(e,f(t))}function f(e){return e===h?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(e,!0)}var p=new o,g=new o,m=new o,E=new o,v=function(){};function _(e,t){return t((function(t,n){try{function a(){return g.set(e,s),m.set(e,void 0),{value:l,done:void 0===s}}var o=g.get(e);if(void 0===o)return Promise.resolve({value:void 0,done:!0});var s,u,l,h=function(e,t){var n,a=-1;e:{for(var o=0;o<t.length;o++){var s=t[o][0];if(s){var c=s();if(c&&c.then)break e;if(c===e){a=o;break}}else a=o}if(-1!==a){do{for(var u=t[a][1];!u;)u=t[++a][1];var l=u();if(l&&l.then){n=!0;break e}var h=t[a][2];a++}while(h&&!h());return l}}const d=new r,f=i.bind(null,d,2);return(n?l.then(p):c.then((function n(r){for(;;){if(r===e){a=o;break}if(++o===t.length){if(-1!==a)break;return void i(d,1,u)}if(s=t[o][0]){if((r=s())&&r.then)return void r.then(n).then(void 0,f)}else a=o}do{for(var c=t[a][1];!c;)c=t[++a][1];var u=c();if(u&&u.then)return void u.then(p).then(void 0,f);var l=t[a][2];a++}while(l&&!l());i(d,1,u)}))).then(void 0,f),d;function p(e){for(;;){var n=t[a][2];if(!n||n())break;for(var r=t[++a][1];!r;)r=t[++a][1];if((e=r())&&e.then)return void e.then(p).then(void 0,f)}i(d,1,e)}}(E.get(e),[[function(){return"keys"},function(){return Promise.resolve(function(e,t){return c(e,f(t)).then((function(e){return e[0]}))}(n,o)).then((function(e){l=s=e}))}],[function(){return"values"},function(){return Promise.resolve(d(n,o)).then((function(e){var t;s=(t=e)[0],l=u=t[1]}))}],[function(){return"entries"},function(){return Promise.resolve(d(n,o)).then((function(e){var t;u=(t=e)[1],l=void 0===(s=t[0])?void 0:[s,u]}))}]]);return Promise.resolve(h&&h.then?h.then(a):a())}catch(e){return Promise.reject(e)}}))}function y(e,t){var n=new v;return E.set(n,e),p.set(n,t),g.set(n,h),m.set(n,void 0),n}v.prototype.return=function(){g.set(this,void 0)},v.prototype.next=function(){var e=this,t=p.get(this);if(!t)return Promise.reject(new TypeError("Invalid this value"));var n,r=m.get(this);return n=void 0!==r?r.then((function(){return _(e,t)})):_(this,t),m.set(this,n),n},"function"==typeof Symbol&&Symbol.asyncIterator&&(v.prototype[Symbol.asyncIterator]=function(){return this});var b=function(e,t,n){try{return null===w.get(e)&&function(e){var t=I.get(e);w.set(e,new Promise((function(n,r){var i=self.indexedDB.open(t,1);i.onsuccess=function(){var a=i.result;(function(e,t,n){if(1!==e.objectStoreNames.length)return n(S(t)),!1;if(e.objectStoreNames[0]!==T)return n(S(t)),!1;var r=e.transaction(T,"readonly").objectStore(T);return!(r.autoIncrement||r.keyPath||r.indexNames.length)||(n(S(t)),!1)})(a,t,r)&&(a.onclose=function(){w.set(e,null)},a.onversionchange=function(){a.close(),w.set(e,null)},n(a))},i.onerror=function(){return r(i.error)},i.onupgradeneeded=function(){try{i.result.createObjectStore(T)}catch(e){r(e)}}})))}(e),Promise.resolve(w.get(e)).then((function(e){var r=e.transaction(T,t),i=r.objectStore(T);return n(r,i)}))}catch(e){return Promise.reject(e)}},I=new o,w=new o,T="store",A=function(e){var t="kv-storage:"+e;w.set(this,null),I.set(this,t),this.backingStore={database:t,store:T,version:1}};function S(e){return new Error('kv-storage: database "'+e+'" corrupted')}A.prototype.set=function(e,t){try{return l(e),b(this,"readwrite",(function(n,r){return void 0===t?r.delete(e):r.put(t,e),u(n)}))}catch(e){return Promise.reject(e)}},A.prototype.get=function(e){try{return l(e),b(this,"readonly",(function(t,n){return s(n.get(e))}))}catch(e){return Promise.reject(e)}},A.prototype.delete=function(e){try{return l(e),b(this,"readwrite",(function(t,n){return n.delete(e),u(t)}))}catch(e){return Promise.reject(e)}},A.prototype.clear=function(){try{var e=this;function t(){function t(){return s(self.indexedDB.deleteDatabase(I.get(e)))}var r=function(){if(n){try{n.close()}catch(e){}return Promise.resolve(new Promise(setTimeout)).then((function(){}))}}();return r&&r.then?r.then(t):t()}var n,r=w.get(e),i=function(){if(null!==r){function t(){w.set(e,null)}var i=function(e,t){try{var i=Promise.resolve(r).then((function(e){n=e}))}catch(e){return}return i&&i.then?i.then(void 0,(function(){})):i}();return i&&i.then?i.then(t):t()}}();return i&&i.then?i.then(t):t()}catch(e){return Promise.reject(e)}},A.prototype.keys=function(){var e=this;return y("keys",(function(t){return b(e,"readonly",t)}))},A.prototype.values=function(){var e=this;return y("values",(function(t){return b(e,"readonly",t)}))},A.prototype.entries=function(){var e=this;return y("entries",(function(t){return b(e,"readonly",t)}))},"function"==typeof Symbol&&Symbol.asyncIterator&&(A.prototype[Symbol.asyncIterator]=A.prototype.entries);var O=new A("default"),R=n(46),N=n.n(R);class k extends N.a{constructor(){super()}get url(){throw new Error("You have to implement the method url!")}get headers(){return{}}parse(e){return e}data(){return this._data}async _verifyInternalCache(){const{data:e,meta:t}=await O.get(this._id)||{};if(t){if(t.date&&this.UPDATE_INTERVAL&&Date.now()>t.date+this.UPDATE_INTERVAL)throw new Error("Data expired");return e}throw new Error("Invalid cache")}async load(){try{return await this._verifyInternalCache()}catch(e){return await this.fetch()}}async save(e,t){return await O.set(this._id,{data:e,meta:t})}async fetch(){this.emit("request",this);let e=await fetch(this.url,{method:"GET",mode:"cors",headers:this.headers});if(e.ok){let t=await e.json(),n={date:Date.now(),headers:["cache-control","etag","date"].reduce((t,n)=>(t[n]=e.headers.get(n),t),{})},r=this.parse(t);return this.save(r,n),this.emit("sync",this),r}throw new Error("Network response was not ok")}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return S}));var r=n(0),i=n(1),a=n.n(i),o=n(2),s=n(56),c=n.n(s),u=n(32),l=n(7),h=n(177),d=n(178),f=n(236),p=n(235),g=n(182),m=n(183),E=n(190),v=n(191),_=n(192),y=n(78),b=n(24),I=n(8),w=n(193);n(319),n(320);window.installVersion=null,window.toolbarId=null;var T=e.EBATES,A=!1;o.a.browser.isChrome&&browser.runtime.onInstalled.addListener(e=>{"install"===e.reason&&(A=!0)});class S{constructor(e){this.sessionData={},this.ebToken=e,a.a.ajaxSetup({headers:{"X-Button-Version":o.a.extension.version},beforeSend:(e,t)=>{t.url.search(/(?!button|mobile|eds)\/member/)>0&&e.setRequestHeader("ebToken",this.ebToken)}}),this.trackingTicketNumber=null,this.sessionReward=null,this.badge=new h.a,this.merchants=new f.a;let t=null;if(e){t=Object(I.d)(e).mId}this.member=new m.a({id:t}),b.a.userId=t,this.settings=new p.a,this.icon=new g.a,this.hotels=new E.a,this.ebatesPromo=new v.a,this.hotelsPromo=new _.a,o.a.extension.attachEvent("openOptionsPage",()=>{o.a.ui.settings.open()}),window.setInterval(()=>T.ping(),36e5)}get loggedIn(){return!!this.ebToken}initMembers(){return this.tests=new d.a,this.tests.onReady()}validateUserToken(){return new Promise(e=>{this.ebToken?e(this.ebToken):browser.cookies.get({url:"https://".concat(l.a.domain),name:"euid"}).then(t=>{t?(this.ebToken=t.value,o.a.extension.setItem("ebToken",T.ebToken),e(t.value)):e()})})}async init(e=null){try{await this.settings.load(),await this.settings.fetch()}catch(e){}if(await this.validateUserToken()){o.a.ui.button.detachEvent(o.a.ui.button.CLICK,O),o.a.ui.button.setPopup({url:"./popup/popup.html",width:380,height:493});try{await this.member.fetch(e)}catch(e){}this.member.isExtensionDisabled()||this.merchants.fetch().catch(()=>{}),this.ping()}else this.merchants.fetch().catch(()=>{}),o.a.ui.button.setPopup(),o.a.ui.button.attachEvent(o.a.ui.button.CLICK,O);this.settings.userSettings.toggleLogging(),this.setUninstallURL()}activate(e,t){const{sessionReward:n,trackingTicketNumber:i,partner:a,sessionInterval:o}=t;if(e.set({state:"activated",activationPartner:a,sessionInterval:o,ttn:i||e.get("ttn")}),n&&(n.amount||n.range)){let t=e.get("reward")&&e.get("reward").total;t&&!r.default.isEqual(t,n)?e.set({sessionReward:n}):e.unset("sessionReward")}else e.unset("sessionReward")}ping(){o.a.extension.getItem("ga_usage",e=>{var t=new Date(parseInt(e||0,10)),n=new Date;n.toDateString()!==t.toDateString()&&(o.a.extension.setItem("ga_usage",n.getTime().toString()),this.log({event_type:"heartbeat",button_version:o.a.extension.version,browser_type:o.a.browser.name}),b.b.track("Heartbeat Application"),T.settings.userSettings.get("logging")&&this.log({event_type:"FF_tracking",type:T.settings.userSettings.get("logging"),button_version:o.a.extension.version,browser_type:o.a.browser.name}))})}onTokenExpired(){T.member.set({accessLevel:0})}onTokenChanged(e){if(e&&e!==this.ebToken){let t=Object(I.d)(e);if(t){let n=this.ebToken&&Object(I.d)(this.ebToken);if(n&&n.llt&&n.mId&&t&&!t.llt&&t.mId===n.mId)return;u.a.logger.info("login",t),this.ebToken=e,o.a.extension.setItem("ebToken",this.ebToken),this.init({reset:!0})}}}setUninstallURL(){new Promise((e,t)=>{browser.management&&browser.management.getSelf?browser.management.getSelf().then(n=>{"normal"===n.installType?e():t()}):e()}).then(()=>{browser.runtime.setUninstallURL&&browser.runtime.setUninstallURL(Object(I.k)(l.a.WEB_UNINSTALL))},()=>{})}set(e,t){o.a.extension.setItem(e,t)}}function O(e){let t=o.a.browser.NEWTAB,n="";e.data&&"getLogonForm"===e.data.name?n=Object(I.k)(l.a.WEB_LOGON_FORM):(n=Object(I.k)(l.a.WEB_LOGIN),e.data&&e.data.merchant&&e.data.merchant.storeId&&(n=n+="&merchant_id=".concat(e.data.merchant.storeId),t=o.a.browser.CURRENTTAB)),b.b.track("Visit Page",{preceding_screen_name:"ButtonClick"===e.name?"Icon":"Hover",url:n}),o.a.browser.navigate({url:n,tabId:t})}o.a.browser.attachEvent(o.a.browser.DOCUMENTCOMPLETE,({url:e})=>{e&&/^http.*(?:rakuten|ebates)\.(?:com|int)\//.test(e)&&browser.cookies.get({url:e,name:"euid"}).then(e=>{e&&T.onTokenChanged(e.value)})}),o.a.browser.attachEvent(o.a.browser.BEFORENAVIGATE,({url:e,tabId:t})=>{T&&e&&T.settings.affiliates.match(e,t)}),o.a.extension.attachEvent("ebToken",({data:e})=>{T&&T.onTokenChanged(e)}),o.a.extension.attachEvent("sessionStorage",(function({data:e},t){"string"==typeof e.name&&(window.browserSessionStorage||(window.browserSessionStorage={}),void 0!==e.value?window.browserSessionStorage[e.name]=e.value:t(window.browserSessionStorage[e.name]))})),o.a.extension.getItem(["toolbarId","domain","api","member_api","installVersion","currentVersion","uiid"],(function(t){t.domain&&(l.a.domain=t.domain),t.api&&(l.a.api=t.api),t.member_api&&(l.a.member_api=t.member_api),t.uiid||(t.uiid=c()(),o.a.extension.setItem("uiid",t.uiid)),b.b.setAnonymousId(t.uiid),t.toolbarId?(window.toolbarId=t.toolbarId,b.b.set({toolbarid:window.toolbarId}),window.installVersion=t.installVersion||"4.0.0.0",t.currentVersion!==o.a.extension.version&&(b.b.track("Update Application"),o.a.extension.setItem("currentVersion",o.a.extension.version))):(o.a.browser.isChrome||(A=!0),window.toolbarId=Math.floor(1e9*Math.random(1)),window.installVersion=o.a.extension.version,o.a.extension.setItem("toolbarId",window.toolbarId),o.a.extension.setItem("installVersion",o.a.extension.version),o.a.extension.setItem("currentVersion",o.a.extension.version),o.a.extension.setItem("notification-explanation",0),b.b.set({toolbarid:window.toolbarId})),b.a.toolbarId=window.toolbarId,u.a.addLoggerGlobalContext("button",{toolbarId:window.toolbarId,version:t.currentVersion,installVersion:t.installVersion}),o.a.extension.getItem("ebToken").then(e=>e||Object(I.e)("www.rakuten.com","euid")).catch(()=>null).then(t=>{T=e.EBATES=new S(t)}).then(()=>T.initMembers()).then(()=>{T.init(),Object(y.b)()}).catch(()=>{}).then(()=>{var e;browser.cookies.set({domain:"rakuten.com",url:Object(I.k)(l.a.BASE),name:"toolbarId",value:null===(e=window.toolbarId)||void 0===e?void 0:e.toString()}),A&&Object(w.a)()})})),o.a.extension.attachEvent("login",O),o.a.extension.attachEvent("encodeImageURI",({data:e},t)=>{var n;(n=e,fetch(n).then(e=>e.blob()).then(e=>new Promise((t,n)=>{const r=new FileReader;r.onloadend=()=>t(r.result),r.onerror=n,r.readAsDataURL(e)}))).then(t)});const R=new Map;o.a.extension.attachEvent("getContent",async({data:e},t)=>{if(R.has(e.file))t(R.get(e.file));else{const n=await fetch(e.file);let r=await n.text();o.a.browser.isLegacyEdge&&(r=r.replace(/__MSG_@@extension_id__/g,browser.runtime.id)),R.set(e.file,r),t(r)}}),browser.runtime.onConnect.addListener(()=>{}),browser.webNavigation&&browser.webNavigation.onCommitted.addListener((function(e){if("typed"===e.transitionType&&0!==e.url.search(/https?:\/\/\w+\.rakuten\.com\//)&&T&&T.merchants){T.settings.affiliates.clear(e.tabId);let t=T.merchants.match(e.url);t&&t.has("state")&&"shopstyle"!==t.get("activationPartner")&&t.unset("state")}}))}).call(this,n(27))},function(e,t,n){"use strict";(function(e,r){n.d(t,"a",(function(){return d}));const i=n(301),a=n(302),o=n(314),s=n(56),c=n(315),u=n(318),l=e.setImmediate||r.nextTick.bind(r),h=()=>{};class d{constructor(e,t){t=t||{},this.queue=[],this.writeKey=e,this.host=i(t.host||"https://api.segment.io"),this.timeout=t.timeout||!1,this.flushAt=Math.max(t.flushAt,1)||20,this.flushInterval=t.flushInterval||1e4,this.flushed=!1,this.defaultContext=t.context,this.defaultProperties=t.properties,this._sessionId=null,Object.defineProperty(this,"enable",{configurable:!1,writable:!1,enumerable:!0,value:"boolean"!=typeof t.enable||t.enable})}set(e){Object.assign(this.defaultProperties,e)}setAnonymousId(e){return this.anonymousId=e,this}async startSesssion(e){this._sessionId=e}async endSession(){this._sessionId=null}async validateSession(){const e=(new Date).getTime();if(window.clearInterval(this._sessionTimeout),!this._sessionId)try{this.startSesssion(e)}catch(e){}this._sessionId&&(this._sessionTimeout=window.setInterval(()=>this.endSession(),18e5))}reset(){this.flush(),this._sessionId=null}_validate(e,t){try{a(e,t)}catch(e){if("Your message must be < 32kb."===e.message)return;throw e}}identify(e,t,n,r){this.userId=e;let i={userId:e,anonymousId:this.anonymousId,traits:t};return this._validate(i,"identify"),this.enqueue("identify",i,r),this}group(e,t){return this._validate(e,"group"),this.enqueue("group",e,t),this}track(e,t,n){t=Object.assign({},t,this.defaultProperties);let r={userId:this.userId,anonymousId:this.anonymousId,event:e,properties:t};return this._validate(r,"track"),this.enqueue("track",r,n),this}page(e,t){return this._validate(e,"page"),this.enqueue("page",e,t),this}screen(e,t){return this._validate(e,"screen"),this.enqueue("screen",e,t),this}alias(e,t){return this._validate(e,"alias"),this.enqueue("alias",e,t),this}enqueue(e,t,n){return n=n||h,this.enable?((t=Object.assign({},t)).type=e,t.context=Object.assign({library:{name:"analytics-webextensions",version:"0.0.10"}},this.defaultContext,t.context),t._metadata=Object.assign({nodeVersion:r.versions.node},t._metadata),t.timestamp||(t.timestamp=new Date),t.messageId||(t.messageId="".concat(c(JSON.stringify(t)),"-").concat(s())),t.anonymousId&&!u(t.anonymousId)&&(t.anonymousId=JSON.stringify(t.anonymousId)),t.userId&&!u(t.userId)&&(t.userId=JSON.stringify(t.userId)),this._sessionId&&(t.integrations={Amplitude:{session_id:this._sessionId}},t.properties&&(t.properties={session_id:this._sessionId,...t.properties})),this.queue.push({message:t,callback:n}),this.flushed?(this.queue.length>=this.flushAt&&this.flush(),void(this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval)))):(this.flushed=!0,void this.flush())):l(n)}flush(e){if(e=e||h,!this.enable)return l(e);if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.queue.length)return l(e);const t=this.queue.splice(0,this.flushAt),n=t.map(e=>e.callback),r={batch:t.map(e=>e.message),timestamp:new Date,sentAt:new Date},i=t=>{n.forEach(e=>e(t)),e(t,r)},a={method:"POST",headers:{Authorization:"Basic ".concat(btoa(this.writeKey+":")),"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)};this.timeout&&(a.timeout="string"==typeof this.timeout?o(this.timeout):this.timeout),fetch("".concat(this.host,"/v1/batch"),a).then(()=>i()).catch(e=>{if(e.response){const t=new Error(e.response.statusText);return i(t)}i(e)})}}}).call(this,n(27),n(64))},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_UPDATE_INTERVAL=3e5,t.MIN_UPDATE_INTERVAL=1e3,t.DEFAULT_URL_TEMPLATE="https://cdn.optimizely.com/datafiles/%s.json",t.DEFAULT_AUTHENTICATED_URL_TEMPLATE="https://config.optimizely.com/datafiles/auth/%s.json",t.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT=[0,8,16,32,64,128,256,512],t.REQUEST_TIMEOUT_MS=6e4},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(49),a=n(286),o=n(66),s=n(294),c=(r=n(300))&&"object"==typeof r&&"default"in r?r.default:r,u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function l(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var h={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},d={CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_CONFIG:"%s: Provided Optimizely config is in an invalid format.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},f={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_KEY_NOT_FOUND:"%s: Event key %s is not in datafile.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned bucket %s to user with bucketing ID %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s bucketed into everyone targeting rule.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning the default variable value "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Got variable value "%s" for variable "%s" of feature flag "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for %s "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for %s %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},p={REVENUE:"revenue",VALUE:"value"},g={BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent"},m=["node-sdk","react-sdk","javascript-sdk"],E=o.NOTIFICATION_TYPES,v={AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable",ALL_FEATURE_VARIABLES:"all-feature-variables"},_={FEATURE_TEST:"feature-test",ROLLOUT:"rollout",EXPERIMENT:"experiment"},y={RULE:"rule",EXPERIMENT:"experiment"},b={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string",JSON:"json"},I={V2:"2",V3:"3",V4:"4"},w=Object.freeze({__proto__:null,LOG_LEVEL:h,ERROR_MESSAGES:d,LOG_MESSAGES:f,RESERVED_EVENT_KEYWORDS:p,CONTROL_ATTRIBUTES:g,JAVASCRIPT_CLIENT_ENGINE:"javascript-sdk",NODE_CLIENT_ENGINE:"node-sdk",REACT_CLIENT_ENGINE:"react-sdk",NODE_CLIENT_VERSION:"4.4.1",VALID_CLIENT_ENGINES:m,NOTIFICATION_TYPES:E,DECISION_NOTIFICATION_TYPES:v,DECISION_SOURCES:_,AUDIENCE_EVALUATION_TYPES:y,FEATURE_VARIABLE_TYPES:b,DATAFILE_VERSIONS:I}),T="CONFIG_VALIDATOR",A=[I.V2,I.V3,I.V4],S=function(e){if("object"==typeof e&&null!==e){if(e.errorHandler&&"function"!=typeof e.errorHandler.handleError)throw new Error(o.sprintf(d.INVALID_ERROR_HANDLER,T));if(e.eventDispatcher&&"function"!=typeof e.eventDispatcher.dispatchEvent)throw new Error(o.sprintf(d.INVALID_EVENT_DISPATCHER,T));if(e.logger&&"function"!=typeof e.logger.log)throw new Error(o.sprintf(d.INVALID_LOGGER,T));return!0}throw new Error(o.sprintf(d.INVALID_CONFIG,T))},O={handleError:function(){}},R={dispatchEvent:function(e,t){var n,r=e.url,i=e.params;"POST"===e.httpVerb?((n=new XMLHttpRequest).open("POST",r,!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(4===n.readyState&&t&&"function"==typeof t)try{t({statusCode:n.status})}catch(e){}},n.send(JSON.stringify(i))):(r+="?wxhr=true",i&&(r+="&"+function(e){return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}(i)),(n=new XMLHttpRequest).open("GET",r,!0),n.onreadystatechange=function(){if(4===n.readyState&&t&&"function"==typeof t)try{t()}catch(e){}},n.send())}};function N(){}N.prototype.log=function(){};var k={createLogger:function(e){return new i.ConsoleLogHandler(e)},createNoOpLogger:function(){return new N}},x=Math.pow(2,53),B={assign:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!e)return{};if("function"==typeof Object.assign)return Object.assign.apply(Object,l([e],t));for(var r=Object(e),i=0;i<t.length;i++){var a=t[i];if(null!=a)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(r[o]=a[o])}return r},currentTimestamp:function(){return Math.round((new Date).getTime())},isSafeInteger:function(e){return"number"==typeof e&&Math.abs(e)<=x},keyBy:function(e,t){return e?o.keyBy(e,(function(e){return e[t]})):{}},uuid:o.generateUUID,isNumber:function(e){return"number"==typeof e}},C="PROJECT_CONFIG",D=function(e,t){void 0===t&&(t=null);var n,r,i=(n=e,(r=B.assign({},n)).audiences=(n.audiences||[]).map((function(e){return B.assign({},e)})),r.experiments=(n.experiments||[]).map((function(e){return B.assign({},e)})),r.featureFlags=(n.featureFlags||[]).map((function(e){return B.assign({},e)})),r.groups=(n.groups||[]).map((function(e){var t=B.assign({},e);return t.experiments=(e.experiments||[]).map((function(e){return B.assign({},e)})),t})),r.rollouts=(n.rollouts||[]).map((function(e){var t=B.assign({},e);return t.experiments=(e.experiments||[]).map((function(e){return B.assign({},e)})),t})),r);return i.__datafileStr=null===t?JSON.stringify(e):t,(i.audiences||[]).forEach((function(e){e.conditions=JSON.parse(e.conditions)})),i.audiencesById=B.keyBy(i.audiences,"id"),B.assign(i.audiencesById,B.keyBy(i.typedAudiences,"id")),i.attributeKeyMap=B.keyBy(i.attributes,"key"),i.eventKeyMap=B.keyBy(i.events,"key"),i.groupIdMap=B.keyBy(i.groups,"id"),Object.keys(i.groupIdMap||{}).forEach((function(e){(i.groupIdMap[e].experiments||[]).forEach((function(t){i.experiments.push(B.assign(t,{groupId:e}))}))})),i.rolloutIdMap=B.keyBy(i.rollouts||[],"id"),o.objectValues(i.rolloutIdMap||{}).forEach((function(e){(e.experiments||[]).forEach((function(e){i.experiments.push(e),e.variationKeyMap=B.keyBy(e.variations,"key")}))})),i.experimentKeyMap=B.keyBy(i.experiments,"key"),i.experimentIdMap=B.keyBy(i.experiments,"id"),i.variationIdMap={},i.variationVariableUsageMap={},(i.experiments||[]).forEach((function(e){e.variationKeyMap=B.keyBy(e.variations,"key"),B.assign(i.variationIdMap,B.keyBy(e.variations,"id")),o.objectValues(e.variationKeyMap||{}).forEach((function(e){e.variables&&(i.variationVariableUsageMap[e.id]=B.keyBy(e.variables,"id"))}))})),i.experimentFeatureMap={},i.featureKeyMap=B.keyBy(i.featureFlags||[],"key"),o.objectValues(i.featureKeyMap||{}).forEach((function(e){e.variables.forEach((function(e){e.type===b.STRING&&e.subType===b.JSON&&(e.type=b.JSON,delete e.subType)})),e.variableKeyMap=B.keyBy(e.variables,"key"),(e.experimentIds||[]).forEach((function(t){i.experimentFeatureMap[t]?i.experimentFeatureMap[t].push(e.id):i.experimentFeatureMap[t]=[e.id];var n=i.experimentIdMap[t];n.groupId&&!e.groupId&&(e.groupId=n.groupId)}))})),i},L=function(e,t){var n=e.experimentKeyMap[t];if(!n)throw new Error(o.sprintf(d.INVALID_EXPERIMENT_KEY,C,t));return n.id},U=function(e,t){var n=e.experimentKeyMap[t];if(!n)throw new Error(o.sprintf(d.INVALID_EXPERIMENT_KEY,C,t));return n.status},P=function(e,t,n){var r=e.experimentKeyMap[t];return r.variationKeyMap.hasOwnProperty(n)?r.variationKeyMap[n].id:null},M=function(e,t){if(e.experimentKeyMap.hasOwnProperty(t)){var n=e.experimentKeyMap[t];if(n)return n}throw new Error(o.sprintf(d.EXPERIMENT_KEY_NOT_IN_DATAFILE,C,t))},F=function(e,t,n){if(e.featureKeyMap.hasOwnProperty(t)){var r=e.featureKeyMap[t];if(r)return r}return n.log(h.ERROR,o.sprintf(d.FEATURE_NOT_IN_DATAFILE,C,t)),null},j=function(e,t,n,r){var i=e.featureKeyMap[t];return i?i.variableKeyMap[n]||(r.log(h.ERROR,o.sprintf(d.VARIABLE_KEY_NOT_IN_DATAFILE,C,n,t)),null):(r.log(h.ERROR,o.sprintf(d.FEATURE_NOT_IN_DATAFILE,C,t)),null)},V=function(e,t,n,r){if(!t||!n)return null;if(!e.variationVariableUsageMap.hasOwnProperty(n.id))return r.log(h.ERROR,o.sprintf(d.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,C,n.id)),null;var i=e.variationVariableUsageMap[n.id][t.id];return i?i.value:null},z=function(e,t,n){var r;switch(t){case b.BOOLEAN:"true"!==e&&"false"!==e?(n.log(h.ERROR,o.sprintf(d.UNABLE_TO_CAST_VALUE,C,e,t)),r=null):r="true"===e;break;case b.INTEGER:r=parseInt(e,10),isNaN(r)&&(n.log(h.ERROR,o.sprintf(d.UNABLE_TO_CAST_VALUE,C,e,t)),r=null);break;case b.DOUBLE:r=parseFloat(e),isNaN(r)&&(n.log(h.ERROR,o.sprintf(d.UNABLE_TO_CAST_VALUE,C,e,t)),r=null);break;case b.JSON:try{r=JSON.parse(e)}catch(i){n.log(h.ERROR,o.sprintf(d.UNABLE_TO_CAST_VALUE,C,e,t)),r=null}break;default:r=e}return r},G=function(e,t){return e.experimentFeatureMap.hasOwnProperty(t)},H=L,K=function(e,t){var n=e.experimentIdMap[t];if(!n)throw new Error(o.sprintf(d.INVALID_EXPERIMENT_ID,C,t));return n.layerId},J=function(e,t,n){var r=e.attributeKeyMap[t],i=0===t.indexOf("$opt_");return r?(i&&n.log(h.WARN,o.sprintf("Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",t,"$opt_")),r.id):i?t:(n.log(h.DEBUG,o.sprintf(d.UNRECOGNIZED_ATTRIBUTE,C,t)),null)},Y=function(e,t){var n=e.eventKeyMap[t];return n?n.id:null},q=function(e,t){var n=e.experimentKeyMap[t];if(!n)throw new Error(o.sprintf(d.INVALID_EXPERIMENT_KEY,C,t));return n.audienceConditions||n.audienceIds},W=function(e,t){return e.variationIdMap.hasOwnProperty(t)?e.variationIdMap[t].key:null},X=P,Z=M,$=function(e,t){var n=e.experimentKeyMap[t];if(!n)throw new Error(o.sprintf(d.INVALID_EXPERIMENT_KEY,C,t));return n.trafficAllocation},Q=function(e,t,n){if(e.experimentIdMap.hasOwnProperty(t)){var r=e.experimentIdMap[t];if(r)return r}return n.log(h.ERROR,o.sprintf(d.INVALID_EXPERIMENT_ID,C,t)),null},ee=function(e){return e.__datafileStr},te=function(e){var t;try{t=function(e){if(!e)throw new Error(o.sprintf(d.NO_DATAFILE_SPECIFIED,T));if("string"==typeof e)try{e=JSON.parse(e)}catch(e){throw new Error(o.sprintf(d.INVALID_DATAFILE_MALFORMED,T))}if("object"==typeof e&&!Array.isArray(e)&&null!==e&&-1===A.indexOf(e.version))throw new Error(o.sprintf(d.INVALID_DATAFILE_VERSION,T,e.version));return e}(e.datafile)}catch(e){return{configObj:null,error:e}}if(e.jsonSchemaValidator)try{e.jsonSchemaValidator.validate(t),e.logger.log(h.INFO,o.sprintf(f.VALID_DATAFILE,C))}catch(e){return{configObj:null,error:e}}else e.logger.log(h.INFO,o.sprintf(f.SKIPPING_JSON_VALIDATION,C));var n=[t];return"string"==typeof e.datafile&&n.push(e.datafile),{configObj:D.apply(void 0,n),error:null}};function ne(e,t,n,r){var i=e.experimentFeatureMap[n],a={};if(i){var o=r[i],s=(t.variables||[]).reduce((function(e,t){return e[t.id]={id:t.id,value:t.value},e}),{});a=(o||[]).reduce((function(e,n){var r=s[n.id],i=t.featureEnabled&&r?r.value:n.defaultValue;return e[n.key]={id:n.id,key:n.key,type:n.type,value:i},e}),{})}return a}function re(e,t){this.experimentsMap=function(e){var t=(e.rollouts||[]).reduce((function(e,t){return t.experiments.forEach((function(t){e[t.id]=!0})),e}),{}),n=(e.featureFlags||[]).reduce((function(e,t){return e[t.id]=t.variables,e}),{});return(e.experiments||[]).reduce((function(r,i){return t[i.id]||(r[i.key]={id:i.id,key:i.key,variationsMap:(i.variations||[]).reduce((function(t,r){return t[r.key]={id:r.id,key:r.key,variablesMap:ne(e,r,i.id,n)},G(e,i.id)&&(t[r.key].featureEnabled=r.featureEnabled),t}),{})}),r}),{})}(e),this.featuresMap=function(e,t){return(e.featureFlags||[]).reduce((function(n,r){return n[r.key]={id:r.id,key:r.key,experimentsMap:(r.experimentIds||[]).reduce((function(n,r){var i=e.experimentIdMap[r].key;return n[i]=t[i],n}),{}),variablesMap:(r.variables||[]).reduce((function(e,t){return e[t.key]={id:t.id,key:t.key,type:t.type,value:t.defaultValue},e}),{})},n}),{})}(e,this.experimentsMap),this.revision=e.revision,this.__datafile=t}re.prototype.getDatafile=function(){return this.__datafile};var ie={OptimizelyConfig:re},ae=i.getLogger();function oe(e,t){return e instanceof Error?e.message:t||"Unknown error"}function se(e){try{this.__initialize(e)}catch(e){ae.error(e),this.__updateListeners=[],this.__configObj=null,this.__optimizelyConfigObj=null,this.__readyPromise=Promise.resolve({success:!1,reason:oe(e,"Error in initialize")})}}function ce(e){this.logger=e.logger,this.errorHandler=e.errorHandler,this.__notificationListeners={},o.objectValues(E).forEach(function(e){this.__notificationListeners[e]=[]}.bind(this)),this.__listenerId=1}se.prototype.__initialize=function(e){if(this.__updateListeners=[],this.jsonSchemaValidator=e.jsonSchemaValidator,!e.datafile&&!e.sdkKey){this.__configObj=null;var t=new Error(o.sprintf(d.DATAFILE_AND_SDK_KEY_MISSING,"PROJECT_CONFIG_MANAGER"));return this.__readyPromise=Promise.resolve({success:!1,reason:oe(t)}),void ae.error(t)}var n;if(e.datafile?(n=this.__handleNewDatafile(e.datafile))&&(this.__configObj=null):this.__configObj=null,e.sdkKey){var r={sdkKey:e.sdkKey};this.__validateDatafileOptions(e.datafileOptions)&&B.assign(r,e.datafileOptions),this.__configObj&&(r.datafile=ee(this.__configObj)),this.datafileManager=new s.HttpPollingDatafileManager(r),this.datafileManager.start(),this.__readyPromise=this.datafileManager.onReady().then(this.__onDatafileManagerReadyFulfill.bind(this),this.__onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.__onDatafileManagerUpdate.bind(this))}else this.__configObj?this.__readyPromise=Promise.resolve({success:!0}):this.__readyPromise=Promise.resolve({success:!1,reason:oe(n,"Invalid datafile")})},se.prototype.__onDatafileManagerReadyFulfill=function(){var e=this.__handleNewDatafile(this.datafileManager.get());return e?{success:!1,reason:oe(e)}:{success:!0}},se.prototype.__onDatafileManagerReadyReject=function(e){return{success:!1,reason:oe(e,"Failed to become ready")}},se.prototype.__onDatafileManagerUpdate=function(){this.__handleNewDatafile(this.datafileManager.get())},se.prototype.__validateDatafileOptions=function(e){return void 0===e||"object"==typeof e&&null!==e},se.prototype.__handleNewDatafile=function(e){var t=te({datafile:e,jsonSchemaValidator:this.jsonSchemaValidator,logger:ae}),n=t.configObj,r=t.error;return r?ae.error(r):(this.__configObj?this.__configObj.revision:"null")!==n.revision&&(this.__configObj=n,this.__optimizelyConfigObj=new ie.OptimizelyConfig(this.__configObj,ee(this.__configObj)),this.__updateListeners.forEach((function(e){e(n)}))),r},se.prototype.getConfig=function(){return this.__configObj},se.prototype.getOptimizelyConfig=function(){return this.__optimizelyConfigObj},se.prototype.onReady=function(){return this.__readyPromise},se.prototype.onUpdate=function(e){return this.__updateListeners.push(e),function(){var t=this.__updateListeners.indexOf(e);t>-1&&this.__updateListeners.splice(t,1)}.bind(this)},se.prototype.stop=function(){this.datafileManager&&this.datafileManager.stop(),this.__updateListeners=[]},ce.prototype.addNotificationListener=function(e,t){try{if(!(o.objectValues(E).indexOf(e)>-1))return-1;this.__notificationListeners[e]||(this.__notificationListeners[e]=[]);var n=!1;if((this.__notificationListeners[e]||[]).forEach((function(e){if(e.callback===t)return n=!0,!1})),n)return-1;this.__notificationListeners[e].push({id:this.__listenerId,callback:t});var r=this.__listenerId;return this.__listenerId+=1,r}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),-1}},ce.prototype.removeNotificationListener=function(e){try{var t,n;if(Object.keys(this.__notificationListeners).some(function(r){if((this.__notificationListeners[r]||[]).every((function(i,a){return i.id!==e||(t=a,n=r,!1)})),void 0!==t&&void 0!==n)return!0}.bind(this)),void 0!==t&&void 0!==n)return this.__notificationListeners[n].splice(t,1),!0}catch(e){this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e)}return!1},ce.prototype.clearAllNotificationListeners=function(){try{o.objectValues(E).forEach(function(e){this.__notificationListeners[e]=[]}.bind(this))}catch(e){this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e)}},ce.prototype.clearNotificationListeners=function(e){try{this.__notificationListeners[e]=[]}catch(e){this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e)}},ce.prototype.sendNotifications=function(e,t){try{(this.__notificationListeners[e]||[]).forEach(function(n){var r=n.callback;try{r(t)}catch(t){this.logger.log(h.ERROR,o.sprintf(f.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",e,t.message))}}.bind(this))}catch(e){this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e)}};var ue=Math.pow(2,32),le={bucket:function(e){var t=e.experimentKeyMap[e.experimentKey].groupId;if(t){var n=e.groupIdMap[t];if(!n)throw new Error(o.sprintf(d.INVALID_GROUP_ID,"BUCKETER",t));if("random"===n.policy){var r=this.bucketUserIntoExperiment(n,e.bucketingId,e.userId,e.logger);if(null===r){var i=o.sprintf(f.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",e.userId,t);return e.logger.log(h.INFO,i),null}if(r!==e.experimentId){var a=o.sprintf(f.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,t);return e.logger.log(h.INFO,a),null}var s=o.sprintf(f.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,t);e.logger.log(h.INFO,s)}}var c=o.sprintf("%s%s",e.bucketingId,e.experimentId),u=this._generateBucketValue(c),l=o.sprintf(f.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",u,e.userId);e.logger.log(h.DEBUG,l);var p=this._findBucket(u,e.trafficAllocationConfig);if(!e.variationIdMap.hasOwnProperty(p)){if(p){var g=o.sprintf(f.INVALID_VARIATION_ID,"BUCKETER");e.logger.log(h.WARNING,g)}return null}return p},bucketUserIntoExperiment:function(e,t,n,r){var i=o.sprintf("%s%s",t,e.id),a=this._generateBucketValue(i);r.log(h.DEBUG,o.sprintf(f.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",a,n));var s=e.trafficAllocation;return this._findBucket(a,s)},_findBucket:function(e,t){for(var n=0;n<t.length;n++)if(e<t[n].endOfRange)return t[n].entityId;return null},_generateBucketValue:function(e){try{var t=c.v3(e,1);return parseInt(t/ue*1e4,10)}catch(t){throw new Error(o.sprintf(d.INVALID_BUCKETING_ID,"BUCKETER",e,t.message))}}},he=["and","or","not"];function de(e,t){if(Array.isArray(e)){var n=e[0],r=e.slice(1);switch("string"==typeof n&&-1===he.indexOf(n)&&(n="or",r=e),n){case"and":return function(e,t){var n=!1;if(Array.isArray(e)){for(var r=0;r<e.length;r++){var i=de(e[r],t);if(!1===i)return!1;null===i&&(n=!0)}return!n||null}return null}(r,t);case"not":return function(e,t){if(Array.isArray(e)&&e.length>0){var n=de(e[0],t);return null===n?null:!n}return null}(r,t);default:return function(e,t){var n=!1;if(Array.isArray(e)){for(var r=0;r<e.length;r++){var i=de(e[r],t);if(!0===i)return!0;null===i&&(n=!0)}return!!n&&null}return null}(r,t)}}return t(e)}var fe=i.getLogger();function pe(e){return/^\d+$/.test(e)}function ge(e){var t=e.indexOf("-"),n=e.indexOf("+");return!(t<0)&&(n<0||t<n)}function me(e){var t=e.indexOf("-"),n=e.indexOf("+");return!(n<0)&&(t<0||n<t)}function Ee(e){var t=e,n="";if(function(e){return/\s/.test(e)}(e))return fe.warn(f.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",e),null;if(ge(e)?(t=e.substring(0,e.indexOf("-")),n=e.substring(e.indexOf("-")+1)):me(e)&&(t=e.substring(0,e.indexOf("+")),n=e.substring(e.indexOf("+")+1)),"string"!=typeof t||"string"!=typeof n)return null;var r=t.split(".").length-1;if(r>2)return fe.warn(f.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",e),null;var i=t.split(".");if(i.length!=r+1)return fe.warn(f.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",e),null;for(var a=0,o=i;a<o.length;a++)if(!pe(o[a]))return fe.warn(f.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",e),null;return n&&i.push(n),i}var ve="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",_e=i.getLogger(),ye=["exact","exists","gt","ge","lt","le","substring","semver_eq","semver_lt","semver_le","semver_gt","semver_ge"],be={};function Ie(e){return"string"==typeof e||"boolean"==typeof e||B.isNumber(e)}function we(e,t){var n=e.value,r=typeof n,i=e.name,a=t[i],o=typeof a;return!Ie(n)||B.isNumber(n)&&!B.isSafeInteger(n)?(_e.warn(f.UNEXPECTED_CONDITION_VALUE,ve,JSON.stringify(e)),null):null===a?(_e.debug(f.UNEXPECTED_TYPE_NULL,ve,JSON.stringify(e),i),null):Ie(a)&&r===o?B.isNumber(a)&&!B.isSafeInteger(a)?(_e.warn(f.OUT_OF_BOUNDS,ve,JSON.stringify(e),i),null):n===a:(_e.warn(f.UNEXPECTED_TYPE,ve,JSON.stringify(e),o,i),null)}function Te(e,t){var n=e.name,r=t[n],i=typeof r,a=e.value;return null!==a&&B.isSafeInteger(a)?null===r?(_e.debug(f.UNEXPECTED_TYPE_NULL,ve,JSON.stringify(e),n),!1):B.isNumber(r)?!!B.isSafeInteger(r)||(_e.warn(f.OUT_OF_BOUNDS,ve,JSON.stringify(e),n),!1):(_e.warn(f.UNEXPECTED_TYPE,ve,JSON.stringify(e),i,n),!1):(_e.warn(f.UNEXPECTED_CONDITION_VALUE,ve,JSON.stringify(e)),!1)}function Ae(e,t){var n=e.name,r=t[n],i=typeof r,a=e.value;return"string"!=typeof a?(_e.warn(f.UNEXPECTED_CONDITION_VALUE,ve,JSON.stringify(e)),null):null===r?(_e.debug(f.UNEXPECTED_TYPE_NULL,ve,JSON.stringify(e),n),null):"string"!=typeof r?(_e.warn(f.UNEXPECTED_TYPE,ve,JSON.stringify(e),i,n),null):function(e,t){var n=Ee(t),r=Ee(e);if(!n||!r)return null;for(var i=n.length,a=0;a<r.length;a++){if(i<=a)return ge(e)||me(e)?1:-1;if(pe(n[a])){var o=parseInt(n[a]),s=parseInt(r[a]);if(o>s)return 1;if(o<s)return-1}else{if(n[a]<r[a])return ge(e)&&!ge(t)?1:-1;if(n[a]>r[a])return!ge(e)&&ge(t)?-1:1}}return ge(t)&&!ge(e)?-1:0}(a,r)}be.exact=we,be.exists=function(e,t){return null!=t[e.name]},be.gt=function(e,t){var n=t[e.name],r=e.value;return Te(e,t)&&null!==r?n>r:null},be.ge=function(e,t){var n=t[e.name],r=e.value;return Te(e,t)&&null!==r?n>=r:null},be.lt=function(e,t){var n=t[e.name],r=e.value;return Te(e,t)&&null!==r?n<r:null},be.le=function(e,t){var n=t[e.name],r=e.value;return Te(e,t)&&null!==r?n<=r:null},be.substring=function(e,t){var n=e.name,r=t[e.name],i=typeof r,a=e.value;return"string"!=typeof a?(_e.warn(f.UNEXPECTED_CONDITION_VALUE,ve,JSON.stringify(e)),null):null===r?(_e.debug(f.UNEXPECTED_TYPE_NULL,ve,JSON.stringify(e),n),null):"string"!=typeof r?(_e.warn(f.UNEXPECTED_TYPE,ve,JSON.stringify(e),i,n),null):-1!==r.indexOf(a)},be.semver_eq=function(e,t){var n=Ae(e,t);return null===n?null:0===n},be.semver_gt=function(e,t){var n=Ae(e,t);return null===n?null:n>0},be.semver_ge=function(e,t){var n=Ae(e,t);return null===n?null:n>=0},be.semver_lt=function(e,t){var n=Ae(e,t);return null===n?null:n<0},be.semver_le=function(e,t){var n=Ae(e,t);return null===n?null:n<=0};var Se=Object.freeze({__proto__:null,evaluate:function(e,t){var n=e.match;if(void 0!==n&&-1===ye.indexOf(n))return _e.warn(f.UNKNOWN_MATCH_TYPE,ve,JSON.stringify(e)),null;var r=e.name;return t.hasOwnProperty(r)||"exists"==n?(n&&be[n]||we)(e,t):(_e.debug(f.MISSING_ATTRIBUTE_VALUE,ve,JSON.stringify(e),r),null)}}),Oe=i.getLogger();function Re(e){this.typeToEvaluatorMap=B.assign({},e,{custom_attribute:Se})}function Ne(e){return"string"==typeof e&&""!==e}Re.prototype.evaluate=function(e,t,n){if(!e||0===e.length)return!0;n||(n={});var r=function(e){var r=t[e];if(r){Oe.log(h.DEBUG,o.sprintf(f.EVALUATING_AUDIENCE,"AUDIENCE_EVALUATOR",e,JSON.stringify(r.conditions)));var i=de(r.conditions,this.evaluateConditionWithUserAttributes.bind(this,n)),a=null===i?"UNKNOWN":i.toString().toUpperCase();return Oe.log(h.DEBUG,o.sprintf(f.AUDIENCE_EVALUATION_RESULT,"AUDIENCE_EVALUATOR",e,a)),i}return null}.bind(this);return de(e,r)||!1},Re.prototype.evaluateConditionWithUserAttributes=function(e,t){var n=this.typeToEvaluatorMap[t.type];if(!n)return Oe.log(h.WARNING,o.sprintf(f.UNKNOWN_CONDITION_TYPE,"AUDIENCE_EVALUATOR",JSON.stringify(t))),null;try{return n.evaluate(t,e,Oe)}catch(e){Oe.log(h.ERROR,o.sprintf(d.CONDITION_EVALUATOR_ERROR,"AUDIENCE_EVALUATOR",t.type,e.message))}return null};var ke="DECISION_SERVICE",xe=d,Be=h,Ce=f,De=_,Le=y;function Ue(e){this.audienceEvaluator=new Re(e.UNSTABLE_conditionEvaluators),this.forcedVariationMap={},this.logger=e.logger,this.userProfileService=e.userProfileService||null}Ue.prototype.getVariation=function(e,t,n,r){var i=this._getBucketingId(n,r);if(!this.__checkIfExperimentIsActive(e,t))return null;var a=e.experimentKeyMap[t],s=this.getForcedVariation(e,t,n);if(s)return s;var c=this.__getWhitelistedVariation(a,n);if(c)return c.key;var u=this.__resolveExperimentBucketMap(n,r);if(c=this.__getStoredVariation(e,a,n,u))return this.logger.log(Be.INFO,o.sprintf(Ce.RETURNING_STORED_VARIATION,ke,c.key,t,n)),c.key;if(!this.__checkIfUserIsInAudience(e,t,Le.EXPERIMENT,n,r,"")){var l=o.sprintf(Ce.USER_NOT_IN_EXPERIMENT,ke,n,t);return this.logger.log(Be.INFO,l),null}var h=this.__buildBucketerParams(e,t,i,n),d=le.bucket(h);if(!(c=e.variationIdMap[d])){var f=o.sprintf(Ce.USER_HAS_NO_VARIATION,ke,n,t);return this.logger.log(Be.DEBUG,f),null}var p=o.sprintf(Ce.USER_HAS_VARIATION,ke,n,c.key,t);return this.logger.log(Be.INFO,p),this.__saveUserProfile(a,c,n,u),c.key},Ue.prototype.__resolveExperimentBucketMap=function(e,t){t=t||{};var n=this.__getUserProfile(e)||{},r=t[g.STICKY_BUCKETING_KEY];return B.assign({},n.experiment_bucket_map,r)},Ue.prototype.__checkIfExperimentIsActive=function(e,t){if(!function(e,t){return"Running"===U(e,t)}(e,t)){var n=o.sprintf(Ce.EXPERIMENT_NOT_RUNNING,ke,t);return this.logger.log(Be.INFO,n),!1}return!0},Ue.prototype.__getWhitelistedVariation=function(e,t){if(e.forcedVariations&&e.forcedVariations.hasOwnProperty(t)){var n=e.forcedVariations[t];if(e.variationKeyMap.hasOwnProperty(n)){var r=o.sprintf(Ce.USER_FORCED_IN_VARIATION,ke,t,n);return this.logger.log(Be.INFO,r),e.variationKeyMap[n]}var i=o.sprintf(Ce.FORCED_BUCKETING_FAILED,ke,n,t);return this.logger.log(Be.ERROR,i),null}return null},Ue.prototype.__checkIfUserIsInAudience=function(e,t,n,r,i,a){var s=q(e,t),c=function(e){return e.audiencesById}(e);this.logger.log(Be.DEBUG,o.sprintf(Ce.EVALUATING_AUDIENCES_COMBINED,ke,n,a||t,JSON.stringify(s)));var u=this.audienceEvaluator.evaluate(s,c,i);return this.logger.log(Be.INFO,o.sprintf(Ce.AUDIENCE_EVALUATION_RESULT_COMBINED,ke,n,a||t,u.toString().toUpperCase())),u},Ue.prototype.__buildBucketerParams=function(e,t,n,r){var i={};return i.experimentKey=t,i.experimentId=H(e,t),i.userId=r,i.trafficAllocationConfig=$(e,t),i.experimentKeyMap=e.experimentKeyMap,i.groupIdMap=e.groupIdMap,i.variationIdMap=e.variationIdMap,i.logger=this.logger,i.bucketingId=n,i},Ue.prototype.__getStoredVariation=function(e,t,n,r){if(r.hasOwnProperty(t.id)){var i=r[t.id],a=i.variation_id;if(e.variationIdMap.hasOwnProperty(a))return e.variationIdMap[i.variation_id];this.logger.log(Be.INFO,o.sprintf(Ce.SAVED_VARIATION_NOT_FOUND,ke,n,a,t.key))}return null},Ue.prototype.__getUserProfile=function(e){var t={user_id:e,experiment_bucket_map:{}};if(!this.userProfileService)return t;try{return this.userProfileService.lookup(e)}catch(t){this.logger.log(Be.ERROR,o.sprintf(xe.USER_PROFILE_LOOKUP_ERROR,ke,e,t.message))}},Ue.prototype.__saveUserProfile=function(e,t,n,r){if(this.userProfileService)try{r[e.id]={variation_id:t.id},this.userProfileService.save({user_id:n,experiment_bucket_map:r}),this.logger.log(Be.INFO,o.sprintf(Ce.SAVED_VARIATION,ke,t.key,e.key,n))}catch(e){this.logger.log(Be.ERROR,o.sprintf(xe.USER_PROFILE_SAVE_ERROR,ke,n,e.message))}},Ue.prototype.getVariationForFeature=function(e,t,n,r){var i=this._getVariationForFeatureExperiment(e,t,n,r);if(null!==i.variation)return i;var a=this._getVariationForRollout(e,t,n,r);return null!==a.variation?(this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_IN_ROLLOUT,ke,n,t.key)),a):(this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_NOT_IN_ROLLOUT,ke,n,t.key)),a)},Ue.prototype._getVariationForFeatureExperiment=function(e,t,n,r){var i=null,a=null;if(t.hasOwnProperty("groupId")){var s=e.groupIdMap[t.groupId];s&&(i=this._getExperimentInGroup(e,s,n))&&-1!==t.experimentIds.indexOf(i.id)&&(a=this.getVariation(e,i.key,n,r))}else t.experimentIds.length>0?(i=Q(e,t.experimentIds[0],this.logger))&&(a=this.getVariation(e,i.key,n,r)):this.logger.log(Be.DEBUG,o.sprintf(Ce.FEATURE_HAS_NO_EXPERIMENTS,ke,t.key));var c=null;return null!==a&&null!==i&&(c=i.variationKeyMap[a]),{experiment:i,variation:c,decisionSource:De.FEATURE_TEST}},Ue.prototype._getExperimentInGroup=function(e,t,n){var r=le.bucketUserIntoExperiment(t,n,n,this.logger);if(r){this.logger.log(Be.INFO,o.sprintf(Ce.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,ke,n,r,t.id));var i=Q(e,r,this.logger);if(i)return i}return this.logger.log(Be.INFO,o.sprintf(Ce.USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP,ke,n,t.id)),null},Ue.prototype._getVariationForRollout=function(e,t,n,r){if(!t.rolloutId)return this.logger.log(Be.DEBUG,o.sprintf(Ce.NO_ROLLOUT_EXISTS,ke,t.key)),{experiment:null,variation:null,decisionSource:De.ROLLOUT};var i=e.rolloutIdMap[t.rolloutId];if(!i)return this.logger.log(Be.ERROR,o.sprintf(xe.INVALID_ROLLOUT_ID,ke,t.rolloutId,t.key)),{experiment:null,variation:null,decisionSource:De.ROLLOUT};if(0===i.experiments.length)return this.logger.log(Be.ERROR,o.sprintf(Ce.ROLLOUT_HAS_NO_EXPERIMENTS,ke,t.rolloutId)),{experiment:null,variation:null,decisionSource:De.ROLLOUT};var a,s,c,u,l,h,d=this._getBucketingId(n,r),f=i.experiments.length-1;for(a=0;a<f;a++){if(s=e.experimentKeyMap[i.experiments[a].key],h=a+1,this.__checkIfUserIsInAudience(e,s.key,Le.RULE,n,r,h)){if(this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,ke,n,h)),c=this.__buildBucketerParams(e,s.key,d,n),u=le.bucket(c),l=e.variationIdMap[u])return this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_BUCKETED_INTO_TARGETING_RULE,ke,n,h)),{experiment:s,variation:l,decisionSource:De.ROLLOUT};this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_NOT_BUCKETED_INTO_TARGETING_RULE,ke,n,h));break}this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,ke,n,h))}var p=e.experimentKeyMap[i.experiments[f].key];if(this.__checkIfUserIsInAudience(e,p.key,Le.RULE,n,r,"Everyone Else")){if(this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,ke,n,"Everyone Else")),c=this.__buildBucketerParams(e,p.key,d,n),u=le.bucket(c),l=e.variationIdMap[u])return this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE,ke,n)),{experiment:p,variation:l,decisionSource:De.ROLLOUT};this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE,ke,n))}return{experiment:null,variation:null,decisionSource:De.ROLLOUT}},Ue.prototype._getBucketingId=function(e,t){var n=e;return null!=t&&"object"==typeof t&&t.hasOwnProperty(g.BUCKETING_ID)&&("string"==typeof t[g.BUCKETING_ID]?(n=t[g.BUCKETING_ID],this.logger.log(Be.DEBUG,o.sprintf(Ce.VALID_BUCKETING_ID,ke,n))):this.logger.log(Be.WARNING,o.sprintf(Ce.BUCKETING_ID_NOT_STRING,ke))),n},Ue.prototype.removeForcedVariation=function(e,t,n){if(!e)throw new Error(o.sprintf(xe.INVALID_USER_ID,ke));if(!this.forcedVariationMap.hasOwnProperty(e))throw new Error(o.sprintf(xe.USER_NOT_IN_FORCED_VARIATION,ke,e));delete this.forcedVariationMap[e][t],this.logger.log(Be.DEBUG,o.sprintf(Ce.VARIATION_REMOVED_FOR_USER,ke,n,e))},Ue.prototype.__setInForcedVariationMap=function(e,t,n){this.forcedVariationMap.hasOwnProperty(e)||(this.forcedVariationMap[e]={}),this.forcedVariationMap[e][t]=n,this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_MAPPED_TO_FORCED_VARIATION,ke,n,t,e))},Ue.prototype.getForcedVariation=function(e,t,n){var r,i=this.forcedVariationMap[n];if(!i)return this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_HAS_NO_FORCED_VARIATION,ke,n)),null;try{var a=Z(e,t);if(!a.hasOwnProperty("id"))return this.logger.log(Be.ERROR,o.sprintf(xe.IMPROPERLY_FORMATTED_EXPERIMENT,ke,t)),null;r=a.id}catch(e){return this.logger.log(Be.ERROR,e.message),null}var s=i[r];if(!s)return this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,ke,t,n)),null;var c=W(e,s);return c?this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_HAS_FORCED_VARIATION,ke,c,t,n)):this.logger.log(Be.DEBUG,o.sprintf(Ce.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,ke,t,n)),c},Ue.prototype.setForcedVariation=function(e,t,n,r){if(null!=r&&!Ne(r))return this.logger.log(Be.ERROR,o.sprintf(xe.INVALID_VARIATION_KEY,ke)),!1;var i;try{var a=Z(e,t);if(!a.hasOwnProperty("id"))return this.logger.log(Be.ERROR,o.sprintf(xe.IMPROPERLY_FORMATTED_EXPERIMENT,ke,t)),!1;i=a.id}catch(e){return this.logger.log(Be.ERROR,e.message),!1}if(null==r)try{return this.removeForcedVariation(n,i,t,this.logger),!0}catch(e){return this.logger.log(Be.ERROR,e.message),!1}var s=X(e,t,r);if(!s)return this.logger.log(Be.ERROR,o.sprintf(xe.NO_VARIATION_FOR_EXPERIMENT_KEY,ke,r,t)),!1;try{return this.__setInForcedVariationMap(n,i,s),!0}catch(e){return this.logger.log(Be.ERROR,e.message),!1}};var Pe=p.REVENUE,Me=p.VALUE;function Fe(e,t){if(e.hasOwnProperty(Pe)){var n=e[Pe],r=void 0;return"string"==typeof n?(r=parseInt(n),isNaN(r)?(t.log(h.INFO,o.sprintf(f.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",n)),null):(t.log(h.INFO,o.sprintf(f.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",r)),r)):"number"==typeof n?(r=n,t.log(h.INFO,o.sprintf(f.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",r)),r):null}return null}function je(e,t){if(e.hasOwnProperty(Me)){var n=e[Me],r=void 0;return"string"==typeof n?(r=parseFloat(n),isNaN(r)?(t.log(h.INFO,o.sprintf(f.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",n)),null):(t.log(h.INFO,o.sprintf(f.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",r)),r)):"number"==typeof n?(r=n,t.log(h.INFO,o.sprintf(f.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",r)),r):null}return null}function Ve(e,t){return"string"==typeof e&&("string"==typeof t||"boolean"==typeof t||B.isNumber(t)&&B.isSafeInteger(t))}var ze="https://logx.optimizely.com/v1/events";function Ge(e){var t=e.attributes,n=e.configObj,r=n.anonymizeIP,i=n.botFiltering;null==r&&(r=!1);var a={snapshots:[],visitor_id:e.userId,attributes:[]},o={account_id:n.accountId,project_id:n.projectId,visitors:[a],revision:n.revision,client_name:e.clientEngine,client_version:e.clientVersion,anonymize_ip:r,enrich_decisions:!0};return Object.keys(t||{}).forEach((function(n){if(Ve(n,t[n])){var r=J(e.configObj,n,e.logger);r&&o.visitors[0].attributes.push({entity_id:r,key:n,type:"custom",value:t[n]})}})),"boolean"==typeof i&&o.visitors[0].attributes.push({entity_id:g.BOT_FILTERING,key:g.BOT_FILTERING,type:"custom",value:i}),o}function He(e){var t,n;return null!==(n=null===(t=e.experiment)||void 0===t?void 0:t.key)&&void 0!==n?n:""}function Ke(e){var t,n;return null!==(n=null===(t=e.variation)||void 0===t?void 0:t.key)&&void 0!==n?n:""}function Je(e){var t,n;return null!==(n=null===(t=e.variation)||void 0===t?void 0:t.featureEnabled)&&void 0!==n&&n}var Ye=i.getLogger("EVENT_BUILDER");function qe(e,t){var n=[];return Object.keys(t||{}).forEach((function(r){if(Ve(r,t[r])){var i=J(e,r,Ye);i&&n.push({entityId:i,key:r,value:t[r]})}})),n}var We=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(a.LogTierV1EventProcessor.bind.apply(a.LogTierV1EventProcessor,l([void 0],e)))},Xe=(a.LocalStoragePendingEventsDispatcher,"USER_PROFILE_SERVICE_VALIDATOR"),Ze=function(){function e(e){var t=this,n=e.clientEngine;-1===m.indexOf(n)&&(e.logger.log(h.INFO,o.sprintf(f.INVALID_CLIENT_ENGINE,"OPTIMIZELY",n)),n="node-sdk"),this.clientEngine=n,this.clientVersion=e.clientVersion||"4.4.1",this.errorHandler=e.errorHandler,this.eventDispatcher=e.eventDispatcher,this.isOptimizelyConfigValid=e.isValidInstance,this.logger=e.logger,this.projectConfigManager=function(e){return new se(e)}({datafile:e.datafile,datafileOptions:e.datafileOptions,jsonSchemaValidator:e.jsonSchemaValidator,sdkKey:e.sdkKey}),this.disposeOnUpdate=this.projectConfigManager.onUpdate((function(e){t.logger.log(h.INFO,o.sprintf(f.UPDATED_OPTIMIZELY_CONFIG,"OPTIMIZELY",e.revision,e.projectId)),t.notificationCenter.sendNotifications(E.OPTIMIZELY_CONFIG_UPDATE)}));var r=this.projectConfigManager.onReady(),i=null;if(e.userProfileService)try{(function(e){if("object"==typeof e&&null!==e){if("function"!=typeof e.lookup)throw new Error(o.sprintf(d.INVALID_USER_PROFILE_SERVICE,Xe,"Missing function 'lookup'"));if("function"!=typeof e.save)throw new Error(o.sprintf(d.INVALID_USER_PROFILE_SERVICE,Xe,"Missing function 'save'"));return!0}throw new Error(o.sprintf(d.INVALID_USER_PROFILE_SERVICE,Xe))})(e.userProfileService)&&(i=e.userProfileService,this.logger.log(h.INFO,o.sprintf(f.VALID_USER_PROFILE_SERVICE,"OPTIMIZELY")))}catch(e){this.logger.log(h.WARNING,e.message)}this.decisionService=new Ue({userProfileService:i,logger:this.logger,UNSTABLE_conditionEvaluators:e.UNSTABLE_conditionEvaluators}),this.notificationCenter=function(e){return new ce(e)}({logger:this.logger,errorHandler:this.errorHandler});var a={dispatcher:this.eventDispatcher,flushInterval:e.eventFlushInterval,batchSize:e.eventBatchSize,maxQueueSize:e.eventMaxQueueSize,notificationCenter:this.notificationCenter};this.eventProcessor=We(a);var s=this.eventProcessor.start();this.readyPromise=Promise.all([r,s]).then((function(e){return e[0]})),this.readyTimeouts={},this.nextReadyTimeoutId=0}return e.prototype.isValidInstance=function(){return this.isOptimizelyConfigValid&&!!this.projectConfigManager.getConfig()},e.prototype.activate=function(e,t,n){try{if(!this.isValidInstance())return this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","activate")),null;if(!this.validateInputs({experiment_key:e,user_id:t},n))return this.notActivatingExperiment(e,t);var r=this.projectConfigManager.getConfig();if(!r)return null;try{var i=this.getVariation(e,t,n);if(null===i)return this.notActivatingExperiment(e,t);if(!function(e,t){return"Running"===U(e,t)}(r,e)){var a=o.sprintf(f.SHOULD_NOT_DISPATCH_ACTIVATE,"OPTIMIZELY",e);return this.logger.log(h.DEBUG,a),i}var s=M(r,e),c={experiment:s,variation:s.variationKeyMap[i],decisionSource:_.EXPERIMENT};return this.sendImpressionEvent(c,"",t,n),i}catch(n){this.logger.log(h.ERROR,n.message);var u=o.sprintf(f.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(h.INFO,u),this.errorHandler.handleError(n),null}}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.sendImpressionEvent=function(e,t,n,r){var i=this.projectConfigManager.getConfig();if(i){var a=function(e){var t=e.configObj,n=e.decisionObj,r=e.userId,i=e.flagKey,a=e.userAttributes,o=e.clientEngine,s=e.clientVersion,c=n.decisionSource,u=He(n),l=Ke(n),h=null,d=null;""!==u&&""!==l&&(d=X(t,u,l)),""!==u&&(h=H(t,u));var f=null;return null!==h&&(f=K(t,h)),{type:"impression",timestamp:B.currentTimestamp(),uuid:B.uuid(),user:{id:r,attributes:qe(t,a)},context:{accountId:t.accountId,projectId:t.projectId,revision:t.revision,clientName:o,clientVersion:s,anonymizeIP:t.anonymizeIP||!1,botFiltering:t.botFiltering},layer:{id:f},experiment:{id:h,key:u},variation:{id:d,key:l},ruleKey:u,flagKey:i,ruleType:c}}({decisionObj:e,flagKey:t,userId:n,userAttributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:i});this.eventProcessor.process(a),this.emitNotificationCenterActivate(e,t,n,r)}},e.prototype.emitNotificationCenterActivate=function(e,t,n,r){var i=this.projectConfigManager.getConfig();if(i){var a=e.decisionSource,o=He(e),s=Ke(e),c=null,u=null;""!==o&&""!==s&&(u=P(i,o,s),c=L(i,o));var l,h=function(e){var t={httpVerb:"POST"},n=Ge(e);t.url=ze;var r=function(e,t,n,r,i,a){var o=null;null!==t&&(o=K(e,t));var s=W(e,n);return null===s&&(s=""),{decisions:[{campaign_id:o,experiment_id:t,variation_id:n,metadata:{flag_key:a,rule_key:r,rule_type:i,variation_key:s}}],events:[{entity_id:o,timestamp:B.currentTimestamp(),key:"campaign_activated",uuid:B.uuid()}]}}(e.configObj,e.experimentId,e.variationId,e.ruleKey,e.ruleType,e.flagKey);return n.visitors[0].snapshots.push(r),t.params=n,t}({attributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:i,experimentId:c,ruleKey:o,flagKey:t,ruleType:a,userId:n,variationId:u,logger:this.logger}),d=i.experimentKeyMap[o];d&&d.variationKeyMap&&""!==s&&(l=d.variationKeyMap[s]),this.notificationCenter.sendNotifications(E.ACTIVATE,{experiment:d,userId:n,attributes:r,variation:l,logEvent:h})}},e.prototype.track=function(e,t,n,r){try{if(!this.isValidInstance())return void this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","track"));if(!this.validateInputs({user_id:t,event_key:e},n,r))return;var i=this.projectConfigManager.getConfig();if(!i)return;if(!function(e,t){return e.eventKeyMap.hasOwnProperty(t)}(i,e))return this.logger.log(h.WARNING,o.sprintf(f.EVENT_KEY_NOT_FOUND,"OPTIMIZELY",e)),void this.logger.log(h.WARNING,o.sprintf(f.NOT_TRACKING_USER,"OPTIMIZELY",t));var a=function(e){var t=e.configObj,n=e.userId,r=e.userAttributes,i=e.clientEngine,a=e.clientVersion,o=e.eventKey,s=e.eventTags,c=Y(t,o),u=null,l=null;return s&&(u=Fe(s,Ye),l=je(s,Ye)),{type:"conversion",timestamp:B.currentTimestamp(),uuid:B.uuid(),user:{id:n,attributes:qe(t,r)},context:{accountId:t.accountId,projectId:t.projectId,revision:t.revision,clientName:i,clientVersion:a,anonymizeIP:t.anonymizeIP||!1,botFiltering:t.botFiltering},event:{id:c,key:o},revenue:u,value:l,tags:s}}({eventKey:e,eventTags:r=this.filterEmptyValues(r),userId:t,userAttributes:n,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:i});this.logger.log(h.INFO,o.sprintf(f.TRACK_EVENT,"OPTIMIZELY",e,t)),this.eventProcessor.process(a),this.emitNotificationCenterTrack(e,t,n,r)}catch(e){this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e);var s=o.sprintf(f.NOT_TRACKING_USER,"OPTIMIZELY",t);this.logger.log(h.ERROR,s)}},e.prototype.emitNotificationCenterTrack=function(e,t,n,r){try{var i=this.projectConfigManager.getConfig();if(!i)return;var a=function(e){var t={httpVerb:"POST"},n=Ge(e);t.url=ze;var r=function(e,t,n,r){var i={events:[]},a={entity_id:Y(e,t),timestamp:B.currentTimestamp(),uuid:B.uuid(),key:t};if(n){var o=Fe(n,r);null!==o&&(a[p.REVENUE]=o);var s=je(n,r);null!==s&&(a[p.VALUE]=s),a.tags=n}return i.events.push(a),i}(e.configObj,e.eventKey,e.eventTags,e.logger);return n.visitors[0].snapshots=[r],t.params=n,t}({attributes:n,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:i,eventKey:e,eventTags:r,logger:this.logger,userId:t});this.notificationCenter.sendNotifications(E.TRACK,{eventKey:e,userId:t,attributes:n,eventTags:r,logEvent:a})}catch(e){this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e)}},e.prototype.getVariation=function(e,t,n){try{if(!this.isValidInstance())return this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getVariation")),null;try{if(!this.validateInputs({experiment_key:e,user_id:t},n))return null;var r=this.projectConfigManager.getConfig();if(!r)return null;var i=r.experimentKeyMap[e];if(!i)return this.logger.log(h.DEBUG,o.sprintf(d.INVALID_EXPERIMENT_KEY,"OPTIMIZELY",e)),null;var a=this.decisionService.getVariation(r,e,t,n),s=G(r,i.id)?v.FEATURE_TEST:v.AB_TEST;return this.notificationCenter.sendNotifications(E.DECISION,{type:s,userId:t,attributes:n||{},decisionInfo:{experimentKey:e,variationKey:a}}),a}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.setForcedVariation=function(e,t,n){if(!this.validateInputs({experiment_key:e,user_id:t}))return!1;var r=this.projectConfigManager.getConfig();if(!r)return!1;try{return this.decisionService.setForcedVariation(r,e,t,n)}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),!1}},e.prototype.getForcedVariation=function(e,t){if(!this.validateInputs({experiment_key:e,user_id:t}))return null;var n=this.projectConfigManager.getConfig();if(!n)return null;try{return this.decisionService.getForcedVariation(n,e,t)}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.validateInputs=function(e,t,n){try{if(e.hasOwnProperty("user_id")){var r=e.user_id;if("string"!=typeof r||null===r||"undefined"===r)throw new Error(o.sprintf(d.INVALID_INPUT_FORMAT,"OPTIMIZELY","user_id"));delete e.user_id}return Object.keys(e).forEach((function(t){if(!Ne(e[t]))throw new Error(o.sprintf(d.INVALID_INPUT_FORMAT,"OPTIMIZELY",t))})),t&&function(e){if("object"!=typeof e||Array.isArray(e)||null===e)throw new Error(o.sprintf(d.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));Object.keys(e).forEach((function(t){if(void 0===e[t])throw new Error(o.sprintf(d.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",t))}))}(t),n&&function(e){if("object"!=typeof e||Array.isArray(e)||null===e)throw new Error(o.sprintf(d.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"))}(n),!0}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),!1}},e.prototype.notActivatingExperiment=function(e,t){var n=o.sprintf(f.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(h.INFO,n),null},e.prototype.filterEmptyValues=function(e){for(var t in e)!e.hasOwnProperty(t)||null!==e[t]&&void 0!==e[t]||delete e[t];return e},e.prototype.isFeatureEnabled=function(e,t,n){try{if(!this.isValidInstance())return this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","isFeatureEnabled")),!1;if(!this.validateInputs({feature_key:e,user_id:t},n))return!1;var r=this.projectConfigManager.getConfig();if(!r)return!1;var i=F(r,e,this.logger);if(!i)return!1;var a={},s=this.decisionService.getVariationForFeature(r,i,t,n),c=s.decisionSource,u=He(s),l=Ke(s),d=Je(s);c===_.FEATURE_TEST&&(a={experimentKey:u,variationKey:l}),(c===_.FEATURE_TEST||c===_.ROLLOUT&&function(e){return!!e.sendFlagDecisions}(r))&&this.sendImpressionEvent(s,i.key,t,n),!0===d?this.logger.log(h.INFO,o.sprintf(f.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",e,t)):(this.logger.log(h.INFO,o.sprintf(f.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",e,t)),d=!1);var p={featureKey:e,featureEnabled:d,source:s.decisionSource,sourceInfo:a};return this.notificationCenter.sendNotifications(E.DECISION,{type:v.FEATURE,userId:t,attributes:n||{},decisionInfo:p}),d}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),!1}},e.prototype.getEnabledFeatures=function(e,t){var n=this;try{var r=[];if(!this.isValidInstance())return this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getEnabledFeatures")),r;if(!this.validateInputs({user_id:e}))return r;var i=this.projectConfigManager.getConfig();return i?(o.objectValues(i.featureKeyMap).forEach((function(i){n.isFeatureEnabled(i.key,e,t)&&r.push(i.key)})),r):r}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),[]}},e.prototype.getFeatureVariable=function(e,t,n,r){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,null,n,r):(this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariable")),null)}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableForType=function(e,t,n,r,i){if(!this.validateInputs({feature_key:e,variable_key:t,user_id:r},i))return null;var a=this.projectConfigManager.getConfig();if(!a)return null;var s=F(a,e,this.logger);if(!s)return null;var c=j(a,e,t,this.logger);if(!c)return null;if(n&&c.type!==n)return this.logger.log(h.WARNING,o.sprintf(f.VARIABLE_REQUESTED_WITH_WRONG_TYPE,"OPTIMIZELY",n,c.type)),null;var u=this.decisionService.getVariationForFeature(a,s,r,i),l=Je(u),d=this.getFeatureVariableValueFromVariation(e,l,u.variation,c,r),p={};return u.decisionSource===_.FEATURE_TEST&&null!==u.experiment&&null!==u.variation&&(p={experimentKey:u.experiment.key,variationKey:u.variation.key}),this.notificationCenter.sendNotifications(E.DECISION,{type:v.FEATURE_VARIABLE,userId:r,attributes:i||{},decisionInfo:{featureKey:e,featureEnabled:l,source:u.decisionSource,variableKey:t,variableValue:d,variableType:c.type,sourceInfo:p}}),d},e.prototype.getFeatureVariableValueFromVariation=function(e,t,n,r,i){var a=this.projectConfigManager.getConfig();if(!a)return null;var s=r.defaultValue;if(null!==n){var c=V(a,r,n,this.logger);null!==c?t?(s=c,this.logger.log(h.INFO,o.sprintf(f.USER_RECEIVED_VARIABLE_VALUE,"OPTIMIZELY",s,r.key,e))):this.logger.log(h.INFO,o.sprintf(f.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",e,i,s)):this.logger.log(h.INFO,o.sprintf(f.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",r.key,n.key))}else this.logger.log(h.INFO,o.sprintf(f.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",i,r.key,e));return z(s,r.type,this.logger)},e.prototype.getFeatureVariableBoolean=function(e,t,n,r){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,b.BOOLEAN,n,r):(this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableBoolean")),null)}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableDouble=function(e,t,n,r){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,b.DOUBLE,n,r):(this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableDouble")),null)}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableInteger=function(e,t,n,r){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,b.INTEGER,n,r):(this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableInteger")),null)}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableString=function(e,t,n,r){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,b.STRING,n,r):(this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableString")),null)}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getFeatureVariableJSON=function(e,t,n,r){try{return this.isValidInstance()?this.getFeatureVariableForType(e,t,b.JSON,n,r):(this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableJSON")),null)}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getAllFeatureVariables=function(e,t,n){var r=this;try{if(!this.isValidInstance())return this.logger.log(h.ERROR,o.sprintf(f.INVALID_OBJECT,"OPTIMIZELY","getAllFeatureVariables")),null;if(!this.validateInputs({feature_key:e,user_id:t},n))return null;var i=this.projectConfigManager.getConfig();if(!i)return null;var a=F(i,e,this.logger);if(!a)return null;var s=this.decisionService.getVariationForFeature(i,a,t,n),c=Je(s),u={};a.variables.forEach((function(n){u[n.key]=r.getFeatureVariableValueFromVariation(e,c,s.variation,n,t)}));var l={};return s.decisionSource===_.FEATURE_TEST&&null!==s.experiment&&null!==s.variation&&(l={experimentKey:s.experiment.key,variationKey:s.variation.key}),this.notificationCenter.sendNotifications(E.DECISION,{type:v.ALL_FEATURE_VARIABLES,userId:t,attributes:n||{},decisionInfo:{featureKey:e,featureEnabled:c,source:s.decisionSource,variableValues:u,sourceInfo:l}}),u}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.getOptimizelyConfig=function(){try{return this.projectConfigManager.getConfig()?this.projectConfigManager.getOptimizelyConfig():null}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),null}},e.prototype.close=function(){var e=this;try{var t=this.eventProcessor.stop();return this.disposeOnUpdate&&(this.disposeOnUpdate(),this.disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.readyTimeouts).forEach((function(t){var n=e.readyTimeouts[t];clearTimeout(n.readyTimeout),n.onClose()})),this.readyTimeouts={},t.then((function(){return{success:!0}}),(function(e){return{success:!1,reason:String(e)}}))}catch(e){return this.logger.log(h.ERROR,e.message),this.errorHandler.handleError(e),Promise.resolve({success:!1,reason:String(e)})}},e.prototype.onReady=function(e){var t,n,r=this;"object"==typeof e&&null!==e&&void 0!==e.timeout&&(t=e.timeout),B.isSafeInteger(t)||(t=3e4);var i=new Promise((function(e){n=e})),a=this.nextReadyTimeoutId;this.nextReadyTimeoutId++;var s=setTimeout((function(){delete r.readyTimeouts[a],n({success:!1,reason:o.sprintf("onReady timeout expired after %s ms",t)})}),t);return this.readyTimeouts[a]={readyTimeout:s,onClose:function(){n({success:!1,reason:"Instance closed"})}},this.readyPromise.then((function(){clearTimeout(s),delete r.readyTimeouts[a],n({success:!0})})),Promise.race([this.readyPromise,i])},e}(),$e=i.getLogger();i.setLogHandler(k.createLogger()),i.setLogLevel(i.LogLevel.INFO);var Qe=!1,et=function(e){try{e.errorHandler&&i.setErrorHandler(e.errorHandler),e.logger&&(i.setLogHandler(e.logger),i.setLogLevel(i.LogLevel.NOTSET)),void 0!==e.logLevel&&i.setLogLevel(e.logLevel);try{S(e),e.isValidInstance=!0}catch(t){$e.error(t),e.isValidInstance=!1}var t=void 0;null==e.eventDispatcher?(t=new a.LocalStoragePendingEventsDispatcher({eventDispatcher:R}),Qe||(t.sendPendingEvents(),Qe=!0)):t=e.eventDispatcher;var n=e.eventBatchSize,r=e.eventFlushInterval;(function(e){return!("number"!=typeof e||!B.isSafeInteger(e))&&e>=1})(e.eventBatchSize)||($e.warn("Invalid eventBatchSize %s, defaulting to %s",e.eventBatchSize,10),n=10),function(e){return!("number"!=typeof e||!B.isSafeInteger(e))&&e>0}(e.eventFlushInterval)||($e.warn("Invalid eventFlushInterval %s, defaulting to %s",e.eventFlushInterval,1e3),r=1e3);var o=u(u({clientEngine:"javascript-sdk",eventDispatcher:t},e),{eventBatchSize:n,eventFlushInterval:r,logger:$e,errorHandler:i.getErrorHandler()}),s=new Ze(o);try{if("function"==typeof window.addEventListener){var c="onpagehide"in window?"pagehide":"unload";window.addEventListener(c,(function(){s.close()}),!1)}}catch(e){$e.error(f.UNABLE_TO_ATTACH_UNLOAD,"INDEX_BROWSER",e.message)}return s}catch(e){return $e.error(e),null}},tt=function(){Qe=!1},nt={logging:k,errorHandler:O,eventDispatcher:R,enums:w,setLogger:i.setLogHandler,setLogLevel:i.setLogLevel,createInstance:et,__internalResetRetryState:tt};Object.defineProperty(t,"setLogLevel",{enumerable:!0,get:function(){return i.setLogLevel}}),Object.defineProperty(t,"setLogger",{enumerable:!0,get:function(){return i.setLogHandler}}),t.__internalResetRetryState=tt,t.createInstance=et,t.default=nt,t.enums=w,t.errorHandler=O,t.eventDispatcher=R,t.logging=k},function(e,t,n){"use strict";function r(e,t){for(var n=e.toString();n.length<t;)n="0"+n;return n}function i(e){return r(e,2)}function a(t,n){"string"!=typeof t&&(n=t,t=e.exports.ISO8601_FORMAT),n||(n=e.exports.now());var a,o,s,c,u=i(n.getDate()),l=i(n.getMonth()+1),h=i(n.getFullYear()),d=i(h.substring(2,4)),f=t.indexOf("yyyy")>-1?h:d,p=i(n.getHours()),g=i(n.getMinutes()),m=i(n.getSeconds()),E=r(n.getMilliseconds(),3),v=(a=n.getTimezoneOffset(),o=Math.abs(a),s=String(Math.floor(o/60)),c=String(o%60),1===s.length&&(s="0"+s),1===c.length&&(c="0"+c),a<0?"+"+s+c:"-"+s+c);return t.replace(/dd/g,u).replace(/MM/g,l).replace(/y{1,4}/g,f).replace(/hh/g,p).replace(/mm/g,g).replace(/ss/g,m).replace(/SSS/g,E).replace(/O/g,v)}function o(e,t,n,r){e["set"+(r?"":"UTC")+t](n)}e.exports=a,e.exports.asString=a,e.exports.parse=function(t,n,r){if(!t)throw new Error("pattern must be supplied");return function(t,n,r){var i=t.indexOf("O")<0,a=[{pattern:/y{1,4}/,regexp:"\\d{1,4}",fn:function(e,t){o(e,"FullYear",t,i)}},{pattern:/MM/,regexp:"\\d{1,2}",fn:function(e,t){o(e,"Month",t-1,i)}},{pattern:/dd/,regexp:"\\d{1,2}",fn:function(e,t){o(e,"Date",t,i)}},{pattern:/hh/,regexp:"\\d{1,2}",fn:function(e,t){o(e,"Hours",t,i)}},{pattern:/mm/,regexp:"\\d\\d",fn:function(e,t){o(e,"Minutes",t,i)}},{pattern:/ss/,regexp:"\\d\\d",fn:function(e,t){o(e,"Seconds",t,i)}},{pattern:/SSS/,regexp:"\\d\\d\\d",fn:function(e,t){o(e,"Milliseconds",t,i)}},{pattern:/O/,regexp:"[+-]\\d{3,4}|Z",fn:function(e,t){"Z"===t&&(t=0);var n=Math.abs(t),r=(t>0?-1:1)*(n%100+60*Math.floor(n/100));e.setUTCMinutes(e.getUTCMinutes()+r)}}],s=a.reduce((function(e,t){return t.pattern.test(e.regexp)?(t.index=e.regexp.match(t.pattern).index,e.regexp=e.regexp.replace(t.pattern,"("+t.regexp+")")):t.index=-1,e}),{regexp:t,index:[]}),c=a.filter((function(e){return e.index>-1}));c.sort((function(e,t){return e.index-t.index}));var u=new RegExp(s.regexp).exec(n);if(u){var l=r||e.exports.now();return c.forEach((function(e,t){e.fn(l,u[t+1])})),l}throw new Error("String '"+n+"' could not be parsed as '"+t+"'")}(t,n,r)},e.exports.now=function(){return new Date},e.exports.ISO8601_FORMAT="yyyy-MM-ddThh:mm:ss.SSS",e.exports.ISO8601_WITH_TZ_OFFSET_FORMAT="yyyy-MM-ddThh:mm:ss.SSSO",e.exports.DATETIME_FORMAT="dd MM yyyy hh:mm:ss.SSS",e.exports.ABSOLUTETIME_FORMAT="hh:mm:ss.SSS"},,,,,,,,,,,function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";var r=n(48),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var o=new r.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,t.string2buf=function(e){var t,n,i,a,o,s=e.length,c=0;for(a=0;a<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(c),o=0,a=0;o<c;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,a,s=t||e.length,u=new Array(2*s);for(r=0,n=0;n<s;)if((i=e[n++])<128)u[r++]=i;else if((a=o[i])>4)u[r++]=65533,n+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&n<s;)i=i<<6|63&e[n++],a--;a>1?u[r++]=65533:i<65536?u[r++]=i:(i-=65536,u[r++]=55296|i>>10&1023,u[r++]=56320|1023&i)}return c(u,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.handleError=function(e){},e}();t.NoopErrorHandler=r;var i=new r;t.setErrorHandler=function(e){i=e},t.getErrorHandler=function(){return i},t.resetErrorHandler=function(){i=new r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NOTSET=0]="NOTSET",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR"}(t.LogLevel||(t.LogLevel={}))},function(e,t,n){var r=n(285),i=n(56),a=i;a.v1=r,a.v4=i,e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areEventContextsEqual=void 0,t.areEventContextsEqual=function(e,t){var n=e.context,r=t.context;return n.accountId===r.accountId&&n.projectId===r.projectId&&n.clientName===r.clientName&&n.clientVersion===r.clientVersion&&n.revision===r.revision&&n.anonymizeIP===r.anonymizeIP&&n.botFiltering===r.botFiltering}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendEventNotification=t.getQueue=t.validateAndGetBatchSize=t.validateAndGetFlushInterval=t.DEFAULT_BATCH_SIZE=t.DEFAULT_FLUSH_INTERVAL=void 0;var r=n(287),i=n(49),a=n(66);t.DEFAULT_FLUSH_INTERVAL=3e4,t.DEFAULT_BATCH_SIZE=10;var o=i.getLogger("EventProcessor");t.validateAndGetFlushInterval=function(e){return e<=0&&(o.warn("Invalid flushInterval "+e+", defaulting to "+t.DEFAULT_FLUSH_INTERVAL),e=t.DEFAULT_FLUSH_INTERVAL),e},t.validateAndGetBatchSize=function(e){return(e=Math.floor(e))<1&&(o.warn("Invalid batchSize "+e+", defaulting to "+t.DEFAULT_BATCH_SIZE),e=t.DEFAULT_BATCH_SIZE),e=Math.max(1,e)},t.getQueue=function(e,t,n,i){return e>1?new r.DefaultEventQueue({flushInterval:t,maxQueueSize:e,sink:n,batchComparator:i}):new r.SingleEventQueue({sink:n})},t.sendEventNotification=function(e,t){e&&e.sendNotifications(a.NOTIFICATION_TYPES.LOG_EVENT,t)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.formatEvents=t.buildConversionEventV1=t.buildImpressionEventV1=t.makeBatchedEventV1=void 0;function i(e){var t=[],n=e[0];return e.forEach((function(e){if("conversion"===e.type||"impression"===e.type){var n=s(e);"impression"===e.type?n.snapshots.push(o(e)):"conversion"===e.type&&n.snapshots.push(a(e)),t.push(n)}})),{client_name:n.context.clientName,client_version:n.context.clientVersion,account_id:n.context.accountId,project_id:n.context.projectId,revision:n.context.revision,anonymize_ip:n.context.anonymizeIP,enrich_decisions:!0,visitors:t}}function a(e){var t=r({},e.tags);delete t.revenue,delete t.value;var n={entity_id:e.event.id,key:e.event.key,timestamp:e.timestamp,uuid:e.uuid};return e.tags&&(n.tags=e.tags),null!=e.value&&(n.value=e.value),null!=e.revenue&&(n.revenue=e.revenue),{events:[n]}}function o(e){var t=e.layer,n=e.experiment,r=e.variation,i=e.ruleKey,a=e.flagKey,o=e.ruleType,s=t?t.id:null;return{decisions:[{campaign_id:s,experiment_id:n?n.id:null,variation_id:r?r.id:null,metadata:{flag_key:a,rule_key:i,rule_type:o,variation_key:r?r.key:""}}],events:[{entity_id:s,timestamp:e.timestamp,key:"campaign_activated",uuid:e.uuid}]}}function s(e){var t={snapshots:[],visitor_id:e.user.id,attributes:[]};return e.user.attributes.forEach((function(e){t.attributes.push({entity_id:e.entityId,key:e.key,type:"custom",value:e.value})})),"boolean"==typeof e.context.botFiltering&&t.attributes.push({entity_id:"$opt_bot_filtering",key:"$opt_bot_filtering",type:"custom",value:e.context.botFiltering}),t}t.makeBatchedEventV1=i,t.buildImpressionEventV1=function(e){var t=s(e);return t.snapshots.push(o(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}},t.buildConversionEventV1=function(e){var t=s(e);return t.snapshots.push(a(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}},t.formatEvents=function(e){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:i(e)}}},function(e,t){var n={utf8:{stringToBytes:function(e){return n.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=n},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(2);n(26);t.a=class{constructor(){this.storage=new Map}update(e,t){EBATES.member.isExtensionDisabled()?"not-certified"===EBATES.member.get("gdprCertificationStatus")?r.a.ui.button.setBadgeText("1"):r.a.ui.button.setBadgeText(""):(e&&this.storage.set(e,t),this.display())}display(){let e=0;this.storage.forEach(t=>e+=t),r.a.ui.button.setBadgeText(e>0?e:"")}}},function(e,t,n){"use strict";var r=n(109),i=n.n(r),a=n(2),o=n(24);n(26);t.a=class{constructor(){this.activatedTests=[],a.a.browser.isChrome&&(i.a.setLogger(null),this.optimizely=i.a.createInstance({sdkKey:"PPyVHL2msj5ovR7W7wP75R",datafileOptions:{autoUpdate:!0,updateInterval:36e5}})),a.a.extension.attachEvent("tests",(e,t)=>{t(this.toJSON())}),a.a.extension.attachEvent("tests.activate",(e,t)=>{t(this.activate(e.data.id))})}onReady(){return a.a.browser.isChrome?this.optimizely.onReady({timeout:3e3}):Promise.resolve()}toJSON(){if(a.a.browser.isChrome){const e=this.optimizely.getOptimizelyConfig();if(e&&e.experimentsMap)return Object.keys(this.optimizely.getOptimizelyConfig().experimentsMap).reduce((e,t)=>{if(0===t.toLowerCase().indexOf("btn")){let n=this.get(t);n&&(e[t]=n)}return e},{})}return{}}get(e){return a.a.browser.isChrome?(("number"==typeof e||/^\d+$/.test(e))&&(e="BTN".concat(e)),this.optimizely.getVariation(e,EBATES.member.id||toolbarId.toString(),{platform:"Button",app_version:a.a.browser.version,application_subtype:a.a.browser.name})):null}async activate(e){if(a.a.browser.isChrome){("number"==typeof e||/^\d+$/.test(e))&&(e="BTN".concat(e));const t=this.optimizely[o.b.disabled?"getVariation":"activate"](e,EBATES.member.id||toolbarId.toString(),{platform:"Button",app_version:a.a.browser.version,application_subtype:a.a.browser.name});return t&&(this.activatedTests[e]=t,EBATES.member.identify(),o.b.track("View Experiment",{experiment_name:e,variation_name:"".concat(e).concat(t),activation_id:EBATES.member.id||toolbarId.toString(),activation_id_type:EBATES.member.id?"guid":"anonymous"}),EBATES.log({event_type:"test_group_tracking",user_id:EBATES.member.id,test_group:"".concat(e).concat(t)})),t}return null}getExperiments(){let e=this.activatedTests;return Object.keys(e).reduce((t,n)=>(t["experiment_".concat(n)]="".concat(n).concat(e[n]),t),{})}}},function(e,t,n){(function(n){var r;t=e.exports=d,r="object"==typeof n&&n.env&&n.env.NODE_DEBUG&&/\bsemver\b/i.test(n.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER")}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var i=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],o=t.src=[],s=t.tokens={},c=0;function u(e){s[e]=c++}u("NUMERICIDENTIFIER"),o[s.NUMERICIDENTIFIER]="0|[1-9]\\d*",u("NUMERICIDENTIFIERLOOSE"),o[s.NUMERICIDENTIFIERLOOSE]="[0-9]+",u("NONNUMERICIDENTIFIER"),o[s.NONNUMERICIDENTIFIER]="\\d*[a-zA-Z-][a-zA-Z0-9-]*",u("MAINVERSION"),o[s.MAINVERSION]="("+o[s.NUMERICIDENTIFIER]+")\\.("+o[s.NUMERICIDENTIFIER]+")\\.("+o[s.NUMERICIDENTIFIER]+")",u("MAINVERSIONLOOSE"),o[s.MAINVERSIONLOOSE]="("+o[s.NUMERICIDENTIFIERLOOSE]+")\\.("+o[s.NUMERICIDENTIFIERLOOSE]+")\\.("+o[s.NUMERICIDENTIFIERLOOSE]+")",u("PRERELEASEIDENTIFIER"),o[s.PRERELEASEIDENTIFIER]="(?:"+o[s.NUMERICIDENTIFIER]+"|"+o[s.NONNUMERICIDENTIFIER]+")",u("PRERELEASEIDENTIFIERLOOSE"),o[s.PRERELEASEIDENTIFIERLOOSE]="(?:"+o[s.NUMERICIDENTIFIERLOOSE]+"|"+o[s.NONNUMERICIDENTIFIER]+")",u("PRERELEASE"),o[s.PRERELEASE]="(?:-("+o[s.PRERELEASEIDENTIFIER]+"(?:\\."+o[s.PRERELEASEIDENTIFIER]+")*))",u("PRERELEASELOOSE"),o[s.PRERELEASELOOSE]="(?:-?("+o[s.PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+o[s.PRERELEASEIDENTIFIERLOOSE]+")*))",u("BUILDIDENTIFIER"),o[s.BUILDIDENTIFIER]="[0-9A-Za-z-]+",u("BUILD"),o[s.BUILD]="(?:\\+("+o[s.BUILDIDENTIFIER]+"(?:\\."+o[s.BUILDIDENTIFIER]+")*))",u("FULL"),u("FULLPLAIN"),o[s.FULLPLAIN]="v?"+o[s.MAINVERSION]+o[s.PRERELEASE]+"?"+o[s.BUILD]+"?",o[s.FULL]="^"+o[s.FULLPLAIN]+"$",u("LOOSEPLAIN"),o[s.LOOSEPLAIN]="[v=\\s]*"+o[s.MAINVERSIONLOOSE]+o[s.PRERELEASELOOSE]+"?"+o[s.BUILD]+"?",u("LOOSE"),o[s.LOOSE]="^"+o[s.LOOSEPLAIN]+"$",u("GTLT"),o[s.GTLT]="((?:<|>)?=?)",u("XRANGEIDENTIFIERLOOSE"),o[s.XRANGEIDENTIFIERLOOSE]=o[s.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*",u("XRANGEIDENTIFIER"),o[s.XRANGEIDENTIFIER]=o[s.NUMERICIDENTIFIER]+"|x|X|\\*",u("XRANGEPLAIN"),o[s.XRANGEPLAIN]="[v=\\s]*("+o[s.XRANGEIDENTIFIER]+")(?:\\.("+o[s.XRANGEIDENTIFIER]+")(?:\\.("+o[s.XRANGEIDENTIFIER]+")(?:"+o[s.PRERELEASE]+")?"+o[s.BUILD]+"?)?)?",u("XRANGEPLAINLOOSE"),o[s.XRANGEPLAINLOOSE]="[v=\\s]*("+o[s.XRANGEIDENTIFIERLOOSE]+")(?:\\.("+o[s.XRANGEIDENTIFIERLOOSE]+")(?:\\.("+o[s.XRANGEIDENTIFIERLOOSE]+")(?:"+o[s.PRERELEASELOOSE]+")?"+o[s.BUILD]+"?)?)?",u("XRANGE"),o[s.XRANGE]="^"+o[s.GTLT]+"\\s*"+o[s.XRANGEPLAIN]+"$",u("XRANGELOOSE"),o[s.XRANGELOOSE]="^"+o[s.GTLT]+"\\s*"+o[s.XRANGEPLAINLOOSE]+"$",u("COERCE"),o[s.COERCE]="(^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])",u("COERCERTL"),a[s.COERCERTL]=new RegExp(o[s.COERCE],"g"),u("LONETILDE"),o[s.LONETILDE]="(?:~>?)",u("TILDETRIM"),o[s.TILDETRIM]="(\\s*)"+o[s.LONETILDE]+"\\s+",a[s.TILDETRIM]=new RegExp(o[s.TILDETRIM],"g");u("TILDE"),o[s.TILDE]="^"+o[s.LONETILDE]+o[s.XRANGEPLAIN]+"$",u("TILDELOOSE"),o[s.TILDELOOSE]="^"+o[s.LONETILDE]+o[s.XRANGEPLAINLOOSE]+"$",u("LONECARET"),o[s.LONECARET]="(?:\\^)",u("CARETTRIM"),o[s.CARETTRIM]="(\\s*)"+o[s.LONECARET]+"\\s+",a[s.CARETTRIM]=new RegExp(o[s.CARETTRIM],"g");u("CARET"),o[s.CARET]="^"+o[s.LONECARET]+o[s.XRANGEPLAIN]+"$",u("CARETLOOSE"),o[s.CARETLOOSE]="^"+o[s.LONECARET]+o[s.XRANGEPLAINLOOSE]+"$",u("COMPARATORLOOSE"),o[s.COMPARATORLOOSE]="^"+o[s.GTLT]+"\\s*("+o[s.LOOSEPLAIN]+")$|^$",u("COMPARATOR"),o[s.COMPARATOR]="^"+o[s.GTLT]+"\\s*("+o[s.FULLPLAIN]+")$|^$",u("COMPARATORTRIM"),o[s.COMPARATORTRIM]="(\\s*)"+o[s.GTLT]+"\\s*("+o[s.LOOSEPLAIN]+"|"+o[s.XRANGEPLAIN]+")",a[s.COMPARATORTRIM]=new RegExp(o[s.COMPARATORTRIM],"g");u("HYPHENRANGE"),o[s.HYPHENRANGE]="^\\s*("+o[s.XRANGEPLAIN]+")\\s+-\\s+("+o[s.XRANGEPLAIN]+")\\s*$",u("HYPHENRANGELOOSE"),o[s.HYPHENRANGELOOSE]="^\\s*("+o[s.XRANGEPLAINLOOSE]+")\\s+-\\s+("+o[s.XRANGEPLAINLOOSE]+")\\s*$",u("STAR"),o[s.STAR]="(<|>)?=?\\s*\\*";for(var l=0;l<c;l++)r(l,o[l]),a[l]||(a[l]=new RegExp(o[l]));function h(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof d)return e;if("string"!=typeof e)return null;if(e.length>256)return null;if(!(t.loose?a[s.LOOSE]:a[s.FULL]).test(e))return null;try{return new d(e,t)}catch(e){return null}}function d(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof d){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof d))return new d(e,t);r("SemVer",e,t),this.options=t,this.loose=!!t.loose;var n=e.trim().match(t.loose?a[s.LOOSE]:a[s.FULL]);if(!n)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}t.parse=h,t.valid=function(e,t){var n=h(e,t);return n?n.version:null},t.clean=function(e,t){var n=h(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},t.SemVer=d,d.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},d.prototype.toString=function(){return this.version},d.prototype.compare=function(e){return r("SemVer.compare",this.version,this.options,e),e instanceof d||(e=new d(e,this.options)),this.compareMain(e)||this.comparePre(e)},d.prototype.compareMain=function(e){return e instanceof d||(e=new d(e,this.options)),p(this.major,e.major)||p(this.minor,e.minor)||p(this.patch,e.patch)},d.prototype.comparePre=function(e){if(e instanceof d||(e=new d(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var n=this.prerelease[t],i=e.prerelease[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return p(n,i)}while(++t)},d.prototype.compareBuild=function(e){e instanceof d||(e=new d(e,this.options));var t=0;do{var n=this.build[t],i=e.build[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return p(n,i)}while(++t)},d.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,n,r){"string"==typeof n&&(r=n,n=void 0);try{return new d(e,n).inc(t,r).version}catch(e){return null}},t.diff=function(e,t){if(v(e,t))return null;var n=h(e),r=h(t),i="";if(n.prerelease.length||r.prerelease.length){i="pre";var a="prerelease"}for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==r[o])return i+o;return a},t.compareIdentifiers=p;var f=/^[0-9]+$/;function p(e,t){var n=f.test(e),r=f.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1}function g(e,t,n){return new d(e,n).compare(new d(t,n))}function m(e,t,n){return g(e,t,n)>0}function E(e,t,n){return g(e,t,n)<0}function v(e,t,n){return 0===g(e,t,n)}function _(e,t,n){return 0!==g(e,t,n)}function y(e,t,n){return g(e,t,n)>=0}function b(e,t,n){return g(e,t,n)<=0}function I(e,t,n,r){switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return v(e,n,r);case"!=":return _(e,n,r);case">":return m(e,n,r);case">=":return y(e,n,r);case"<":return E(e,n,r);case"<=":return b(e,n,r);default:throw new TypeError("Invalid operator: "+t)}}function w(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof w){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof w))return new w(e,t);r("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===T?this.value="":this.value=this.operator+this.semver.version,r("comp",this)}t.rcompareIdentifiers=function(e,t){return p(t,e)},t.major=function(e,t){return new d(e,t).major},t.minor=function(e,t){return new d(e,t).minor},t.patch=function(e,t){return new d(e,t).patch},t.compare=g,t.compareLoose=function(e,t){return g(e,t,!0)},t.compareBuild=function(e,t,n){var r=new d(e,n),i=new d(t,n);return r.compare(i)||r.compareBuild(i)},t.rcompare=function(e,t,n){return g(t,e,n)},t.sort=function(e,n){return e.sort((function(e,r){return t.compareBuild(e,r,n)}))},t.rsort=function(e,n){return e.sort((function(e,r){return t.compareBuild(r,e,n)}))},t.gt=m,t.lt=E,t.eq=v,t.neq=_,t.gte=y,t.lte=b,t.cmp=I,t.Comparator=w;var T={};function A(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof A)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new A(e.raw,t);if(e instanceof w)return new A(e.value,t);if(!(this instanceof A))return new A(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((function(e){return this.parseRange(e.trim())}),this).filter((function(e){return e.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function S(e,t){for(var n=!0,r=e.slice(),i=r.pop();n&&r.length;)n=r.every((function(e){return i.intersects(e,t)})),i=r.pop();return n}function O(e){return!e||"x"===e.toLowerCase()||"*"===e}function R(e,t,n,r,i,a,o,s,c,u,l,h,d){return((t=O(n)?"":O(r)?">="+n+".0.0":O(i)?">="+n+"."+r+".0":">="+t)+" "+(s=O(c)?"":O(u)?"<"+(+c+1)+".0.0":O(l)?"<"+c+"."+(+u+1)+".0":h?"<="+c+"."+u+"."+l+"-"+h:"<="+s)).trim()}function N(e,t,n){for(var i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(i=0;i<e.length;i++)if(r(e[i].semver),e[i].semver!==T&&e[i].semver.prerelease.length>0){var a=e[i].semver;if(a.major===t.major&&a.minor===t.minor&&a.patch===t.patch)return!0}return!1}return!0}function k(e,t,n){try{t=new A(t,n)}catch(e){return!1}return t.test(e)}function x(e,t,n,r){var i,a,o,s,c;switch(e=new d(e,r),t=new A(t,r),n){case">":i=m,a=b,o=E,s=">",c=">=";break;case"<":i=E,a=y,o=m,s="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(k(e,t,r))return!1;for(var u=0;u<t.set.length;++u){var l=t.set[u],h=null,f=null;if(l.forEach((function(e){e.semver===T&&(e=new w(">=0.0.0")),h=h||e,f=f||e,i(e.semver,h.semver,r)?h=e:o(e.semver,f.semver,r)&&(f=e)})),h.operator===s||h.operator===c)return!1;if((!f.operator||f.operator===s)&&a(e,f.semver))return!1;if(f.operator===c&&o(e,f.semver))return!1}return!0}w.prototype.parse=function(e){var t=this.options.loose?a[s.COMPARATORLOOSE]:a[s.COMPARATOR],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: "+e);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new d(n[2],this.options.loose):this.semver=T},w.prototype.toString=function(){return this.value},w.prototype.test=function(e){if(r("Comparator.test",e,this.options.loose),this.semver===T||e===T)return!0;if("string"==typeof e)try{e=new d(e,this.options)}catch(e){return!1}return I(e,this.operator,this.semver,this.options)},w.prototype.intersects=function(e,t){if(!(e instanceof w))throw new TypeError("a Comparator is required");var n;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||(n=new A(e.value,t),k(this.value,n,t));if(""===e.operator)return""===e.value||(n=new A(this.value,t),k(e.semver,n,t));var r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),a=this.semver.version===e.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=I(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=I(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||i||a&&o||s||c},t.Range=A,A.prototype.format=function(){return this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim(),this.range},A.prototype.toString=function(){return this.range},A.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var n=t?a[s.HYPHENRANGELOOSE]:a[s.HYPHENRANGE];e=e.replace(n,R),r("hyphen replace",e),e=e.replace(a[s.COMPARATORTRIM],"$1$2$3"),r("comparator trim",e,a[s.COMPARATORTRIM]),e=(e=(e=e.replace(a[s.TILDETRIM],"$1~")).replace(a[s.CARETTRIM],"$1^")).split(/\s+/).join(" ");var i=t?a[s.COMPARATORLOOSE]:a[s.COMPARATOR],o=e.split(" ").map((function(e){return function(e,t){return r("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){r("caret",e,t);var n=t.loose?a[s.CARETLOOSE]:a[s.CARET];return e.replace(n,(function(t,n,i,a,o){var s;return r("caret",e,t,n,i,a,o),O(n)?s="":O(i)?s=">="+n+".0.0 <"+(+n+1)+".0.0":O(a)?s="0"===n?">="+n+"."+i+".0 <"+n+"."+(+i+1)+".0":">="+n+"."+i+".0 <"+(+n+1)+".0.0":o?(r("replaceCaret pr",o),s="0"===n?"0"===i?">="+n+"."+i+"."+a+"-"+o+" <"+n+"."+i+"."+(+a+1):">="+n+"."+i+"."+a+"-"+o+" <"+n+"."+(+i+1)+".0":">="+n+"."+i+"."+a+"-"+o+" <"+(+n+1)+".0.0"):(r("no pr"),s="0"===n?"0"===i?">="+n+"."+i+"."+a+" <"+n+"."+i+"."+(+a+1):">="+n+"."+i+"."+a+" <"+n+"."+(+i+1)+".0":">="+n+"."+i+"."+a+" <"+(+n+1)+".0.0"),r("caret return",s),s}))}(e,t)})).join(" ")}(e,t),r("caret",e),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){var n=t.loose?a[s.TILDELOOSE]:a[s.TILDE];return e.replace(n,(function(t,n,i,a,o){var s;return r("tilde",e,t,n,i,a,o),O(n)?s="":O(i)?s=">="+n+".0.0 <"+(+n+1)+".0.0":O(a)?s=">="+n+"."+i+".0 <"+n+"."+(+i+1)+".0":o?(r("replaceTilde pr",o),s=">="+n+"."+i+"."+a+"-"+o+" <"+n+"."+(+i+1)+".0"):s=">="+n+"."+i+"."+a+" <"+n+"."+(+i+1)+".0",r("tilde return",s),s}))}(e,t)})).join(" ")}(e,t),r("tildes",e),e=function(e,t){return r("replaceXRanges",e,t),e.split(/\s+/).map((function(e){return function(e,t){e=e.trim();var n=t.loose?a[s.XRANGELOOSE]:a[s.XRANGE];return e.replace(n,(function(n,i,a,o,s,c){r("xRange",e,n,i,a,o,s,c);var u=O(a),l=u||O(o),h=l||O(s),d=h;return"="===i&&d&&(i=""),c=t.includePrerelease?"-0":"",u?n=">"===i||"<"===i?"<0.0.0-0":"*":i&&d?(l&&(o=0),s=0,">"===i?(i=">=",l?(a=+a+1,o=0,s=0):(o=+o+1,s=0)):"<="===i&&(i="<",l?a=+a+1:o=+o+1),n=i+a+"."+o+"."+s+c):l?n=">="+a+".0.0"+c+" <"+(+a+1)+".0.0"+c:h&&(n=">="+a+"."+o+".0"+c+" <"+a+"."+(+o+1)+".0"+c),r("xRange return",n),n}))}(e,t)})).join(" ")}(e,t),r("xrange",e),e=function(e,t){return r("replaceStars",e,t),e.trim().replace(a[s.STAR],"")}(e,t),r("stars",e),e}(e,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(o=o.filter((function(e){return!!e.match(i)}))),o=o.map((function(e){return new w(e,this.options)}),this)},A.prototype.intersects=function(e,t){if(!(e instanceof A))throw new TypeError("a Range is required");return this.set.some((function(n){return S(n,t)&&e.set.some((function(e){return S(e,t)&&n.every((function(n){return e.every((function(e){return n.intersects(e,t)}))}))}))}))},t.toComparators=function(e,t){return new A(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))},A.prototype.test=function(e){if(!e)return!1;if("string"==typeof e)try{e=new d(e,this.options)}catch(e){return!1}for(var t=0;t<this.set.length;t++)if(N(this.set[t],e,this.options))return!0;return!1},t.satisfies=k,t.maxSatisfying=function(e,t,n){var r=null,i=null;try{var a=new A(t,n)}catch(e){return null}return e.forEach((function(e){a.test(e)&&(r&&-1!==i.compare(e)||(i=new d(r=e,n)))})),r},t.minSatisfying=function(e,t,n){var r=null,i=null;try{var a=new A(t,n)}catch(e){return null}return e.forEach((function(e){a.test(e)&&(r&&1!==i.compare(e)||(i=new d(r=e,n)))})),r},t.minVersion=function(e,t){e=new A(e,t);var n=new d("0.0.0");if(e.test(n))return n;if(n=new d("0.0.0-0"),e.test(n))return n;n=null;for(var r=0;r<e.set.length;++r){e.set[r].forEach((function(e){var t=new d(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":n&&!m(n,t)||(n=t);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}))}if(n&&e.test(n))return n;return null},t.validRange=function(e,t){try{return new A(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,n){return x(e,t,"<",n)},t.gtr=function(e,t,n){return x(e,t,">",n)},t.outside=x,t.prerelease=function(e,t){var n=h(e,t);return n&&n.prerelease.length?n.prerelease:null},t.intersects=function(e,t,n){return e=new A(e,n),t=new A(t,n),e.intersects(t)},t.coerce=function(e,t){if(e instanceof d)return e;"number"==typeof e&&(e=String(e));if("string"!=typeof e)return null;var n=null;if((t=t||{}).rtl){for(var r;(r=a[s.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&r.index+r[0].length===n.index+n[0].length||(n=r),a[s.COERCERTL].lastIndex=r.index+r[1].length+r[2].length;a[s.COERCERTL].lastIndex=-1}else n=e.match(a[s.COERCE]);if(null===n)return null;return h(n[2]+"."+(n[3]||"0")+"."+(n[4]||"0"),t)}}).call(this,n(64))},function(e,t,n){"use strict";(function(e){var r=n(0),i=n(5),a=n.n(i),o=n(2),s=n(8),c=n(7),u=n(9),l=n(181),h=n(40);n(26);t.a=u.c.extend({key:"products",DEFAULT_UPDATE_INTERVAL:864e5,url:Object(s.k)(c.a.SETTINGS_PRODUCTS),initialize(){o.a.extension.attachEvent("getProducts",(e,t)=>{t(this.toJSON())}),this.fetch().catch(()=>this.readCache({cache:!0}))},parse:e=>e.stores});let d=a.a.Model.extend({toJSON(e){let t=this.get("storeId")?EBATES.merchants.findWhere({storeId:parseInt(this.get("storeId"),10)}):null,n=Object(s.i)(r.default.clone(this.attributes),"https://product-image.ebates.com");return r.default.extend(n,{merchant:t?t.toJSON(e):null})},parse:e=>"object"==typeof e.product?e.product:e}),f=u.a.extend({url:()=>Object(s.k)(c.a.SEARCH_PRODUCTS),model:d,parse:e=>e.grouped.groupList});o.a.extension.attachEvent("searchProducts",(e,t)=>{(new f).fetch({data:e.data,success(e){t(e.toJSON())},error(){t(null)}}).catch(()=>{})});var p=a.a.Collection.extend({model:d,url:()=>Object(s.k)(c.a.SIMILAR_PRODUCTS),parse:e=>e&&e.hits&&e.hits.hits?e.hits.hits.map(t=>({...t._source,algorithmMatched:t._source.algorithmMatched||e.algorithmMatched})):null});o.a.extension.attachEvent("getSimilarProducts",(t,n)=>{let{requestAllowed:r,request:i}=t.data;i.term&&!i.title&&(i.title=i.term,delete i.term),(new l.a).find({url:t.url,...i}).then(e=>{n({products:e,url:"",error:!1})},()=>{if(!1===r)n();else{let r=new p;if(t.data.sourceName){let e="function"==typeof r.url?r.url():r.url;r.url=e.replace(/sourceName=Toolbar/i,"sourceName=".concat(t.data.sourceName))}r.fetch({data:i,success(r){let a="function"==typeof r.url?r.url():r.url;a="".concat(a,"&").concat(e.param(i)),r.length?EBATES.merchants.channelRewards.get(h.b).fetch().then(()=>{n({error:!1,url:a,products:r.toJSON({channel:h.b})})}).catch(()=>{}):n({error:!0,url:a,message:"0 results found",status:0,details:t.data.term})},error(t,r){let a="function"==typeof t.url?t.url():t.url;a="".concat(a,"&").concat(e.param(i)),r&&r.responseJSON&&r.responseJSON.apiHeader&&r.responseJSON.apiHeader?n({error:!0,url:a,status:r.status,message:"Request failed",details:r.responseJSON.apiHeader.message}):n({error:!0,url:a,status:r.status,message:"API error",xhr:r.responseText})}})}})})}).call(this,n(1))},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(0),i=n(2),a=(n(26),n(8)),o=n(82),s=n(9),c=n(40);const u=s.d.extend({DEFAULT_UPDATE_INTERVAL:18e4,dynamic:!1,idAttribute:"storeId",url:()=>Object(a.k)("https://%api%/apituner/v1/store/reward/list?channel=".concat(c.b,"&id=18397")),parse:e=>e.store[0].reward});class l extends o.a{constructor(){super(),this._id="verishop",this.UPDATE_INTERVAL=108e5,this.reward=new u}get url(){return"https://static.rakuten.com/toolbar/config/verishop.json"}find({storeName:e,asin:t}){return i.a.browser.isChrome&&"Amazon"===e&&t&&EBATES.settings.featureFlags.variation("verishop",!0)?this.load().then(e=>{let n=e.find(e=>e.asin===t);return n?this.reward.fetch().then(()=>{let e=EBATES.merchants.get(18397).toJSON(),t=this.reward.toJSON();return t.total&&!r.default.isEqual(t.total,e.reward.total)&&(e={...e,reward:t,sessionReward:t.total}),n={merchant:e,channel:c.b,store:"Verishop",storeId:"18397",eligibleForCashBack:!0,...n},[n]}):Promise.reject("Verishop Product not found")}):Promise.reject()}}},function(e,t,n){"use strict";var r=n(1),i=n.n(r),a=n(2),o=n(51),s=n(8);n(26);let c;var u={};a.a.browser.isLegacyEdge&&(u={neutral:{40:"img/rakuten/icon-32.png"},activated:{40:"img/rakuten/icon-32-activated.png"},available:{40:"img/rakuten/icon-32-notactivated-bg.png"}}),t.a=class{constructor(){let e=100,t=5,n=11,r=8.75,h=3.3,d=new Map,f=new Map,p=t,g=0,m=(a.a.browser.isWebKit?new OffscreenCanvas(32,32):i()('<canvas id="canvas" width="'.concat(32,'" height="').concat(32,'"></canvas>')).get(0)).getContext("2d"),E=!1,v=e=>fetch(e).then(e=>{if(e.ok)return e.blob();throw Promise.reject(e.statusText)}).then(e=>new Promise(t=>{let n=new Image;n.onload=()=>t(n),n.setAttribute("src",URL.createObjectURL(e))})),_=e=>(e=>{if(EBATES){let t=EBATES.settings.promos.get("icons");if(t&&t.get("active")&&t.get(e))return v(t.get(e))}return Promise.reject()})(e).catch(()=>v(e)),y=()=>a.a.browser.isLegacyEdge?Promise.resolve():E?new Promise(e=>{window.setTimeout(()=>y().then(e),100)}):(E=!0,Promise.all([_("/img/rakuten/icon-32.png"),_("/img/rakuten/icon-32-activated.png"),_("/img/rakuten/icon-32-notactivated.png")]).then(([e,t,n])=>{d=new Map,f.set("neutral",e),f.set("activated",t),f.set("available",n)}).catch(()=>{window.setTimeout(()=>{y()},6e4)}).then(()=>{E=!1})),b=(e,t)=>{let n=d.get(e);if(n||(n=new Map,d.set(e,n)),!n.get(t)){m.clearRect(0,0,32,32),"neutral"!==e&&(m.setLineDash([0]),"activated"===e?(m.lineWidth=2,m.strokeStyle="#4990e2",m.fillStyle="#FFF"):"available"===e&&(m.lineWidth=2,m.fillStyle="#ee5051",m.strokeStyle="#ee5051"),m.roundRect(16-t*h/2,16-t*h/2,t*h,t*h,{upperLeft:4,upperRight:4,lowerLeft:4,lowerRight:4},!0));try{m.drawImage(f.get(e),0,0,32,32),n.set(t,m.getImageData(0,0,32,32))}catch(e){}}return{imageData:{32:n.get(t)}}},I=({type:i,count:o=0})=>{if(w(),a.a.browser.isSafari||a.a.browser.isLegacyEdge)return l(u[i]);c=window.setInterval(()=>(({type:e,count:i})=>{if(++p>=n&&(p=t,g++),i&&g>i&&p>=r)return g=0,w(e);l(b(e,p))})({type:i,count:o}),e)},w=e=>{c&&window.clearInterval(c),p=t,g=0,e&&(a.a.browser.isSafari||a.a.browser.isLegacyEdge?l(u[e]):l(b(e,r)))};this.load=()=>y().then(()=>w("neutral")),this.load(),window.setInterval(()=>this.load(),108e5);let T=e=>{if(!EBATES)return;let t=e.url||o.a.active.url,n=e.tabId||o.a.active.tabId;if(t&&t.startsWith("http")&&!Object(s.g)(t)){var r=EBATES.merchants.match(t);if(r&&!r.get("suppressed")&&(r.get("settings_icon")||6===r.get("activationCode")&&r.get("activated")))if(r.get("activated"))r.get("notification")?I({type:"activated",count:2}):w("activated");else{EBATES.settings.affiliates.state(n).suppress?w("neutral"):I({type:"available",count:4})}else w("neutral")}else w("neutral")};a.a.browser.attachEvent(a.a.browser.DOCUMENTCOMPLETE,T),a.a.browser.attachEvent(a.a.browser.TABCHANGED,T),a.a.extension.attachEvent("merchant.state:change",T)}};let l=e=>{if(e)try{a.a.browser.isLegacyEdge?a.a.ui.button.setIcon(e):browser.browserAction.setIcon(e)}catch(e){}};CanvasRenderingContext2D.prototype.roundRect=function(e,t,n,r,i,a,o){var s={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};void 0===o&&(o=!0),"object"==typeof i&&Object.keys(i).forEach(e=>{Object.prototype.hasOwnProperty.call(s,e)&&(s[e]=i[e])}),this.beginPath(),this.moveTo(e+s.upperLeft,t),this.lineTo(e+n-s.upperRight,t),this.quadraticCurveTo(e+n,t,e+n,t+s.upperRight),this.lineTo(e+n,t+r-s.lowerRight),this.quadraticCurveTo(e+n,t+r,e+n-s.lowerRight,t+r),this.lineTo(e+s.lowerLeft,t+r),this.quadraticCurveTo(e,t+r,e,t+r-s.lowerLeft),this.lineTo(e,t+s.upperLeft),this.quadraticCurveTo(e,t,e+s.upperLeft,t),this.closePath(),o&&this.stroke(),a&&this.fill()}},function(e,t,n){"use strict";(function(e){var r=n(0),i=n(11),a=n.n(i),o=n(5),s=n.n(o),c=n(2),u=n(7),l=n(9),h=n(43),d=n(184),f=n(185),p=n(186),g=n(53),m=n(187),E=n(188),v=n(24),_=n(8),y=n(78),b=n(189);n(26);let I=l.a.extend({key:"trackingtickets",url:()=>Object(_.k)(u.a.MEMBER_TICKETS),parse:e=>r.default.flatten(e.tickets)}),w=h.a.extend({url:()=>Object(_.k)(u.a.DEALS),comparator(e){let t=EBATES.member.favorites.get(e.get("storeId"));return t?(e.set({section:"favorite"}),EBATES.member.favorites.indexOf(EBATES.member.favorites.get(e.get("storeId")))):(t=EBATES.member.purchased.get(e.get("storeId")),t?(e.set({section:"purchased"}),EBATES.member.favorites.length+EBATES.member.purchased.indexOf(t)):(t=EBATES.member.visited.get(e.get("storeId")),t?(e.set({section:"visited"}),EBATES.member.favorites.length+EBATES.member.purchased.length+EBATES.member.visited.indexOf(t)):(e.unset("section"),EBATES.member.favorites.length+EBATES.member.purchased.length+EBATES.member.visited.length+e.collection.indexOf(e))))},fetch(){return Promise.all([EBATES.member.favorites.fetch(),EBATES.member.get("accessLevel")?EBATES.member.purchased.fetch():null,EBATES.member.visited.fetch()]).catch(()=>{}).then(()=>h.a.prototype.fetch.apply(this,arguments))}}),T=s.a.Model.extend({idAttribute:"storeId"}),A=h.b.extend({model:T,url:()=>Object(_.k)(u.a.MEMBER_FAVORITES),parse:e=>r.default.chain(e.favorites).map(e=>(e.id&&!e.storeId&&(e.storeId=e.id),delete e.id,e)).flatten().value()}),S=h.b.extend({model:T,url:()=>Object(_.k)(u.a.MEMBER_VISITED),parse:e=>r.default.chain(e.stores).map(e=>(e.id&&!e.storeId&&(e.storeId=e.id),delete e.id,e)).flatten().value()}),O=h.b.extend({model:T,url:()=>Object(_.k)(u.a.MEMBER_PURCHASED),parse:e=>e.stores}),R=l.f.extend({key:"account",initialize(){this.on({"change:pendingAmount change:paidAmount":function(){var e=this.get("pendingAmount"),t=this.get("paidAmount");Number.isFinite(e)&&Number.isFinite(t)&&this.set({totalAmount:e+t})},"change:totalAmount":function(e){var t=e.get("totalAmount"),n=e.previous("totalAmount");Number.isFinite(n)&&Number.isFinite(t)&&t>n&&EBATES.member.trackingtickets.fetch().catch().then(()=>{let e=EBATES.member.trackingtickets.find(e=>e.has("memberReward")&&e.get("memberReward").amount&&parseFloat(e.get("memberReward").amount));if(e&&e.get("storeId")&&!EBATES.member.messages.find(t=>t.get("memberReward")&&t.get("memberReward").amount===e.get("memberReward").amount)){let t=()=>{let t=EBATES.merchants.get(e.get("storeId"));t&&t.get("storeName")&&EBATES.member.messages.add(r.default.extend(e.pick("memberReward","storeId"),{desktop:!!EBATES.settings.userSettings.get("desktopNotifications").cashBack,popup:!0,title:"$".concat(e.get("memberReward").amount," just added!"),text:"You just earned $".concat(e.get("memberReward").amount," Cash Back from your purchase at ").concat(t.get("storeName"),"! "),type:"cashback",url:Object(_.k)("/pending-cash-back.htm?tb=yes&eeid=26117"),cta:"See Cash Back Activity"}))};EBATES.merchants&&EBATES.merchants.length?t():r.default.delay(()=>t(),2e3)}})}}),this.trigger("change:pendingAmount")}}),N=l.b.extend({timeout:864e5,defaults:{chStatus:!1,psStatus:!1,itaStatus:!1},url:()=>Object(_.k)(u.a.MEMBER_CCINFO),initialize(){c.a.extension.attachEvent("getCCInfo",(e,t)=>{this.fetch().catch(()=>{}).then(()=>t(this.toJSON()))}),this.on({error:function(e,t){Object(r.default)([401,403]).includes(t.status)&&EBATES.onTokenExpired()}})},toJSON(){let e=l.b.prototype.toJSON.apply(this,arguments);if(e){let t=EBATES.settings.promos.get("rakuten-cc");t&&t.isActive()&&(e.chCardType="rakuten")}return e}});var k=l.b.extend({idAttribute:"member_guid",url:()=>Object(_.k)(u.a.EDS),parse:e=>e._source});let x=l.d.extend({key:"activity",ERROR_UPDATE_INTERVAL:36e5,UPDATE_INTERVAL:108e5,url:()=>Object(_.k)(u.a.MEMBER_ACTIVITY),setUpUpdate(e){r.default.isNumber(e)&&e>=6e4&&(this.UPDATE_INTERVAL=e,EBATES.ebToken&&(c.a.extension.setItem("".concat(this.key,".nextUpdateTime"),r.default.now()+e),this.fetch()))},parse:e=>e.member});t.a=l.b.extend({url:()=>Object(_.k)(u.a.MEMBER_DETAILS),defaults:{rakutenMode:!0},initialize(){this.overlays=new f.a,this.bonuses=new p.a,this.trackingtickets=new I,this.favorites=new A,this.visited=new S,this.purchased=new O,this.topDeals=new w,this.accountSummary=new R,this.ccinfo=new N,this.eds=new k,this.messages=new g.c,this.orders=new m.a,this.activity=new x,this.iscb=new E.a,this.recommended=new d.a,this.tafSettings=new b.a,this.accountSummary.fetch().catch(()=>{}),this.on({change:function(e,t){t.unset&&(this.nextUpdateTime=0),(this.hasChanged("id")||this.hasChanged("userStatus"))&&this.identify()},"change:targetSet":function(e){e.previous("targetSet")&&(this.activity.clearCache(),EBATES.merchants.rewards.fetch({force:!0}))},"change:accessLevel":function(e,t){0===t?(this.bonuses.stop(),this.activity.stop()):(EBATES.merchants.ready().then(()=>{this.bonuses.fetch().catch(()=>{})}),this.activity.fetch({silent:!0}))},"change:id":function(){this.id?this.previous("id")&&(Promise.all([this.activity.fetch({reset:!0,silent:!0}),this.bonuses.fetch({reset:!0}),this.ccinfo.fetch({reset:!0}),this.eds.fetch({reset:!0})]).catch(()=>{}),this.iscb.stop(),this.favorites.stop(),this.visited.stop(),this.purchased.stop(),this.messages.reset(),this.trackingtickets.reset(),this.orders.orders.stop(),this.recommended.process({force:!0}),EBATES.settings.userSettings.unset("tcppId"),EBATES.settings.userSettings.save()):this.bonuses.stop(),v.a.userId=this.id},"change:oneReceiptEnabled":function(e,t){c.a.browser.isWebkit&&t&&(EBATES.member.overlays.get("my-orders")||(EBATES.member.overlays.add({id:"my-orders",category:"My Orders",view:"MyOrdersOverlayView",tab:"#btnMyOrders",shown:!!EBATES.settings.promos.findWhere({active:!0,tab:!0})}),EBATES.member.overlays.save()))},"change:rakutenStatusType":function(e,t,n){this.set("rakutenMode",t>=1e3),this.activity.set({rakutenStatusType:t},{silent:!0}),this.previous("rakutenStatusType")&&(this.activity.clearCache(),!1!==n.event&&EBATES.log({event_type:"R4_Transition_Detected",rakutenStatusType:t})),n&&!n.xhr&&this.fetch({force:!0})},"change:egc":function(e,t){let n=EBATES.settings.promos.get("egc-eligible");if(t&&(n&&n.set({active:"eligible"===t.egcStatus,url:Object(_.k)("https://%domain%".concat(t.egcUri))}),"eligible"===t.egcStatus||"created"===t.egcStatus)){return EBATES.settings.promos.get("egc-".concat(t.egcStatus))&&EBATES.member.messages.add({desktop:!1,popup:!0,type:"egc",id:"egc"}),!0}EBATES.member.messages.remove("egc"),n&&n.set({active:!1})},error:function(e,t){Object(r.default)([401,403]).includes(t.status)&&EBATES.onTokenExpired()},"change:gdprCertificationStatus change:isHardDeleteRequested":()=>{EBATES&&(EBATES.settings.userSettings.toggleLogging(),EBATES.badge.update(),EBATES.member.isExtensionDisabled()?(EBATES.merchants.stop(),EBATES.merchants.reset()):EBATES.merchants.fetch())},"change:shortUrl":(e,t)=>{this.set({refId:t.split("/").pop()})},"change:isDoNotShareActive":()=>{EBATES&&EBATES.settings.userSettings.toggleLogging()}}),this.listenTo(this.activity,{sync:e=>{this.set(e.toJSON())},"change:lastOrderDate":async e=>{e.previous("lastOrderDate")&&(this.nextUpdateTime=0,this.fetch())}}),c.a.extension.attachEvent("account-eds",(e,t)=>{Promise.all([this.fetch(),this.eds.fetch()]).then(()=>t(this.toJSON())).catch(()=>{})}),c.a.extension.attachEvent("account",(e,t)=>{EBATES&&EBATES.ebToken?e.data?(this.set(e.data),t&&t(this.toJSON())):this.fetch().catch(()=>{}).then(()=>t(this.toJSON())):t()}),c.a.extension.attachEvent("member.updateEEAMode",async e=>await this.updateEEAMode(e.data)),c.a.extension.attachEvent("member.updateTCPP",async e=>await this.updateTCPP(e.data)),c.a.extension.attachEvent("R3ApplyTransition",async()=>await Object(y.a)()),c.a.extension.attachEvent("createReferralLink",(e,t)=>{t(this.createReferralLink())}),c.a.extension.attachEvent("topDeals",(e,t)=>{this.topDeals.fetch().catch().then(()=>{let e=this.topDeals.toJSON();e.forEach((e,t)=>{if(e){let n=EBATES.merchants.get(e.storeId);n&&(e.merchant=n.toJSON(),e.coupon_rank=t)}}),t(e)})}),c.a.extension.attachEvent("messages",async(e,t)=>{if(e.data&&e.data.created){const{created:t,...n}=e.data,r=this.messages.find(e=>e.get("created")===t);r&&r.set(n)}else await this.messages.flush();t&&t(this.messages.toJSON())}),c.a.extension.attachEvent("share",async({data:e})=>{const{method:t,source:n}=e;return await this.share(t,n)}),c.a.extension.attachEvent("updateAttestationState",({data:e},t)=>{this.updateAttestationState(e.state).then(()=>{t(this.toJSON())}).catch(()=>{t(null)})}),c.a.extension.attachEvent("overlays",({data:e},t)=>{if(e&&e.id){const t=this.overlays.get(e.id);t&&(t.set(e),this.overlays.save())}t(this.overlays.toJSON())})},identify(){if(this.id){var e;const t=this.get("shortURLToken"),n=this.get("userStatus"),r=EBATES.tests.getExperiments(),i=(null===(e=EBATES.settings.installed_extensions)||void 0===e?void 0:e.getInstalledExtensions().toString())||"";return v.b.identify(this.id,{referral_token:t,user_status:n,installed_extensions:i,...r})}},fetch(){return EBATES.ebToken?Promise.all([this.get("accessLevel")?this.ccinfo.fetch():null,l.b.prototype.fetch.apply(this,arguments)]):Promise.reject()},parse(e,t){if(this.accountSummary.save(r.default.reduce(e.accountSummary,(e,t,n)=>(e[n]=Number.isFinite(parseFloat(t))?parseFloat(t):t,e),{})),t&&t.xhr){let n=t.xhr.getResponseHeader("ResponseLevel");n&&(e.accessLevel=parseInt(n,10))}return delete e.accountSummary,r.default.defaults(e,{gdprCertificationStatus:"",targetSet:"",egc:null,rakutenStatusType:0})},toJSON(){return r.default.extend(l.b.prototype.toJSON.apply(this,arguments),{ebToken:EBATES.ebToken,accountSummary:this.accountSummary.toJSON(),tafSettings:this.tafSettings.toJSON(),ccinfo:this.ccinfo.toJSON(),eds:this.eds.toJSON(),isEEAMode:this.isEEAMode(),isPendingDeletion:this.isPendingDeletion(),isExtensionDisabled:this.isExtensionDisabled(),isOrdersEnabled:this.isOrdersEnabled()})},updateEEAMode(t){return e.ajax({url:Object(_.k)(u.a.MEMBER_UDPATE_ATTRIBUTE),type:"POST",contentType:"application/json",processData:!1,dataType:"json",data:JSON.stringify({updateType:"gdpr-certification",updateKey:"eeaResidentStatus",updateValue:t})}).then(()=>{this.set({gdprCertificationStatus:"true"===t?"certified-yes":"certified-no"})})},updateAttestationState(t){return e.ajax({url:Object(_.k)(u.a.MEMBER_UDPATE_ATTRIBUTE),type:"POST",contentType:"application/json",processData:!1,dataType:"json",timeout:1e4,data:JSON.stringify({updateType:"attestation",updateKey:"attestedState",updateValue:t})}).then(()=>new Promise(e=>r.default.delay(e,1e3))).then(()=>this.fetch({force:!0})).catch(()=>{if(this.errorAttempt||(this.errorAttempt=0),this.errorAttempt>0)throw this.errorAttempt=0,"Error Update Attestation State";return this.errorAttempt++,this.updateAttestationState(t)})},isEEAMode(){return Object(r.default)(["certified-yes","not-certified"]).includes(this.get("gdprCertificationStatus"))},isPendingDeletion(){return!0===this.get("isHardDeleteRequested")},isExtensionDisabled(){return this.isEEAMode()||this.isPendingDeletion()},isOrdersEnabled(){return!(!c.a.browser.isWebkit||EBATES.settings.userSettings.get("ordersDisabled")||!this.get("oneReceiptEnabled"))},updateTCPP(t,n=0){t&&(this.unset("tcpp"),EBATES.settings.userSettings.save({tcppId:t.tcppId}),e.ajax({url:Object(_.k)(u.a.MEMBER_UDPATE_TCPP),type:"POST",contentType:"application/json",data:JSON.stringify({tcppId:t.tcppId,tcppTypeId:t.type_id,acceptedDate:a()().toISOString(),deviceInfo:"button"})}).fail(e=>{400!==e.status&&n<10&&r.default.delay(()=>this.updateTCPP(t,n+1),3e5)}))},getDomain:()=>u.a.domain,createReferralLink(){return this.get("shortUrl")},async share(e,t){const n=this.get("shortURLToken"),r={Email:45829,Copy:45830,Facebook:45831,Twitter:45832}[e];let i=this.createReferralLink();const a=Object(_.a)(i,{utm_campaign:"RAF",utm_medium:"RAF share",eeid:r});if(v.b.track("Start Refer A Friend",{share_method:e,eeid:r,source:t,referral_token:n}),"Facebook"===e){let e=await this.tafSettings.getFacebookMessage(a),t=Object(_.a)("https://www.facebook.com/dialog/share?",{display:c.a.browser.isSafari?"page":"popup",app_id:0xc2ee9ccb8e0a,href:a,quote:e,redirect_uri:Object(_.k)("/toolbar/taf/success.htm")});Object(_.h)({url:t,width:550,height:650})}else if("Twitter"===e){let e=await this.tafSettings.getTwitterMessage(a);const t=Object(_.a)("https://twitter.com/intent/tweet?",{text:e});Object(_.h)({url:t,width:550,height:400})}else if("Email"===e){let{subject:e,message:t}=await this.tafSettings.getEmailMessage(a);const n="mailto:?subject=".concat(encodeURIComponent(e),"&body=").concat(encodeURIComponent(t));c.a.browser.navigate(n)}else if("Copy"!==e)throw new Error("Unknown share method")}})}).call(this,n(1))},function(e,t,n){"use strict";(function(e){var r=n(0),i=n(5),a=n.n(i),o=n(2),s=n(9),c=n(7),u=n(8),l=n(59);n(26);let h=a.a.Collection.extend({model:l.b}),d=l.a.extend({url:()=>"".concat(Object(u.k)(c.a.CAMPAIGNS),"?id=").concat(f)});const f=8987;let p=s.e.extend({model:l.b,key:"recommended-myStores",initialize(){o.a.extension.attachEvent("myStores",({data:e},t)=>{const{limit:n,storeIds:r}=e;t(this.first(n,e=>r.includes(e)).map(({id:e})=>EBATES.merchants.get(e).toJSON()))})},first(e,t){return t?this.chain().filter(e=>t(e.id)).first(e).value():s.e.prototype.first.call(this,e)}});t.a=class{constructor(){this.myStores=new p,this.myStores.fetch(),this.predefinedStores=new d([{storeId:8333},{storeId:3993},{storeId:2946},{storeId:7206},{storeId:10634},{storeId:5246},{storeId:69},{storeId:4548},{storeId:3726},{storeId:8378},{storeId:4767},{storeId:4207},{storeId:9528},{storeId:3930},{storeId:3466}]),window.setInterval(()=>this.process(),108e5),o.a.extension.attachEvent("recommendedStores",async({data:e},t)=>{const{limit:n,storeIds:r}=e;t((await this.sample(n,e=>r.includes(e))).map(e=>{const{storeId:t,refStoreId:n}=e.toJSON();let r=EBATES.merchants.get(t);return Object.assign(r.toJSON(),{refStoreId:n,refStore:n?EBATES.merchants.get(n).toJSON():null})}))})}prepare(){return e.ajax({url:Object(u.k)(c.a.SIMILAR_STORES),dataType:"json"}).then(e=>{EBATES.merchants.set(e.stores,{merge:!0,silent:!0,add:!1,remove:!1}),EBATES.member.get("accessLevel")&&this.process()})}checkRequired(e=!1){return new Promise((t,n)=>{EBATES.member.get("accessLevel")?e?t():o.a.extension.getItem("recommended_check",e=>{!e||e+864e5<=r.default.now()?t():n()}):n()})}process(e=!1){return this.checkRequired(e).then(()=>Promise.all([EBATES.member.purchased.fetch({force:e}).catch(()=>{}),EBATES.member.visited.fetch({force:e}).catch(()=>{}),EBATES.member.favorites.fetch({force:e}).catch(()=>{})])).then(()=>{o.a.extension.setItem("recommended_check",r.default.now());let e=new h;e.add(EBATES.member.visited.toJSON()),e.length<6&&e.add(EBATES.member.purchased.toJSON()),e.length<6&&e.add(EBATES.member.favorites.toJSON()),e.reset(e.filter(({id:e})=>{var t;return null===(t=EBATES.merchants.get(e))||void 0===t?void 0:t.get("offers_cb")})),this.myStores.reset(e.models),this.myStores.save()}).catch(()=>{})}getSimilarStores(){let e=new h;return this.myStores.each(t=>{let n=EBATES.merchants.get(t.id);n&&e.add(n.get("similarStores"))}),e}sample(e,t){let n=new h;return this.myStores.find(i=>{let a=EBATES.merchants.get(i.id);if(a){let e=r.default.shuffle(a.get("similarStores")).find(e=>{var r;return e.rank<5&&!n.get(e.storeId)&&!this.myStores.get(e.storeId)&&(null===(r=EBATES.merchants.get(e.storeId))||void 0===r?void 0:r.get("offers_cb"))&&(!t||t(e.storeId))});e&&(e.refStoreId=i.id,n.add(e))}if(n.length>=e)return!0}),n.length<e&&n.add(EBATES.merchants.filter(e=>e.get("reward")&&e.get("offers_cb")&&e.get("reward").targetSet&&!this.myStores.get(e.id)&&(!t||t(e.id)))),n.length<e?this.predefinedStores.fetch().catch(()=>{}).then(()=>n.add(this.predefinedStores.shuffle().filter(e=>{let n=EBATES.merchants.get(e.id);return!this.myStores.get(e.id)&&n&&n.get("offers_cb")&&(!t||t(e.id))}))).then(()=>n.first(e)):Promise.resolve(n.first(e))}}}).call(this,n(1))},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(9);n(26);let o=i.a.Model.extend({defaults:{badgeColor:"#EF5A4E",shown:!1}});t.a=a.e.extend({key:"overlays",model:o,initialize(){this.fetch().then(()=>{let e=this.get("smart-cards");e&&e.set({shown:!0})}),this.on("add remove change:shown",()=>{let e=EBATES.settings.promos.findWhere({tab:!0,active:!0}),t=this.where({shown:!1}).filter(t=>!("my-orders"===t.id&&e)).length;EBATES.badge.update("overlay",t)})}})},function(e,t,n){"use strict";var r=n(0),i=n(1),a=n.n(i),o=n(7),s=n(8),c=n(9);n(26);let u=c.g.extend({idAttribute:"id",initialize(){if(this.get("expiration")){var e=Math.max(this.get("expiration")-r.default.now(),1e3);e<2147483647&&(this.expirationTimeout=window.setInterval(()=>{this&&(window.clearInterval(this.expirationTimeout),this.clearLinkedMessage(this.id),this.collection&&this.collection.remove(this))},e))}this.on({remove:function(){this.clearLinkedMessage(this.id),window.clearInterval(this.expirationTimeout)},error:function(e,t){Object(r.default)([401,403]).includes(t.status)&&EBATES.onTokenExpired()}})},clearLinkedMessage(e){let t=EBATES.member.messages.findWhere({type:"bonus",bonus_id:e});t&&EBATES.member.messages.remove(t)},activate(){return a.a.ajax({url:Object(s.k)(o.a.MEMBER_ACTIVATE_BONUS),headers:{ebToken:EBATES.ebToken},type:"POST",contentType:"application/json",processData:!1,data:JSON.stringify({bonusId:this.id})}).then(()=>this.collection.fetch({force:!0}))}});t.a=c.c.extend({key:"bonuses",model:u,DEFAULT_UPDATE_INTERVAL:864e5,blacklistedBonusIds:[667,668,669,670,771,718,719,720,721,722,772],blacklistedStoreIds:[],url:()=>Object(s.k)(o.a.MEMBER_BONUSES),initialize(){this.on({error:function(e,t){Object(r.default)([401,403]).includes(t.status)&&EBATES.onTokenExpired()}})},parse(e){return r.default.filter(e.bonuses,e=>!r.default.includes(this.blacklistedBonusIds,e.id)&&0===r.default.intersection(e.storeIds,this.blacklistedStoreIds).length,this)}})},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(2),o=n(7),s=n(8),c=n(9);n(26);let u=i.a.Model.extend({idAttribute:"id"}),l=c.c.extend({key:"orders",dynamic:!1,DEFAULT_UPDATE_INTERVAL:144e5,model:u,url:()=>Object(s.k)(o.a.MEMBER_ONE_RECEIPTS),initialize(){},parse(e){return e.data?(EBATES.member.orders.set({linked:!0}),this.meta=e.data.meta,e.data.objects.map(e=>{var t="purchased",n="";if(e.tracking_numbers&&e.tracking_numbers.length){var r=e.tracking_numbers[0];n=r.url,t=r.status.indexOf("Delivered")>=0?"delivered":"shipped"}return{id:e.order_id,orderDate:e.purchased_on,orderTotal:e.transactions?e.transactions.grand_total:0,status:t,trackingUrl:n,deliveryEstimate:"",merchant:e.merchant,company_logo:e.company_logo,items:e.items.map(e=>e.name?{name:e.name,imageUrl:e.image_src,category:e.category,price:e.transactions?e.transactions.price:0}:null).filter(Boolean)}}).filter(e=>e&&e.orderTotal&&e.items.length)):(EBATES.member.orders.set({linked:!1}),null)}});t.a=c.f.extend({key:"ore",defaults:{access_token:""},orders:new l,initialize(){a.a.extension.attachEvent("orders.login",(e,t)=>{this.login(),t(this.toJSON())}),a.a.extension.attachEvent("orders.resetToken",()=>{this.unset("access_token"),this.save()}),a.a.extension.attachEvent("orders.updateToken",(e,t)=>{this.save({access_token:EBATES.ebToken}),t(this.toJSON())}),a.a.extension.attachEvent("orders",(e,t)=>{t(this.toJSON())}),a.a.extension.attachEvent("orders.load",(e,t)=>{this.loadOrders().catch(()=>{}).then(()=>{t(this.toJSON())})}),a.a.extension.attachEvent("orders.loadMore",({data:e},t)=>{this.orders.fetch(e).catch(()=>{}).then(()=>{t(this.toJSON())})})},isTokenExpired:()=>!1,login(){return this.has("access_token")?(this.set({access_token:EBATES.ebToken}),!1):(this.save({access_token:EBATES.ebToken}),this.loadOrders(),!0)},updateTokens(){},loadOrders(e){return this.orders.access_token=this.get("access_token"),this.orders.fetch(e)},toJSON(){const e=c.f.prototype.toJSON.apply(this,arguments);return e.orders=this.orders.toJSON(),e.meta=this.orders.meta,e}})},function(e,t,n){"use strict";var r=n(0),i=n(1),a=n.n(i),o=n(5),s=n.n(o),c=n(2),u=n(7),l=n(8),h=n(9);n(26);let d=s.a.Collection.extend({}),f=s.a.Model.extend({idAttribute:"offerId",activate(e){return new Promise((t,n)=>{a.a.ajax({url:"".concat(Object(l.k)(u.a.MEMBER_ISCB_LINKED),"?").concat(a.a.param({offerId:this.id,cardId:e,store_id:this.get("store")?this.get("store").id:null})),type:"POST"}).then(()=>{this.set({linkedCardIds:r.default.union(this.get("linkedCardIds"),[e]),cardIds:r.default.without(this.get("cardIds"),e)}),t()},()=>{n()})})},toJSON(){let e=e=>{let t=this.collection.cardDictionary.get(e);return t?t.toJSON():null},t=this.get("store")?this.get("store").id:null,n=t?EBATES.merchants.get(t):null;return r.default.extend(s.a.Model.prototype.toJSON.apply(this,arguments),{merchant:n?n.toJSON():null,cards:r.default.map(this.get("cardIds"),e),linkedCards:r.default.map(this.get("linkedCardIds"),e),description:this.get("description")?this.get("description").replace(/^Earn Cash Back/,""):""})}});t.a=h.a.extend({model:f,cardDictionary:new d,url:()=>Object(l.k)(u.a.MEMBER_ISCB),initialize(){c.a.extension.attachEvent("ISC",(e,t)=>{EBATES.member.get("accessLevel")?this.fetch().then(()=>{let n=this.find(t=>t.get("store").name.toLowerCase()===e.data.name.toLowerCase());t(n?n.toJSON():null)}):t(null)}),c.a.extension.attachEvent("ISC-activate",(e,t)=>{let n=this.get(e.data.offerId),r=e.data.cardId;n&&n.activate(r).then(()=>{t({offer:n.toJSON(),cardId:r})},()=>{t({error:"Oops. We weren't able to enable this card for In-Store Cash Back. Please try again later",cardId:r})})})},parse(e){return this.cardDictionary.reset(e.cardDictionary),r.default.filter(e.offers,e=>!e.dateLinked)}})},function(e,t,n){"use strict";var r=n(2),i=n(8),a=n(9),o=n(7);t.a=a.b.extend({timeout:108e5,defaultMessage:"Have you signed up with Rakuten yet? It's the best site for earning Cash Back. Get a $10 bonus when you sign up with my invite link and spend $25. It's free! [link]",defaults:{referBonusAmount:"$$$",referImageToolbar:"/toolbar/images/taf_toolbar.png",referImageToolbar2x:"/toolbar/images/taf_toolbar@2x.png",referSocialMessage:""},url:()=>Object(i.k)(o.a.MEMBER_TAF),initialize(){return r.a.extension.attachEvent("taf",async({data:e},t)=>{switch(await this.fetch(),null==e?void 0:e.method){case"getFacebookMessage":t(this.getFacebookMessage(e.link));break;case"getTwitterMessage":t(this.getTwitterMessage(e.link));break;case"getEmailMessage":t(this.getEmailMessage(e.link));break;default:t(this.toJSON())}}),a.b.prototype.initialize.apply(this,arguments)},toJSON(){var e=a.b.prototype.toJSON.apply(this,arguments);return e.referPageHeader="Get ".concat(e.referBonusAmount),window.devicePixelRatio>1&&(e.referImageToolbar=e.referImageToolbar2x),e},async getFacebookMessage(e){let t;return await this.fetch(),t=this.get("referSocialMessage")&&this.get("referSocialMessage").indexOf("|")>=0?this.get("referSocialMessage").split("|")[0]:this.get("referSocialMessage")?this.get("referSocialMessage"):this.defaultMessage,t.indexOf("[link]")>=0?t.replace("[link]",e):"".concat(t," ").concat(e)},async getTwitterMessage(e){let t;return await this.fetch(),t=this.get("referSocialMessage")&&this.get("referSocialMessage").indexOf("|")>=0?this.get("referSocialMessage").split("|")[1]:this.get("referSocialMessage")?this.get("referSocialMessage"):this.defaultMessage,t.indexOf("[link]")>=0?t.replace("[link]",e):"".concat(t," ").concat(e)},async getEmailMessage(e){let t,n;if(await this.fetch(),this.get("referEmailMessage")&&this.get("referEmailMessage").indexOf("|")>=0){const e=this.get("referEmailMessage").split("|");t=e.shift(),n=e.join("\n")}else t="Check this out: Get Cash Back for shopping!",n=this.defaultMessage;return n=n.indexOf("[link]")>=0?n.replace("[link]",e):"".concat(n," ").concat(e),{subject:t,message:n}},parse:e=>e})},function(e,t,n){"use strict";var r=n(5),i=n.n(r),a=n(7),o=n(8),s=n(0),c=n(2);let u=0,l=i.a.Model.extend({toJSON(){let e=i.a.Model.prototype.toJSON.apply(this,arguments),t=e.name.replace(/ /g,"-"),n=e.city.replace(/ /g,"-");this.get("stateProvinceCode")?e.ebatesLink=Object(o.k)("https://%domain/hotels/details/".concat(e.hotelId,"/").concat(t).concat(n).concat(e.stateProvinceCode,".htm")):e.ebatesLink=Object(o.k)("https://%domain/hotels/details/".concat(e.hotelId,"/").concat(t,"-").concat(n,".htm"));let r=[].concat(e.RoomRateDetailsList.RoomRateDetails.RateInfos.RateInfo.ChargeableRateInfo.NightlyRatesPerRoom.NightlyRate);return e.ebatesRate=parseFloat(r[0]["@rate"]),e}}),h=i.a.Collection.extend({model:l,url:()=>Object(o.k)(a.a.HOTELS),parse:e=>e.HotelListResponse&&e.HotelListResponse.HotelList?(u=parseInt(e.HotelListResponse.HotelList["@activePropertyCount"],10),[].concat(e.HotelListResponse.HotelList.HotelSummary)):[]});t.a=i.a.Model.extend({initialize(){c.a.extension.attachEvent("setHotelsPrefill",(e,t)=>{this.set({requestData:e.data}),t()}),c.a.extension.attachEvent("getHotelsSearch",(e,t)=>{let n=new h;n.fetch({data:s.default.extend(e.data,{sort:"PRICE_AVERAGE",numberOfResults:3})}).then(()=>{t({hotels:s.default.sortBy(n.toJSON(),"ebatesRate"),total:u})},()=>{t({isError:!0})})})}})},function(e,t,n){"use strict";var r=n(2);n(26);t.a=class{constructor(){const e="ebay_incrementality_holdout",t=[e,"ebay_incrementality_normal"];let n=()=>EBATES.member.eds.fetch().then(()=>{if(EBATES.member.eds.get("targetSet"))return EBATES.member.eds.get("targetSet").find(e=>t.includes(e.name)&&(!e.expirydate||e.expirydate&&new Date(e.expirydate)>new Date))}),i=({toolId:e,groupId:t})=>fetch("https://rover.ebay.com/roverimp/1/".concat(this.promo.get("rid"),"/1?pub=").concat(this.promo.get("pid"),"&toolid=").concat(e,"&campid=").concat(this.promo.get("cid"),"&ff18=").concat(this.promo.get("eci"),"&ff19=").concat(t,"&ff20=").concat(EBATES.member.id));r.a.extension.attachEvent("VisitMerchant",t=>{this.promo=EBATES.settings.promos.get("ebay_incrementality"),this.promo&&this.promo.isActive()&&t&&t.data&&3993===t.data.storeId&&EBATES.member.get("id")&&(EBATES.sessionData.ebay_incrementality||n().then(t=>{t&&(EBATES.sessionData.ebay_incrementality="shown",i({toolId:"20000",groupId:t.name===e?"2":"1"}).then(e=>{EBATES.log({event_type:"partner_test_view",url:e.url})}))}))}),r.a.extension.attachEvent("ClickMerchant",t=>{this.promo=EBATES.settings.promos.get("ebay_incrementality"),this.promo&&this.promo.isActive()&&t&&t.data&&3993===t.data.storeId&&"clicked"!==!EBATES.sessionData.ebay_incrementality&&n().then(t=>{t&&(EBATES.sessionData.ebay_incrementality="clicked",i({toolId:"10001",groupId:t.name===e?"2":"1"}).then(e=>{EBATES.log({event_type:"partner_test_click",url:e.url})}))})})}}},function(e,t,n){"use strict";var r=n(2);n(26);t.a=class{constructor(){const e="hotels_incrementality";let t=()=>EBATES.member.eds.fetch().then(()=>{if(EBATES.member.eds.get("targetSet")){let e=EBATES.member.eds.get("targetSet").find(e=>this.promo.get("groups").includes(e.id)&&(!e.expirydate||e.expirydate&&new Date(e.expirydate)>new Date));if(e)return this.promo.get("groups").indexOf(e.id)}}),n=e=>{let t=this.promo.get("stores").indexOf(e);return t>0?t:0},i=({action:e,merchant:t,testBucket:n})=>fetch("https://www.trvl-px.com/incrementality.gif?partnerName=".concat(this.promo.get("partnerName"),"&partnerUserId=").concat(EBATES.member.id,"&testId=").concat(this.promo.get("testId"),"&testBucket=").concat(n,"&channel=").concat(this.promo.get("channel"),"&merchant=").concat(t,"&action=").concat(e));r.a.extension.attachEvent("VisitMerchant",r=>{if(this.promo=EBATES.settings.promos.get(e),this.promo&&this.promo.isActive()&&r&&r.data&&EBATES.member.get("id")){let a=n(r.data.storeId);a&&(EBATES.sessionData["".concat(e,"-").concat(a)]||t().then(t=>{t>=0&&(EBATES.sessionData["".concat(e,"-").concat(a)]="shown",i({action:1,merchant:a,testBucket:t}).then(e=>{EBATES.log({event_type:"partner_test_view",url:e.url})}))}))}}),r.a.extension.attachEvent("ClickMerchant",r=>{if(this.promo=EBATES.settings.promos.get(e),this.promo&&this.promo.isActive()&&r&&r.data){let a=n(r.data.storeId);a&&"clicked"!==!EBATES.sessionData["".concat(e,"-").concat(a)]&&t().then(t=>{t>=0&&(EBATES.sessionData["".concat(e,"-").concat(a)]="clicked",i({action:2,merchant:a,testBucket:t}).then(e=>{EBATES.log({event_type:"partner_test_click",url:e.url})}))})}})}}},function(e,t,n){"use strict";var r=n(2),i=n(8),a=n(7),o=(n(26),n(24));t.a=async function(){const e=await Object(i.e)(a.a.domain,"extension-install-source").catch(()=>""),t=await async function(e){let t;return/(?:step2|EB-Test1\d{2,}A)/.test(e)?(t=Object(i.k)("https://%domain%?sourceName=toolbar&eeid=45426&toolbarId=%userid"),await r.a.browser.navigate({url:t,tabId:r.a.browser.NEWTAB},({id:e})=>{setTimeout(()=>r.a.extension.fireEvent("welcome",{tabId:e}),2500)}),t):(t=Object(i.k)(a.a.WEB_INSTALL),await r.a.browser.navigate(t),t)}(e),n=await async function(){if(r.a.browser.isLegacyEdge)return new Promise(e=>{function t({data:t}){clearTimeout(n),e(t.sessionId)}r.a.extension.attachEvent("sessionId",t);let n=setTimeout(()=>{r.a.extension.detachEvent("sessionId",t),e("")},8e3)});{const e="JSESSIONID",t=await Object(i.e)(a.a.domain,e).catch(()=>"");return t||new Promise(t=>{function n(i){i.cookie.domain===a.a.domain&&i.cookie.name===e&&i.cookie.value&&(clearTimeout(r),browser.cookies.onChanged.removeListener(n),t(i.cookie.value))}browser.cookies.onChanged.addListener(n);let r=setTimeout(()=>{browser.cookies.onChanged.removeListener(n),t("")},8e3)})}}(),s=await new Promise(e=>{var t,n;(null===(t=chrome)||void 0===t||null===(n=t.instanceID)||void 0===n?void 0:n.getID)?chrome.instanceID.getID(e):e(null)});r.a.browser.isWebkit&&browser.windows.getAll({populate:!0}).then(e=>{e.forEach(e=>{e.tabs.forEach(({id:e,url:t})=>{t.includes(Object(i.k)("%domain/button-landing/"))&&browser.tabs.update(e,{url:t})})})}),o.b.track("Install Application",{attribution_source:e,desktop_session_id:n,url:t,instanceId:s}),EBATES.log({event_type:"install",eb_session_id:n,user_id:EBATES.member.id,browser:r.a.browser.name,browser_agent:navigator.userAgent,button_version:r.a.extension.version,toolbarId:window.toolbarId,type:e,url:t},{force:!0})}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(0),i=n(5),a=n.n(i),o=n(56),s=n.n(o),c=n(32),u=n(2),l=n(24),h=n(8),d=n(7),f=n(9),p=n(11),g=n.n(p),m=n(179),E=n.n(m),v=n(43),_=n(53);n(26);let y=f.g.extend({defaults:{popup:!1,badge:!1,shown:!1,active:!1},campaigns:null,initCampaigns(){this.has("campaigns")&&(this.campaigns||(this.campaigns=new A(null,this)),this.campaigns.set(this.get("campaigns")))},isActive(){if(EBATES&&EBATES.member.isExtensionDisabled())return!1;if(this.has("expires")&&this.has("starts")){let e=r.default.now(),t=g()(this.get("starts")),n=g()(this.get("expires"));return this.set({active:e>=t&&e<n&&this.isCampaignSupported()}),this.get("active")}{let e=this.isCampaignSupported();return e||this.set({active:!1}),e}},initTimeouts(){if(this.has("expires")&&this.has("starts")){this.timeout&&window.clearInterval(this.timeout);let e=r.default.now(),t=g()(this.get("starts")),n=g()(this.get("expires"));this.set({active:e>=t&&e<n&&this.isCampaignSupported()});let i,a=e=>r.default.min([e.diff(),6e5]);e<t?i=a(t):e<n&&(i=a(n)),i&&(this.timeout=window.setInterval(()=>{this.initTimeouts()},i))}},isCampaignSupported(){function e(e){return e.replace(/(\d+\.\d+\.\d+)\.(\d+)/,"$1-$2")}let t=!0;return this.get("browser")&&(t=r.default.contains(this.get("browser").split(","),u.a.browser.name)),this.get("version")&&(t=t&&E.a.satisfies(e(u.a.extension.version),e(this.get("version")))),t},activate(){this.get("badge")&&!this.get("shown")&&(EBATES.badge.update("promo",1),EBATES.member.overlays.where({shown:!1}).forEach(e=>e.set({shown:!0})),EBATES.member.overlays.save()),this.get("desktopTitle")&&this.get("desktopMessage")&&!this.get("desktopMessageShown")&&EBATES.member.messages.checkPermission().then(()=>{new _.a({model:new a.a.Model({type:this.id,title:this.get("desktopTitle"),text:this.get("desktopMessage"),url:Object(h.k)(this.toJSON().url),image:this.get("icon")})}).render(),this.set({desktopMessageShown:!0})},()=>{}),this.get("overlay")&&this.get("overlay").template&&!EBATES.member.overlays.get(this.id)&&EBATES.member.overlays.add({id:this.id,view:"CustomOverlayView",persistent:this.get("overlay").persistent,template:this.get("overlay").template})},initialize(){if(this.isCampaignSupported()){if(this.on({"change:campaigns":function(){this.initCampaigns()},"change:starts":function(){this.initTimeouts()},"change:active":function(e,t){t?this.activate():(EBATES.member.overlays.remove(this.id),EBATES.member.overlays.save(),EBATES.badge.update("promo",0)),"icons"===this.id&&r.default.delay(()=>EBATES.icon.load(),500)},"change:shown":function(e,t){t&&EBATES.badge.update("promo",0)}}),this.get("active")&&this.activate(),this.initCampaigns(),this.initTimeouts(),"ADSCANS_18"===this.id)return R.prototype.initialize.apply(this,arguments)}else this.set({active:!1})}});var b=f.e.extend({model:y,key:"promos",initialize(){this.on("add remove change",this.save),u.a.extension.attachEvent("updatePromo",({data:e={}})=>{const{id:t,...n}=e;this.get(t)&&(this.get(t).set(n),u.a.extension.fireEvent("promoUpdated",{tabId:u.a.browser.ALLTABS,data:this.toJSON()}))}),u.a.extension.attachEvent("getCampaignStores",async({data:e},t)=>{const{id:n,fetch:r=!1}=e,i=this.map(e=>e.campaigns&&e.campaigns.models).filter(Boolean).flat().find(e=>e.id===n);if(i){if(r)try{await i.stores.fetch()}catch(e){t(null)}t(i.stores.toJSON())}else t(null)})},getActive(){return this.find(e=>e.get("active")&&r.default.now()>=g()(e.get("starts"))&&r.default.now()<g()(e.get("expires")))},save(){let e=this.map(e=>e.pick("id","shown","desktopMessageShown","interruptShown","serpClosed","disabled","data"));u.a.extension.setItem(this.key,e)}});let I=f.g.extend({idAttribute:"storeId",toJSON(){var e=EBATES.merchants.get(this.get("storeId"));if(e&&e.has("shoppingURL")){var t=e.toJSON();let n=Object(h.a)(t.shoppingURL.replace("&store_url=%deepLinkUrl%",""),{merchantId:t.storeId,tb:"yes",domainName:t.domainName,toolbarId:window.toolbarId,sourceName:"toolbar",channel:4,toolbarFeatureId:"TOPSTORES",tb_v:u.a.extension.version,eeid:t.mpl?"40874":"26142",mpl_id:t.mpl});return r.default.extend(f.g.prototype.toJSON.apply(this,arguments),t,{shoppingURL:n})}}}),w=v.c.extend({model:I,url(){return"".concat(Object(h.k)(d.a.CAMPAIGNS),"?id=").concat(this.id)},initialize(e,t){this.id=t.id,this.campaign=t,this.on("error",()=>{let e=this.campaign.collection.promo;c.a.logger.warn("NetworkException",{type:"campaign",url:this.url(),campaign:e?e.toJSON():this.id,localTime:g()().format("YYYY-MM-DD HH:mm")})})},parse(e){let t=e.campaigns.pop();if(t)return this.details=r.default.pick(t,["name","start","expires"]),t.stores},fetch(){let e=this.campaign.collection.promo;return this.id&&e&&e.isActive()?v.c.prototype.fetch.apply(this,arguments):Promise.resolve()},toJSON(){return v.c.prototype.toJSON.apply(this,arguments).filter(Boolean)}}),T=a.a.Model.extend({defaults:{popup:!1,hover:!1,update:0},lastUpdateTimestamp:0,initialize(){this.stores=new w(null,this),this.get("stores")&&this.stores.set(this.get("stores")),this.on("change:update",()=>this.setUpUpdate()),this.listenTo(this.stores,{request:()=>this.setUpUpdate(),sync:()=>this.lastUpdateTimestamp=r.default.now()}),this.listenTo(this.collection.promo,"change:active",e=>{e&&this.get("update")&&(EBATES.merchants.rewards?this.listenToOnce(EBATES.merchants.rewards,"request",()=>this.stores.fetch()):r.default.delay(()=>this.stores.fetch(),15e3))}),this.collection.promo.get("active")&&r.default.delay(()=>this.stores.fetch(),3e3),this.collection.promo.set(this.pick(e=>!0===e))},setUpUpdate(){if(this.get("update")>0&&this.collection.promo.isActive()){window.clearInterval(this.timeout);let e=()=>{var e;(null===(e=this.collection.promo)||void 0===e?void 0:e.isActive())?r.default.now()>this.lastUpdateTimestamp+this.get("update")&&this.stores.fetch():window.clearInterval(this.timeout)};this.timeout=window.setInterval(e,9e5)}}}),A=a.a.Collection.extend({model:T,initialize(e,t){this.promo=t}}),S=a.a.Model.extend({idAttribute:"storeId",isValid(){let e=EBATES.merchants.get(this.id),t=r.default.now()/1e3;return e&&e.get("offers_cb")&&t>this.get("start")&&(!this.get("expires")||t<this.get("expires"))},toJSON(){let e=a.a.Model.prototype.toJSON.apply(this,arguments),t=this.collection.campaign.get("storeUrl"),n=EBATES.merchants.get(this.id);if(e.merchant=n.toJSON(),t){let r=n.get("shoppingURL")&&n.get("shoppingURL").match(/\/(.+?)_/);e.url=Object(h.k)("https://%domain/".concat(t.replace(/^\//,"").replace("%storeDomain",r?r.pop():"").replace("%storeId",this.id)))}else e.url=this.collection.campaign.get("url");return e}}),O=f.a.extend({model:S,url:"https://www.fatwallet.com/apis/v1/adscans?rows=200",parse:e=>r.default.map(e.adscans,e=>{if(EBATES.merchants.get(e.storeId))return{storeId:e.storeId,start:e.start,expires:e.expires,image:e.images.pageImage.replace("/50x50/","/700x700/")}}),sample(e,t){let n=new O;if(n.campaign=this,n.add(this.filter(e=>t.includes(e.id)&&e.isValid())),n.length<e&&this.reduce((t,n)=>(t.length<e&&!t.get(n.id)&&EBATES.member.recommended.myStores.get(n.id)&&n.isValid()&&t.add(n),t),n),n.length<e){let t=EBATES.member.recommended.getSimilarStores();this.reduce((n,r)=>(n.length<e&&!n.get(r.id)&&t.get(r.id)&&r.isValid()&&n.add(r),n),n)}return n.length<e&&n.add(this.models.filter(e=>e.isValid())),n.first(e)}}),R=y.extend({initialize(){this.adscans=new O,this.adscans.campaign=this;let e=e=>(e=e.toLowerCase(),r.default.find(this.get("stores"),t=>{let n=EBATES.merchants.get(t.storeId);if(n){let t=n.get("domainName").toLowerCase();return n.get("storeName").toLowerCase()===e||t===e||t.replace(/\.\w+/,"")===e}}));u.a.extension.attachEvent(this.id,(t,n)=>{r.default.find(this.get("keywords"),r=>{let i=new RegExp(r,"i").exec(t.data.query);if(i&&(2===i.length&&e(i[1])||1===i.length))return Promise.all([this.adscans.fetch(),EBATES.member.recommended.process()]).then(()=>{n({keyword:r,merchants:this.adscans.sample(4,t.data.merchants).map(e=>e.toJSON())})}),!0})})}}),N=a.a.Model.extend({idAttribute:"domainName",defaults:{enabled:!0}}),k=a.a.Collection.extend({model:N,url:()=>Object(h.k)(d.a.SETTINGS_PM),parse:e=>e?e.domains:null});var x=a.a.Model.extend({domains:new k,defaults:{affiliatizedLinks:[".popshops.com/","c.affil.walmart.com/"],thresholdAmount:5,excludedDomains:[],partnerDomains:[],exclusions:[],requestThreshold:null,tiers:null,messages:[]},toJSON(){return r.default.extend(a.a.Model.prototype.toJSON.apply(this,arguments),{domains:this.domains.toJSON()})}});let B=a.a.Model.extend({defaults:{installed:!1},async check(){if(this.has("url"))try{const e=await fetch("chrome-extension://".concat(this.get("url")));this.set({installed:200===e.status})}catch(e){this.set({installed:!1})}return this}});var C=f.e.extend({key:"installed_extensions",model:B,changed:!1,CHECK_INTERVAL:864e5,initialize(){u.a.extension.attachEvent("installed_extensions",(e,t)=>{t(this.getInstalledExtensions())}),window.setInterval(()=>this.check(),36e5),this.fetch({silent:!0})},async checkRequired(){let e=await u.a.extension.getItem("installed_extensions_check");return!e||e+this.CHECK_INTERVAL<=Date.now()},async check(){if(await this.checkRequired()){await Promise.all(this.map(e=>e.check())),u.a.extension.setItem("installed_extensions_check",Date.now()),this.save();let e=["ebates",...this.getInstalledExtensions()].toString();EBATES.log({event_type:"installed_extensions",extensions:e})}},getInstalledExtensions(){return this.where({installed:!0}).map(({id:e})=>e)}});let D=a.a.Model.extend({constructor:function(e){a.a.Model.call(this,{url:e})}}),L=a.a.Collection.extend({model:D,initialize(e,{type:t}){this.type=t,this.matches=new Map},find(e){return"string"==typeof e?a.a.Collection.prototype.find.call(this,t=>"string"==typeof t.get("url")?e.indexOf(t.get("url"))>0:t.get("url").test(e)):a.a.Collection.prototype.find.apply(this,arguments)},match({tabId:e,...t}){let n=this.find(t.url);if(n){let n=this.matches.get(e)||[];t.timeStamp=Date.now(),n.push(t),this.matches.set(e,n)}return n},clear(e){this.matches.delete(e)},state(e){const t=Date.now()-6e4,n=(this.matches.get(e)||[]).filter(({timeStamp:e})=>e>t);return n.length&&this.matches.set(e,n),n[0]},addParameters(e,t){const n=this.matches.get(e);n?this.matches.set(e,n.map(e=>({...e,...t}))):this.matches.set(e,[{...t,timeStamp:Date.now()}])}});var U=a.a.Model.extend({suppresses:new L(null,{type:"suppresses"}),activations:new L([/^[^?]*\.(?:ebates|rakuten)\.com\/.*(?:createShoppingSession|xfas|mall_ctrl\.do)/,/\.shopstyle(?:qa)?\.com\/\w+\/(?:loadRetailerProductPage|apiVisitRetailer)/,/\/\/shopping\.yahoo\.com\/rd\?.*?providerId=rkt/],{type:"activations"}),initialize(){u.a.browser.attachEvent(u.a.browser.TABCLOSED,({tabId:e})=>{this.activations.clear(e),this.suppresses.clear(e)})},match(e,t){this.activations.match({url:e,tabId:t})||this.suppresses.match({url:e,tabId:t})},state(e=0){return{tabId:e,activation:this.activations.state(e),suppress:this.suppresses.state(e)}},clear(e=0){this.suppresses.clear(e),this.activations.clear(e)}}),P=n(180),M=n(46),F=n.n(M),j=class extends F.a{constructor({url:e,appId:t,apiKey:n,updateInterval:r},i){super(),this._url=e,this._appId=t,this._apiKey=n,this._updateInterval=r,this._variations={},this._attributes={},i&&this.identify(i)}async fetch(){const e=new URL(this._url);Object.keys(this._attributes).forEach(t=>e.searchParams.append(t,this._attributes[t]));const t=await fetch(e,{headers:{"APP-ID":this._appId,"API-KEY":this._apiKey}});if(200===t.status){const e=await t.json();this._variations=e}return this}async identify(e={}){this._updateInterval&&(clearTimeout(this._timeout),this._timeout=setInterval(()=>this.fetch(),this._updateInterval)),this._attributes=e,await this.fetch(),this.emit("ready",this)}variation(e,t){let n=e.split(".");return function e(n,r){let i=r.shift();return Object.prototype.hasOwnProperty.call(n,i)?r.length?e(n[i],r):n[i]:t}(this._variations,n)}toJSON(){return JSON.parse(JSON.stringify(this._variations))}},V=n(54);let z=a.a.Model.extend({constructor:function(e){return a.a.Model.call(this,{data:e})},toJSON(){return this.get("data")}}),G=f.e.extend({key:"blacklist",model:z,initialize(){u.a.extension.attachEvent("blacklist-save",({data:e})=>{this.reset(e),this.save()}),u.a.extension.attachEvent("blacklist-update",({data:e})=>{const{domain:t,blacklisted:n}=e;t&&"boolean"==typeof n&&(n&&!this.contains(t)?this.add(t):n||this.remove(this.where({data:t})),this.save())})},contains(e){return!!this.find((function(t){return Object(h.f)(e)===Object(h.f)(t.get("data"))}))}}),H=f.c.extend({model:a.a.Model,UPDATE_INTERVAL:864e5,url:()=>Object(h.k)(d.a.SETTINGS_COUPONS),initialize(){return u.a.extension.attachEvent("getCouponsConfig",(e,t)=>{t({config:this.toJSON(),debug:!1})}),this.fetch({dataType:"json"}).catch(()=>this.readCache({cache:!0})),f.c.prototype.initialize.apply(this,arguments)},parse:e=>e.coupons}),K=f.c.extend({model:a.a.Model,UPDATE_INTERVAL:864e5,url:()=>Object(h.k)(d.a.SETTINGS_CHECKOUT),initialize(){return u.a.extension.attachEvent("getCheckoutConfig",(e,t)=>{t(r.default.invoke(this.where({storeId:e.data.storeId}),"toJSON"))}),this.fetch({dataType:"json"}).catch(()=>this.readCache({cache:!0})),f.c.prototype.initialize.apply(this,arguments)}}),J=f.f.extend({key:"cart_notifications",defaults:{activation:!0,caa:!0,ccch:!0,ccps:!0,bonus:!0}}),Y=f.f.extend({requestPermission(e,t){u.a.extension.fireEvent("permission-request-backdrop",{data:"show"}),browser.permissions.request({permissions:["notifications"]}).then(e=>{u.a.extension.fireEvent("permission-request-backdrop",{data:"hide"}),e?(EBATES.settings.userSettings.save({notificationsEnabled:"granted"}),new _.a({model:new _.b({type:"permission",title:"Desktop notifications are now on!",text:"We'll let you know whenever Cash Back is placed in your account.",url:Object(h.k)("/pending-cash-back.htm?tb=yes&eeid=26117"),cta:"See Cash Back Activity",desktop:!0})}).render()):EBATES.settings.userSettings.save({notificationsSuspended:r.default.now(),notificationsEnabled:"rejected"}),t&&t()}).catch(e=>{})}}),q=f.f.extend({key:"settings",defaults:{postPurchaseMessage:!0,postPurchaseMessageAddressUpdated:!1,desktopNotifications:{cashBack:!0},rakutenNotificationTooltipShowed:!1,ccHover:0,blacklistEnabled:!1,disabledTieredStores:[],ordersDisabled:!1,reportingEnabled:!0},initialize(){this.on({sync:function(){if(!this.has("progressiveEducation")){let e=Object(h.c)(window.installVersion,"4.23.0.0")>=0;u.a.extension.getItem("betterChoicesIntro",t=>{this.save({progressiveEducation:{ReminderHover:e,ConfirmHover:e,CouponMagic:e,SERPinjections:e,PriceMagic:!t}})})}u.a.browser.isFirefox&&(this.has("logging")||this.save({logging:Object(h.c)(window.installVersion,"4.23.0.0")<0?"opt_in":"pending"}),this.has("anonymousLogging")||this.save({anonymousLogging:Object(h.c)(window.installVersion,"4.41.0.0")<0?this.get("logging"):"pending"})),this.has("installedTimestamp")||this.save({installedTimestamp:r.default.now()})},"change:ordersDisabled":function(e,t){t&&(EBATES.member.orders.unset("access_token"),EBATES.member.orders.save())},"change:isDoNotShareActive":()=>{let e=s()();u.a.extension.setItem("uiid",e),l.b.setAnonymousId(e)},"change:logging change:isDoNotShareActive change:anonymousLogging":()=>this.toggleLogging()})},toggleLogging(){let e=EBATES.member.isExtensionDisabled(),t="opt_out"===this.get("logging")||"pending"===this.get("logging")||e,n="opt_out"===this.get("anonymousLogging")||"pending"===this.get("anonymousLogging")||e,r=EBATES.member.id?!0===EBATES.member.get("isDoNotShareActive"):this.get("isDoNotShareActive");l.b.disabled=t||r,l.a.disabled=t||r,V.a.disabled=t||r,c.a.logger.setHandler(n||r?"silent":"http")}});t.a=f.d.extend({url:()=>Object(h.k)(d.a.SETTINGS),blacklist:new G,coupons:new H,checkoutPages:new K,checkoutNotifications:new J,affiliates:new U,betterChoices:new x,browserNotification:new Y,userSettings:new q,serp:[],iscb:[],UPDATE_INTERVAL:108e5,ERROR_UPDATE_INTERVAL:3e5,defaults:{activityUpdateInterval:108e5,activationInterval:1e4,serpEnabled:!0,competitorDomains:["shopathome.com","shopstyle.com","dealmoon.com","mrrebates.com","retailmenot.com","dealsplus.com","jet.com"],attachMode:["www.homedepot.com"],standDownDomains:[],contentBlackList:[],travelStores:[],features:{},groupon:{},CDN:d.a.CDN,deskNotificationReqFreq:2592e6,messageExpires:12096e5,reportingUpdateInterval:108e5,rewardsExpire:864e5,pendingDeletionTemplate:'<h2>Your Account Deletion is Pending</h2>\n\t\t<p>You requested an account deletion. You can check the status of your request by clicking below. You may also wish to remove Rakuten from your browser extensions.</p>\n\t\t<a data-href="https://www.rakuten.com/shell-page.htm?utm_source=extension&sourceName=toolbar" class="btn">Check Deletion Status</a>'},parseResponse(e){e&&(this.checkoutNotifications.set(e.checkoutNotifications),this.affiliates.suppresses.set(e.paidLinks),e.paidLinkPatterns&&this.affiliates.suppresses.add(r.default.map(e.paidLinkPatterns,e=>new RegExp(e))),e.betterChoices&&this.betterChoices.set(r.default.omit(e.betterChoices,"domains")),e.installed_extensions&&this.installed_extensions&&(this.installed_extensions.set(r.default.map(e.installed_extensions,(e,t)=>({id:t,url:e})),{add:!0,remove:!0,merge:!0}),this.installed_extensions.save()),this.serp=e.serp,this.iscb=e.iscb,this.promos.set(r.default.union(e.promos,e.campaigns)),this.domains=r.default.map(e.domains,(function(e){return e.track_events=!0,e})),this.travelStoresTracking=e.travelStoresTracking,this.set(r.default.omit(e,"paidLinks","serp","domains","optout","promos","campaigns","betterChoices","checkoutNotifications","installed_extensions","travelStoresTracking")))},parse(e){this.parseResponse(e),this.trigger("sync-data",e)},initialize(){this.promos=new b,this.productParsers=new P.a,this.interstitials=new a.a.Collection([{matchPattern:"\\.rakuten\\.com",reward:{ttn:{selector:"meta[name='trackingTicketNumber']",attribute:"content"},amount:{selector:"meta[name='rewardAmount']",attribute:"content"},display:{selector:"meta[name='rewardType']",attribute:"content"},range:{selector:"meta[name='rewardRange']",attribute:"content"}}},{matchPattern:"\\.shopstyle(?:qa)?\\.com\\/\\w+\\/(?:loadRetailerProductPage|apiVisitRetailer)",defaults:{display:"Percentage",partner:"ShopStyle",sessionInterval:864e5},reward:{ttn:{selector:"meta[name='trackingTicketNumber']",attribute:"content"},amount:{selector:"meta[name='rewardAmount']",attribute:"content"},display:{selector:"meta[name='rewardType']",attribute:"content"},range:{selector:"meta[name='rewardRange']",attribute:"content"}}},{matchPattern:"\\/\\/shopping\\.yahoo\\.com\\/rd\\?.*?providerId=rkt",defaults:{display:"Percentage",partner:"Yahoo"},reward:{ttn:{selector:'div[class^="Cashback__TrackingInfo-"]',rx:"#(\\d+)"},amount:{selector:'div[class^="Cashback__CashbackInfo-"]',rx:"(.*?)%"}}}]),this.featureFlags=new j({url:"https://ffconf.ecbsn.com/featureflags",appId:"1af2274e-266f-4228-8765-b498deb0cc46",apiKey:"c0469223-7cfc-49bc-b1d3-378b71d44817",updateInterval:72e5},{browser:u.a.browser.name,version:u.a.extension.version}),u.a.browser.isChrome&&(this.installed_extensions=new C),this.on({sync:function(){this.installed_extensions&&this.installed_extensions.check()},"sync-data":function(){this.betterChoices.domains.fetch()},"change:activityUpdateInterval":function(e,t){EBATES.member.activity.setUpUpdate(t)}}),u.a.extension.attachEvent("settings",(e,t)=>{e.data&&this.userSettings.save(e.data),t&&t(this.toJSON())}),u.a.extension.attachEvent("getBrowserNotificationPermission",e=>{EBATES.settings.browserNotification.requestPermission(e.data)}),u.a.extension.attachEvent("getInterstitials",(e,t)=>{t(this.interstitials.toJSON())})},load(){return Promise.all([this.promos.fetch(),this.blacklist.fetch(),this.userSettings.fetch()]).catch(e=>{})},toJSON(){return r.default.extend(this.userSettings.toJSON(),f.f.prototype.toJSON.apply(this,arguments),{checkoutNotifications:this.checkoutNotifications.toJSON(),ordersAvailable:!!EBATES.member.get("oneReceiptEnabled")&&u.a.browser.isWebkit,serp:this.serp,blacklist:this.blacklist.toJSON(),betterChoices:this.betterChoices.toJSON(),promos:this.promos.toJSON(),user_id:EBATES.member.id,ebToken:EBATES.ebToken,domain:d.a.domain,iscb:this.iscb,travelStoresTracking:this.travelStoresTracking,extensionDisabled:EBATES.member.isExtensionDisabled(),featureFlags:this.featureFlags.toJSON(),isOffline:0===EBATES.merchants.length||0===EBATES.merchants.rewards.length,toolbarId:window.toolbarId})}})},function(e,t,n){"use strict";var r=n(0),i=n(5),a=n.n(i),o=n(29),s=n.n(o),c=n(2),u=n(32),l=n(7),h=n(8),d=n(9);n(26);let f=a.a.Model.extend({idAttribute:"storeId"});var p=d.c.extend({model:f,DEFAULT_UPDATE_INTERVAL:18e4,dynamic:!1,expired:!1,url(){var e,t;const n=(null===(e=EBATES)||void 0===e||null===(t=e.member)||void 0===t?void 0:t.get("targetSet"))||"";return Object(h.k)(l.a.STORE_REWARDS).replace("{channel}",this.channel)+(n?"&targetSet=".concat(n):"")},initialize(e,t={}){return this.channel=t.channel||4,4===this.channel&&(this.key="rewards"),c.a.extension.attachEvent("updateRewards",()=>{this.fetch().catch(()=>{})}),c.a.extension.attachEvent("getRewards",(e,t)=>{if(e&&e.data&&e.data.storeId){let n=this.get(e.data.storeId);n&&t(n.toJSON())}}),this.once({error:()=>this.readCache({cache:!0})}),this.on({sync:(e,t,n)=>{n&&(this.expired=!1,c.a.extension.setItem("rewardsExpire",Date.now()+EBATES.settings.get("rewardsExpire")))},error:()=>{this.checkExpiration()}}),d.c.prototype.initialize.apply(this,arguments)},async checkExpiration(){const e=await c.a.extension.getItem("rewardsExpire"),t=await c.a.extension.getItem("rewards.nextUpdateTime");e&&Date.now()>parseInt(e,10)&&!this.expired&&(this.expired=!0,u.a.logger.warn("RewardsExpired",{expired:e,next:t,now:Date.now()}))},parse(e){var t;return null===(t=e.store)||void 0===t?void 0:t.map(e=>{let t={storeId:e.id,reward:e.reward,tiers:e.tiers};if(!t.tiers&&e.reward&&e.reward.total&&e.reward.total.range&&e.reward.total.description){let n=e.reward.total.description.split("\n").map(e=>{let t=e.match(/(.+ Cash Back) (.*)/);if(t)return{cashBack:t[1],description:t[2]}}).filter(Boolean);n&&n.length&&(t.tiers=n)}return t})}});let g=a.a.Model.extend({idAttribute:"storeId",toJSON(){let e=a.a.Model.prototype.toJSON.apply(this,arguments);return e.categories=e.categories.map(e=>{let t=this.collection.categoryNames.get(e);return t?t.toJSON():{categoryId:e}}),e}}),m=a.a.Model.extend({idAttribute:"categoryId"});var E=d.a.extend({model:g,timeout:864e5,dynamic:!1,key:"categories-merchants",url:()=>Object(h.k)(l.a.STORE_CATEGORIES),initialize(){this.categoryNames=new v,c.a.extension.attachEvent("merchants.categories",async(e,t)=>{await this.fetch(),t(this.toJSON())})},fetch(){return Promise.all([d.a.prototype.fetch.apply(this,arguments),this.categoryNames.fetch()])},parse:e=>r.default.map(e.store,e=>({storeId:e.id,categories:e.categories}))});let v=d.a.extend({model:m,timeout:864e5,dynamic:!1,key:"categories",url:()=>Object(h.k)(l.a.CATEGORIES),parse:e=>e.categories});var _=n(43),y=n(59),b=n(24),I=n(51),w=n(40),T=n(82);class A extends T.a{constructor(){super(),this._id="top-products",this._url="https://apituner.ecbsn.com/apituner/pcs/v2/search/product/getProducts?version=2.0&client=Toolbar&partnerId=1&fq=storeId:%224767%22&pgsz=300",this.UPDATE_INTERVAL=36e5,c.a.extension.attachEvent("getPromoProducts",async({data:e},t)=>{const{storeId:n}=e;t(await(async()=>{if(EBATES.settings.featureFlags.variation("promoProducts")){let o=EBATES.settings.promos.find(e=>{var t;return"top-products"===e.get("type")&&(null===(t=e.get("config"))||void 0===t?void 0:t.storeId)===n&&e.isActive()});if(o){var e,t,r,i,a;if(null===(e=o.get("config"))||void 0===e?void 0:e.requestUrl)this._url=null===(a=o.get("config"))||void 0===a?void 0:a.requestUrl;let n=await this.load(),s=null===(t=o.get("config"))||void 0===t?void 0:t.url;return{products:null===(r=o.get("config"))||void 0===r||null===(i=r.products)||void 0===i?void 0:i.map(e=>{let t=n.find(t=>t.id===e);var r;t&&(t.landingUrl=null===(r=o.get("config"))||void 0===r?void 0:r.url);return t}).filter(Boolean).slice(0,12),landingUrl:s}}}return null})())})}get url(){return this._url}parse(e){var t,n;return null==e||null===(t=e.response)||void 0===t||null===(n=t.docs)||void 0===n?void 0:n.map(e=>(e.imageUrlEbates="https://product-image.ebates.com/".concat(e.imageUrlEbates),e))}}var S=n(54);let O=d.g.extend({idAttribute:"matchPattern",initialize(){this.set({topDomain:Object(h.f)(this.get("domainName"))}),".*.*"!==this.get("matchPattern")&&(this.match=new RegExp(this.get("matchPattern"),"i"))}}),R=a.a.Collection.extend({model:O}),N=d.g.extend({DEFAULT_TIMEOUT:18e5,NOTIFICATION_RESET_TIMEOUT:36e5,idAttribute:"storeId",deals:null,defaults:{activationCode:0,notification:!0,"notification-reminder":!1,"notification-checkout":!0,"notification-confirmation":!0,activated:!1,suppressed:!1},processCode(){let e=this.get("activationCode"),t=this.get("reward")&&this.get("reward").total;if(t){let n=0!==e&&t&&["None","Coupons"].indexOf(t.display)<0&&(parseFloat(t.amount)>0||0===parseFloat(t.amount)&&t.range&&parseFloat(t.range.high)>0),r=[3,5].includes(e)&&n;this.set({settings_notification:3===e&&n||2===e,settings_confirmation:r||6===e,settings_checkout:r,settings_serp:3===e&&n&&!0!==this.get("serpDisabled"),settings_popup:r,settings_icon:r,settings_deals:[3,5].includes(e),settings_recent:r,settings_caa:[3,5].includes(e),settings_purchase:[3,5].includes(e),offers_cb:n,"notification-reminder":!0})}},initialize(){if(this.collection&&this.has("storeId")&&!this.has("reward")){var e=this.collection.rewards.get(this.id);e&&this.set(e.toJSON())}return this.has("storeId")&&(this.deals=new _.a([],{url:Object(h.k)(l.a.STORE_DEALS).replace("{storeId}",this.get("storeId"))})),this.on({"change:reward":this.processCode,"change:serpDisabled":this.processCode,"change:activationCode":this.processCode,"change:visit":function(e,t){t&&!this.previous("visit")&&this.get("track_events")&&EBATES.log({event_type:"store_visit",location_flag:"merchant",merchant_id:this.get("storeId"),on_ebates:this.get("storeId")?"Y":"N",offers_cb:this.get("offers_cb")?"Y":"N",ebates_trip:this.get("ttn")?"Y":"N",tracking_ticket:this.get("ttn")})},"change:activated":function(e,t){if(!t&&(this.unset("sessionReward"),this.get("settings_recent"))){const e=this.getCashBackAmount();var n=this.collection.recent.get(this.get("storeId"));n&&n.set({cashBackAmount:e,cashBackAmountWas:e,lastVisit:Date.now()},{merge:!0})}},"change:ttn":function(e,t){if(t){if(this.get("activationSource")){const e=EBATES.merchants.categories.get(this.id),t=e&&e.get("categories")[0];b.b.track("Start Shopping Trip",{store_category:t,store_name:this.get("storeName"),store_id:this.get("storeId"),tracking_ticket:"ebs".concat(this.get("ttn"),"sbe"),attribution_source_previous_click:this.get("activationSource"),activation_type:this.get("activationType")})}EBATES.log({event_type:"activation_source",location_flag:this.get("activationSource"),merchant_id:this.get("storeId"),tracking_ticket:this.get("ttn")}),this.unset("activationSource"),this.unset("activationType")}},"change:state":function(e,t){"activated"===t?(this.set({notification:!0,"notification-reminder":!1,"notification-confirmation":!0,activated:!0,suppressed:!1,competitor:null}),this.resetTimeout(!0),S.a.start(this)):"suppressed"===t?(c.a.extension.fireEvent("closeNotification",{tabId:c.a.browser.ALLTABS,data:this.toJSON()}),this.showTakeover(),this.set({activated:!1,notification:!1,"notification-reminder":!1,"notification-checkout":!1,"notification-confirmation":!1,suppressed:!0,ttn:null,tabId:null,activationSource:null,activationPartner:null,sessionInterval:null}),S.a.stop(this),this.resetTimeout()):(this.set({visit:null,notification:!0,"notification-reminder":!0,"notification-checkout":!0,"notification-confirmation":!0,activated:!1,suppressed:!1,ttn:null,tabId:null,competitor:null,activationSource:null,activationPartner:null,pmDisabled:!1,sessionInterval:null}),S.a.stop(this)),c.a.extension.fireEvent("merchant.state:change")},"change:preceding_screen_name":function(){setTimeout(()=>this.unset("preceding_screen_name"),3e4)}}),this.processCode(),d.g.prototype.initialize.call(this)},toJSON(e={}){let t=d.g.prototype.toJSON.apply(this,arguments);if(e.channel){let n=this.collection.channelRewards.get(e.channel);if(n){let e=n.get(t.storeId);e&&(t.reward=e.toJSON().reward)}}let n=EBATES.member.bonuses.chain().filter(e=>e.get("active")&&e.get("storeIds")&&e.get("storeIds").includes(this.get("storeId"))).invoke("toJSON").value();if(EBATES.settings.promos.where({active:!0,hover:!0}).forEach(e=>{if(e.isActive()){let t=e.campaigns&&e.campaigns.findWhere({hover:!0}),r=t&&t.stores.findWhere(this.pick("storeId"));if(t&&r||!t){let t=r?r.attributes:null,i=e.get("description")?e.get("description").replace("%storeName",this.get("storeName")).replace("%url",e.get("url")):null;n.push({...e.toJSON(),...t,type:"promo",description:i})}}}),!this.get("offers_cb")){let e=EBATES.settings.promos.findWhere({type:"recommended",active:!0,storeId:this.id});e&&(t.recommendedStores=e.toJSON())}t.hoverMessageTrheshold&&t.reward&&Object(h.b)(t.reward.total,{amount:t.hoverMessageTrheshold})>=0&&delete t.hoverMessage;const r=this.storeContent?this.storeContent.toJSON():null,i=EBATES.merchants.categories.findWhere({storeId:this.get("storeId")}),a=i?i.get("categories"):[];let o=EBATES.merchants.recent.get(this.get("storeId"));return o&&(t.reward={...t.reward,...o.reward}),t.sessionReward&&(t.reward.total=t.sessionReward),{...t,storeContent:r,bonuses:n,categories:a,cashBackAmount:this.getCashBackAmount(),cashBackAmountWas:o?o.get("cashBackAmountWas"):null,cashBackDifference:o?o.get("cashBackDifference"):null,lastVisit:o?o.get("lastVisit"):null,rewardsExpired:this.collection.rewards.expired,loggedIn:EBATES.loggedIn,travelStore:EBATES.settings.get("travelStores").includes(this.get("storeId"))}},showTakeover(){this.has("tabId")&&this.get("offers_cb")&&EBATES.settings.get("features").takeover&&(c.a.extension.fireEvent("takeover",{tabId:this.get("tabId"),data:this.toJSON()}),EBATES.log({event_type:"shopping_trip_deactivated",merchant_id:this.get("storeId"),competitor_domain:this.get("competitor"),tracking_ticket:this.get("ttn")}))},isStandDownIgnored(){const e=EBATES.settings.promos.get("standdown-config");return!!(e&&e.get("active")&&e.campaigns&&e.campaigns.find(e=>e.stores.get(this.id)))},resetTimeout(){this.checkSessionTimeout(),this.set("visit",Date.now())},checkSessionTimeout(){const e=this.get("sessionInterval")||this.DEFAULT_TIMEOUT;this.has("visit")&&(this.get("visit")+e<Date.now()&&(this.unset("state",{silent:!0}),this.trigger("change:state",this)),this.get("visit")+this.NOTIFICATION_RESET_TIMEOUT<Date.now()&&this.set("notification",!0))},getCashBackAmount(){let e=this.get("reward")&&(this.get("reward").total||this.get("reward").base),t=e=>e.toString().replace(/\.0+$/,"");if(e){let n="";switch(e.display){case"Percentage":n=e.range&&e.range.high?"Up to ".concat(t(e.range.high),"%"):"".concat(t(e.amount),"%");break;case"Fixed":n=e.range&&e.range.high?"Up to ".concat(t(s.a.formatMoney(e.range.high))):t(s.a.formatMoney(e.amount));break;case"Coupons":n="Offers Only";break;case"None":n="Not Available"}return n}},async activateInBackground(e){const t=await fetch("".concat(e,"&response=json")),n=(await t.json()).ticket[0];if(n&&n.storeId){const t=n.link[0]["@href"],r=n.trackingNumber.replace(/\D/g,""),i=await c.a.browser.navigate({tabId:c.a.browser.NEWTAB,active:!1,pinned:!0});b.a.logSessionEvent({tracking_ticket:r}),setTimeout(async()=>{EBATES.settings.affiliates.match(e,i.id),EBATES.settings.affiliates.activations.addParameters(i.id,{trackingTicketNumber:r}),await c.a.browser.navigate({tabId:i.id,url:t});const n=this.get("activationInterval")||EBATES.settings.get("activationInterval");let a=window.setTimeout(()=>{c.a.browser.isSafari?c.a.extension.fireEvent("closeWindow",{tabId:i.id}):browser.tabs.remove(i.id),c.a.browser.detachEvent(c.a.browser.TABCHANGED,o)},Number.isInteger(n)?n:1e4),o=({tabId:e})=>{e===i.id&&(c.a.browser.detachEvent(c.a.browser.TABCHANGED,o),window.clearTimeout(a))};c.a.browser.attachEvent(c.a.browser.TABCHANGED,o)},c.a.browser.isLegacyEdge?2e3:0)}},isEligibleForIgnoredStandDown(){const e=EBATES.settings.promos.get("standdown-config");return!!(e&&e.get("active")&&e.campaigns&&e.campaigns.find(e=>e.stores.get(this.id)))},isEligibleForBackgroundActivation(){let e=EBATES.settings.promos.get("background-activation");if(e&&e.get("active")&&e.campaigns){let t=e.campaigns.find(e=>e.stores.get(this.id));if(t&&t.get("test")){return"A"===EBATES.tests.get(t.get("test"))}}return!1},activate(e={}){e.activationSource&&this.set({activationSource:e.activationSource});let t=Object(h.j)(e.store_url,EBATES.settings.get("sanitization"));8381===this.id&&(t=Object(h.j)(t,"SourceCode=[^&]+&?"));let n=e.product_url,r=this.get("mpl")?40874:e.eeid,i=this.toJSON(),a=e.channel||w.a,o=r=>{let o=r;r="".concat(r.replace("&store_url=%deepLinkUrl%",""),"&channel=").concat(a,"&tb_v=").concat(c.a.extension.version),this.get("mpl")&&(r+="&mpl_id=".concat(this.get("mpl"))),e.special&&(r+="&special=".concat(e.special)),e.toolbarFeatureId&&(r+="&toolbarFeatureId=".concat(e.toolbarFeatureId)),e.tabId&&e.tabId!==c.a.browser.NEWTAB&&500!==EBATES.member.get("rakutenStatusType")&&t&&(!i.offers_cb&&2!==this.get("activationCode")||i.nonTrackingPattern&&t.search(i.nonTrackingPattern)>=0||this.get("mpl")||this.isEligibleForBackgroundActivation()||e.forceBackgroundActivation)?this.activateInBackground(r).then(()=>{this.set({activationType:"background"}),i.settings_notification&&c.a.extension.fireEvent("showConfirmationHover",{tabId:e.tabId}),EBATES.log({event_type:"bg_activation",merchant_id:this.id,tracking_ticket:this.get("trackingTicketNumber")})}):(n?(r="".concat(r,"&product_url=").concat(encodeURIComponent(n)),this.set({activationType:"product"})):r.indexOf("store_url")<0&&t&&this.get("affiliatizerEnabled")?(r="".concat(r,"&store_url=").concat(encodeURIComponent(t)),this.set({activationType:"affiliatizer"})):this.set({activationType:"xfas"}),r.length>=2048&&(r=o),c.a.browser.navigate({url:r,tabId:e.tabId}))};switch(parseInt(this.get("activationCode"),10)){case 2:if(this.has("storeLandingURL")){o(Object(h.a)(i.storeLandingURL),"tb=yes&sourceName=toolbar&eeid=".concat(r||23509,"&utm_source=extension&utm_medium=button&utm_campaign=").concat(e.utm_campaign||"hover"));break}case 5:if(this.has("storeLandingURL")){o(Object(h.a)(i.storeLandingURL));break}default:o(Object(h.a)(i.shoppingURL||Object(h.k)(l.a.BASE),"tb=yes&sourceName=toolbar&eeid=".concat(r||23509)))}},getStoreContent(){return this.storeContent?Promise.resolve():(this.storeContent=new k({id:this.id}),this.storeContent.fetch())}}),k=a.a.Model.extend({url(){return Object(h.k)(l.a.STORE_CONTENT).replace("{storeId}",this.id)},parse:e=>e&&e.storeContent?e.storeContent[0]:{}}),x=y.a.extend({url:()=>"".concat(Object(h.k)(l.a.CAMPAIGNS),"?id=9357"),initialize(){window.setInterval(()=>this.fetch(),864e5)},toJSON(){return this.map(e=>({storeId:e.id,settings_optout:!0}))}});t.a=d.c.extend({url:()=>Object(h.k)(l.a.STORES),model:N,key:"merchants",rewardsSynced:!1,IDLE_INTERVAL:18e5,initialize(){return this.recent=new C,this.rewards=new p,this.channelRewards=new Map([[w.b,new p(null,{channel:w.b})]]),this.categories=new E,this.optout=new x,this.domains=new R,this.topDealsProducts=new A,this.on({remove(e){this.recent.get(e.get("storeId"))&&this.recent.remove(e.get("storeId"))},reset(){EBATES.member.recommended.prepare()}}),c.a.browser.isSafari&&this.recent.fetch(),this.once("sync",()=>Promise.all([EBATES.member.recommended.prepare(),this.rewards.fetch(),this.recent.fetch(),this.optout.fetch(),this.categories.fetch()]).catch(()=>{})),this.listenTo(this.rewards,{"change:reward change:tiers add":function(e){let t=this.get(e.id);t&&t.set(e.toJSON())},remove:function(e){this.remove(e.id)},request:function(){this.rewardsUpdating=!0},sync:function(){this.rewardsSynced=!0,this.rewardsUpdating=!1,this.updateRecent(),this.trigger("sync-rewards")}}),this.listenTo(this.optout,{sync:function(){this.set(this.optout.toJSON(),{add:!1,remove:!1,merge:!0})}}),c.a.browser.attachEvent(c.a.browser.DOCUMENTCOMPLETE,({url:e,tabId:t})=>{if(!Object(h.g)(e)&&EBATES){let r=this.match(e);if(r){var n;let i=null===(n=EBATES.session_competition)||void 0===n?void 0:n.domain;r.checkSessionTimeout();let a=EBATES.settings.affiliates.state(t);if(a.activation||a.suppress){if(a.activation)EBATES.loggedIn&&EBATES.activate(r,a.activation);else if(a.suppress){EBATES.session_competition&&(EBATES.log(EBATES.session_competition),EBATES.log({event_type:"competitive_activate",location_flag:"competition",url:e}),EBATES.session_competition=null);const t=i&&EBATES.settings.get("standDownDomains").includes(i);EBATES.settings.featureFlags.variation("standDownByMerchant",!1)&&!t&&r.isEligibleForIgnoredStandDown()?(EBATES.log({event_type:"button_stand_down_ignored",merchant_id:r.get("storeId"),tracking_ticket:r.get("ttn"),url:a.suppress.url,competitor:i}),"activated"===r.get("state")&&r.showTakeover(),r.unset("state")):(EBATES.log({event_type:"button_stand_down",merchant_id:r.get("storeId"),tracking_ticket:r.get("ttn"),url:a.suppress.url,competitor:i}),r.set({competitor:i,state:"suppressed"}))}EBATES.settings.affiliates.clear(t)}r.get("activated")&&t&&r.set({tabId:t}),i&&EBATES.settings.betterChoices.get("partnerDomains").includes(i)&&(r.set("pmDisabled",!0),EBATES.session_competition=null),r.resetTimeout(),S.a.visit(r,e)}}return!0}),c.a.extension.attachEvent("getMerchant",async({url:e},t)=>{if(!Object(h.g)(e)&&EBATES){let n=this.match(e);if(n){try{await Promise.all([this.rewards.fetch(),this.categories.fetch()])}catch(e){}if(this.rewards.expired){const e=await c.a.extension.getItem("rewardsExpire"),t=await c.a.extension.getItem("rewards.nextUpdateTime");u.a.logger.warn("RewardsExpired",{expired:e,next:t,now:Date.now(),source:"getMerchant"})}EBATES.ebToken&&n.get("settings_recent")&&this.recent.visit(n),t({...n.toJSON(),blacklisted:EBATES.settings.userSettings.get("blacklistEnabled")&&EBATES.settings.blacklist.contains(e)})}else t(null)}return!0}),c.a.extension.attachEvent("getStores",({data:e},t)=>{t(e.map(e=>{let t=EBATES.merchants.findWhere({storeId:e});return t&&t.toJSON()}))}),c.a.extension.attachEvent("getStore",async(e,t)=>{let{storeId:n,fetch:r=!1}=e.data,i=e.data.url||I.a.active.url,a=null;if(r)try{await Promise.all([EBATES.merchants.fetch(),EBATES.merchants.rewards.fetch()])}catch(e){}n?a=this.get(n):(!e.url||e.url.indexOf(l.a.domain)<0)&&(a=this.match(i)),t(a?a.toJSON():null)}),c.a.extension.attachEvent("getStoresByName",(e,t)=>{if(e.data.name){const n=this.filter(t=>{const n=t.get("storeName");if(n)return e.data.name.length>n.length?-1!==e.data.name.indexOf(n):-1!==n.indexOf(e.data.name)});t(n&&n.length?n.map(e=>e.toJSON()):null)}else t(null)}),c.a.extension.attachEvent("activate",({tabId:e,data:t})=>{let n=this.get(t.storeId);n&&n.activate({tabId:e||I.a.active.tabId,store_url:t.store_url,...t})}),c.a.extension.attachEvent("set",e=>{if(e.data){let t=e.data.storeId?EBATES.merchants.get(e.data.storeId):EBATES.merchants.match(e.url);t&&t.set(e.data)}}),c.a.extension.attachEvent("getStoreContent",(e,t)=>{let n=this.get(e.data.storeId);n&&n.getStoreContent().catch(()=>{}).then(()=>{t(n.storeContent.toJSON())})}),c.a.extension.attachEvent("getOffers",async(e,t)=>{const{storeId:n}=e.data;if(!n)throw new Error("Missing storeId");{let r=this.findWhere({storeId:n});if(r&&r.get("settings_deals")){try{await r.deals.fetch()}catch(e){}t(r.deals.toJSON())}else t([])}}),c.a.extension.attachEvent("merchants",(e,t)=>{t(this.toJSON())}),c.a.extension.attachEvent("merchants.recent",(e,t)=>{t(this.recent.toJSON())}),c.a.extension.attachEvent("merchants.search",({data:e},t)=>{t(this.search(e.term.toLowerCase()))}),c.a.extension.attachEvent("isEligibleForBackgroundActivation",(e,t)=>{const{storeId:n}=e.data,r=this.get(n);t(r?r.isEligibleForBackgroundActivation():null)}),d.c.prototype.initialize.apply(this,arguments)},fetch(e){return d.c.prototype.fetch.call(this,{add:!0,merge:!0,remove:!0,...e})},merge(e){this.set(e)},updateAttributes(){return this.rewards.fetch().then(()=>this.attributesUpdated=!0,()=>{})},updateRecent(){for(let e=this.recent.length-1;e>=0;e--){let t=this.recent.at(e),n=this.get(t.get("storeId"));if(n){const e=n.getCashBackAmount();e&&t.set({cashBackAmount:e})}else this.recent.remove(t)}this.recent.sort(),this.recent.save()},match(e){let t=Object(h.f)(e);if(t){let n=this.domains.where({topDomain:t}).filter(t=>t.match&&t.match.test(e));if(n.length)return this.get(r.default.max(n,e=>e.match.source.length).get("storeId"))}return null},search(e){return this.filter(t=>t.get("offers_cb")&&t.get("settings_popup")&&0===t.get("storeName").toLowerCase().indexOf(e)).map(e=>e.toJSON())},parse(e){let t=e.domainEntities;return EBATES.settings.domains&&EBATES.settings.domains.forEach(e=>{let n=t.find(t=>e.storeId===t.storeId);n?Object.assign(n,e):t.push(e)}),t.map(e=>(e.orderConfirmationURLRegex&&(e.settings_cc=!0),e)),this.domains.set(t.map(({storeId:e,matchPattern:t,domainName:n})=>({storeId:e,matchPattern:t,domainName:n}))),t}});let B=d.g.extend({idAttribute:"storeId",defaults:{cashBackDifference:0,lastVisit:Date.now()},initialize(){this.on("add change:cashBackAmount change:cashBackAmountWas",()=>{if(this.get("cashBackAmount")&&this.get("cashBackAmountWas")){var e=parseFloat(this.get("cashBackAmount").replace(/[^\d.]/g,"")),t=parseFloat(this.get("cashBackAmountWas").replace(/[^\d.]/g,""));e?this.set({cashBackDifference:e-t}):this.collection.remove(this)}})},toJSON(){let e=EBATES.merchants.get(this.get("storeId"));return e?{...e.toJSON(),...d.g.prototype.toJSON.apply(this,arguments)}:d.g.prototype.toJSON.apply(this,arguments)}}),C=d.e.extend({model:B,comparator:(e,t)=>e.get("cashBackDifference")===t.get("cashBackDifference")?e.get("lastVisit")>t.get("lastVisit")?-1:1:e.get("cashBackDifference")>t.get("cashBackDifference")?-1:1,key:"recent",size:500,initialize(){this.on({add:function(){this.sort(),this.length>this.size&&this.pop(),this.save()}})},save(){c.a.extension.setItem(this.key,this.map(e=>e.attributes))},visit(e){const t=e.getCashBackAmount(),n=e.get("storeId");let r=this.get(n);if(this.add({storeId:n,cashBackAmount:t,lastVisit:Date.now()},{merge:!0}),r){const e=r.get("cashBackAmountWas");e>t?r.set("cashBackAmountWas",t):e<t&&!r.updateTimeout&&(r.updateTimeout=setTimeout(()=>{let e=this.get(n);e&&e.set("cashBackAmountWas",t),e.updateTimeout=null},9e5))}else r=this.get(n),r.set("cashBackAmountWas",t)}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(11),i=n.n(r),a=n(76),o=n(77),s=n.n(o),c=n(2),u=n(32),l=n(51),h=n(8),d=n(7),f=n(83),p=n(24);n(26);let g={};f.a.prototype.captureOrderPage=function(e){return fetch(Object(h.k)(d.a.CAPTURE_ORDER),{method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip","X-Button-Version":c.a.extension.version},body:new Uint8Array(new a.gzip(JSON.stringify(e)))})},c.a.extension.attachEvent("CaptureOrderPage",e=>{if(g[e.tabId]&&g[e.tabId]===e.url)return;let t=EBATES.member.isExtensionDisabled(),{logging:n}=EBATES.settings.toJSON();"opt_out"===n||"pending"===n||t||(g[e.tabId]=e.url,e.data.merchant.ttn&&EBATES.captureOrderPage({tenant_id:1,source_name:"toolbar",store_name:e.data.merchant.storeName,store_id:e.data.merchant.storeId,shopping_trip_id:"ebs"+e.data.merchant.ttn+"sbe",content_source:e.url,content_type:"order confirmation",content_format:"html",client_type:c.a.browser.name.toLowerCase(),client_version:c.a.extension.version,content:e.data.content,load_time:e.data.load_time,javascript_error:e.data.javascript_error}))});let m=e=>{g[e.tabId]&&e.url!==g[e.tabId]&&delete g[e.tabId]};var E;c.a.browser.attachEvent(c.a.browser.DOCUMENTCOMPLETE,m),c.a.browser.attachEvent(c.a.browser.TABCLOSED,m),c.a.extension.attachEvent("interstitial",({tabId:e,data:t})=>{!t.partner||t.trackingTicketNumber&&t.sessionReward?(EBATES.settings.affiliates.activations.addParameters(e,t),p.a.logSessionEvent({tracking_ticket:t.trackingTicketNumber})):EBATES.settings.affiliates.activations.clear(e)}),c.a.extension.attachEvent("xfas",async e=>{const{shoppingURL:t,storeURL:n,wid:r,activationSource:i,campaignId:a}=e.data,o="".concat(t,"&response=json&sourceName=").concat(r,"&tracking_campaign_id=").concat(a,"&store_url=").concat(encodeURIComponent(n));EBATES.settings.affiliates.match(o,e.tabId);const s=await fetch(o),u=(await s.json()).ticket[0];if(u&&u.storeId){const t=u.trackingNumber.replace(/\D/g,"");EBATES.settings.affiliates.activations.addParameters(e.tabId,{trackingTicketNumber:t}),EBATES.merchants.get(u.storeId).set({activationSource:i,activationType:"silent"}),await c.a.browser.navigate({url:u.link[0]["@href"].replace(/wid=.*?&/,"wid=".concat(r,"&")),tabId:e.tabId})}}),f.a.prototype.logCloseSession=async function(){EBATES.sessionData={},p.a.closeSession()},f.a.prototype.log=async function(e,t={}){const n=Object(h.f)(e&&e.url||l.a.active.url)||"";p.a.log({url:n,...e},t)},c.a.extension.attachEvent("InternalLoggingEvent",({url:e,data:t})=>{e&&(t={url:e,...t}),EBATES.log(t)}),c.a.browser.attachEvent(c.a.browser.DOCUMENTCOMPLETE,({url:e})=>{if(EBATES){window.clearTimeout(EBATES.session_timeout),EBATES.session_id&&(EBATES.session_timeout=window.setTimeout(EBATES.logCloseSession,18e5));let t=Object(h.f)(e);EBATES.settings.get("competitorDomains").includes(t)&&(EBATES.session_competition={url:e,domain:t,event_type:"competitive_visit",location_flag:"competition"})}}),window,E=new function(){let e="https://".concat("ebates-pages-store",".s3.amazonaws.com/");function t(e,t,n){const r=(new Date).toGMTString(),i="".concat(e,"\n\n").concat(t||"","\n\nx-amz-date:").concat(r,"\n/").concat("ebates-pages-store","/").concat(n),a=(new s.a.SHA1).b64_hmac("+tjwfxTPT3kRh+gxno7FwDn74dTDmK8I10hFoMZu",i);return{"Content-Type":t,Authorization:"AWS ".concat("AKIAIF6APH57A3IQLKUQ",":").concat(a),"x-amz-date":r}}this.putFile=async({filename:n,content:r,callback:i=(()=>{})})=>{await fetch(e+n,{method:"PUT",headers:t("PUT","text/plain; charset=UTF-8",n),body:r}),i(e+n)}},c.a.extension.attachEvent("uploadFile",e=>{E.putFile({path:"/",filename:"<user_id>_<merchant_id>_<page_type>_<extension_type>_<tripid>_<timestamp>.html".replace("<merchant_id>",1).replace("<user_id>",EBATES.member.id).replace("<page_type>",e.data.page_type).replace("<extension_type>",c.a.browser.name.charAt(0)).replace("<tripid>",0).replace("<timestamp>",Date.now()),content:e.data.content,callback:e=>{EBATES.session_id||(EBATES.session_id="".concat(window.toolbarId,"||").concat(i()().format("YYYYMMDDhhmmss"))),EBATES.log({filename:e,event_type:"orderconf",session_id:EBATES.session_id,merchant_id:1,user_id:EBATES.member.id,created_ts:i()().format("DDMMYYYY HHmmss")})}})}),function(){let e=new Map,t=t=>{e.has(t)&&(e.get(t).timeout&&window.clearTimeout(e.get(t).timeout),e.delete(t))};c.a.browser.attachEvent(c.a.browser.TABCLOSED,n=>{let r=e.get(n.tabId);r&&(EBATES.log({event_type:"interstitial_status",reason:"close tab",location_flag:r.location_flag,merchant_id:r.storeId,url:r.urls.toString()}),u.a.logger.warn("InterstitialStatus",{reason:"close tab",location_flag:r.location_flag,merchant_id:r.storeId,url:r.urls.toString()})),t(n.tabId)}),c.a.browser.attachEvent(c.a.browser.BEFORENAVIGATE,n=>{let r=(e=>{let t=/\/\/[-\w]*\.(?:ebates|rakuten)\.com\/.*?(\d+)-xfas(?:\?.*sourceName=([\w-]*))?/.exec(e);if(!(t&&t[1]&&EBATES))return null;{let n=EBATES.merchants.get(parseInt(t[1],10));if(n)return{storeId:n.id,location_flag:n.get("activationSource")||t[2],urls:[e]}}})(n.url);if(r)e.set(n.tabId,{...r,timeout:window.setTimeout(()=>{let t=e.get(n.tabId);t&&(EBATES.log({event_type:"interstitial_status",reason:"timeout",location_flag:r.location_flag,redirection_chain:t.urls.toString(),merchant_id:t.storeId}),u.a.logger.warn("InterstitialStatus",{reason:"timeout",location_flag:r.location_flag,redirection_chain:t.urls.toString(),merchant_id:t.storeId}))},3e4)});else if(e.has(n.tabId)){let r=EBATES.merchants.match(n.url);r&&r.id===e.get(n.tabId).storeId&&t(n.tabId)}})}()},function(e,t,n){"use strict";var r=n(276),i=n(48),a=n(123),o=n(104),s=n(124),c=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(o[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var l;if(l="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,l)))throw new Error(o[n]);this._dict_set=!0}}function l(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}u.prototype.push=function(e,t){var n,o,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=a.string2buf(e):"[object ArrayBuffer]"===c.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(u),s.next_out=0,s.avail_out=u),1!==(n=r.deflate(s,o))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===o?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==o||(this.onEnd(0),s.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=u,t.deflate=l,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,l(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,l(e,t)}},function(e,t,n){"use strict";var r,i=n(48),a=n(277),o=n(121),s=n(122),c=n(104);function u(e,t){return e.msg=c[t],t}function l(e){return(e<<1)-(e>4?9:0)}function h(e){for(var t=e.length;--t>=0;)e[t]=0}function d(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function f(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,d(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function g(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function m(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,u=e.window,l=e.w_mask,h=e.prev,d=e.strstart+258,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+o]===p&&u[n+o-1]===f&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<d);if(r=258-(d-a),a=d-258,r>o){if(e.match_start=t,o=r,r>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=h[t&l])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead}function E(e){var t,n,r,a,c,u,l,h,d,f,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=p?r-p:0}while(--n);t=n=p;do{r=e.prev[--t],e.prev[t]=r>=p?r-p:0}while(--n);a+=p}if(0===e.strm.avail_in)break;if(u=e.strm,l=e.window,h=e.strstart+e.lookahead,d=a,f=void 0,(f=u.avail_in)>d&&(f=d),n=0===f?0:(u.avail_in-=f,i.arraySet(l,u.input,u.next_in,f,h),1===u.state.wrap?u.adler=o(u.adler,l,f,h):2===u.state.wrap&&(u.adler=s(u.adler,l,f,h)),u.next_in+=f,u.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function v(e,t){for(var n,r;;){if(e.lookahead<262){if(E(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=m(e,n)),e.match_length>=3)if(r=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function _(e,t){for(var n,r,i;;){if(e.lookahead<262){if(E(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=m(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=a._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function y(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function I(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):u(e,-2)}function w(e){var t,n=I(e);return 0===n&&((t=e.state).window_size=2*t.w_size,h(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function T(e,t,n,r,a,o){if(!e)return-2;var s=1;if(-1===t&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>9||8!==n||r<8||r>15||t<0||t>9||o<0||o>4)return u(e,-2);8===r&&(r=9);var c=new b;return e.state=c,c.strm=e,c.wrap=s,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=a+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<a+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=o,c.method=n,w(e)}r=[new y(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(E(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,f(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)})),new y(4,4,8,4,v),new y(4,5,16,8,v),new y(4,6,32,32,v),new y(4,4,16,16,_),new y(8,16,32,32,_),new y(8,16,128,128,_),new y(8,32,128,256,_),new y(32,128,258,1024,_),new y(32,258,258,4096,_)],t.deflateInit=function(e,t){return T(e,t,8,15,8,0)},t.deflateInit2=T,t.deflateReset=w,t.deflateResetKeep=I,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,i,o,c;if(!e||!e.state||t>5||t<0)return e?u(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return u(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,p(i,31),p(i,139),p(i,8),i.gzhead?(p(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),p(i,255&i.gzhead.time),p(i,i.gzhead.time>>8&255),p(i,i.gzhead.time>>16&255),p(i,i.gzhead.time>>24&255),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(p(i,255&i.gzhead.extra.length),p(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(p(i,0),p(i,0),p(i,0),p(i,0),p(i,0),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,3),i.status=113);else{var m=8+(i.w_bits-8<<4)<<8;m|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(m|=32),m+=31-m%31,i.status=113,g(i,m),0!==i.strstart&&(g(i,e.adler>>>16),g(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),d(e),o=i.pending,i.pending!==i.pending_buf_size));)p(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),d(e),o=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,p(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===c&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),d(e),o=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,p(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===c&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&d(e),i.pending+2<=i.pending_buf_size&&(p(i,255&e.adler),p(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(d(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&l(t)<=l(n)&&4!==t)return u(e,-5);if(666===i.status&&0!==e.avail_in)return u(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var v=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(E(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,o,s=e.window;;){if(e.lookahead<=258){if(E(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){o=e.strstart+258;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=258-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==v&&4!==v||(i.status=666),1===v||3===v)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===v&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(h(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),d(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(p(i,255&e.adler),p(i,e.adler>>8&255),p(i,e.adler>>16&255),p(i,e.adler>>24&255),p(i,255&e.total_in),p(i,e.total_in>>8&255),p(i,e.total_in>>16&255),p(i,e.total_in>>24&255)):(g(i,e.adler>>>16),g(i,65535&e.adler)),d(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?u(e,-2):(e.state=null,113===t?u(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,r,a,s,c,u,l,d,f=t.length;if(!e||!e.state)return-2;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return-2;for(1===s&&(e.adler=o(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(h(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new i.Buf8(n.w_size),i.arraySet(d,t,f-n.w_size,n.w_size,0),t=d,f=n.w_size),c=e.avail_in,u=e.next_in,l=e.input,e.avail_in=f,e.next_in=0,e.input=t,E(n);n.lookahead>=3;){r=n.strstart,a=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=2,E(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=u,e.input=l,e.avail_in=c,n.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(48);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);i(u);var l=new Array(60);i(l);var h=new Array(512);i(h);var d=new Array(256);i(d);var f=new Array(29);i(f);var p,g,m,E=new Array(30);function v(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function y(e){return e<256?h[e]:h[256+(e>>>7)]}function b(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function I(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,b(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function w(e,t,n){I(e,n[2*t],n[2*t+1])}function T(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function A(e,t,n){var r,i,a=new Array(16),o=0;for(r=1;r<=15;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=T(a[s]++,s))}}function S(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function O(e){e.bi_valid>8?b(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function R(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function N(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&R(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!R(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function k(e,t,n){var r,i,s,c,u=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],i=e.pending_buf[e.l_buf+u],u++,0===r?w(e,i,t):(w(e,(s=d[i])+256+1,t),0!==(c=a[s])&&I(e,i-=f[s],c),w(e,s=y(--r),n),0!==(c=o[s])&&I(e,r-=E[s],c))}while(u<e.last_lit);w(e,256,t)}function x(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)N(e,a,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],N(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,N(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=c[2*c[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,g++),c[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=f&&(o=d[r-f]),s=c[2*r],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(l[2*r+1]+o)));if(0!==g){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,g-=2}while(g>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(c[2*i+1]!==a&&(e.opt_len+=(a-c[2*i+1])*c[2*i],c[2*i+1]=a),r--)}}(e,t),A(a,u,e.bl_count)}function B(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<c&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4))}function C(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<c&&i===o)){if(s<u)do{w(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(w(e,i,e.bl_tree),s--),w(e,16,e.bl_tree),I(e,s-3,2)):s<=10?(w(e,17,e.bl_tree),I(e,s-3,3)):(w(e,18,e.bl_tree),I(e,s-11,7));s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4)}}i(E);var D=!1;function L(e,t,n,i){I(e,0+(i?1:0),3),function(e,t,n,i){O(e),i&&(b(e,n),b(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){D||(!function(){var e,t,n,r,i,c=new Array(16);for(n=0,r=0;r<28;r++)for(f[r]=n,e=0;e<1<<a[r];e++)d[n++]=r;for(d[n-1]=r,i=0,r=0;r<16;r++)for(E[r]=i,e=0;e<1<<o[r];e++)h[i++]=r;for(i>>=7;r<30;r++)for(E[r]=i<<7,e=0;e<1<<o[r]-7;e++)h[256+i++]=r;for(t=0;t<=15;t++)c[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,c[8]++;for(;e<=255;)u[2*e+1]=9,e++,c[9]++;for(;e<=279;)u[2*e+1]=7,e++,c[7]++;for(;e<=287;)u[2*e+1]=8,e++,c[8]++;for(A(u,287,c),e=0;e<30;e++)l[2*e+1]=5,l[2*e]=T(e,5);p=new v(u,a,257,286,15),g=new v(l,o,0,30,15),m=new v(new Array(0),s,0,19,7)}(),D=!0),e.l_desc=new _(e.dyn_ltree,p),e.d_desc=new _(e.dyn_dtree,g),e.bl_desc=new _(e.bl_tree,m),e.bi_buf=0,e.bi_valid=0,S(e)},t._tr_stored_block=L,t._tr_flush_block=function(e,t,n,r){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),x(e,e.l_desc),x(e,e.d_desc),o=function(e){var t;for(B(e,e.dyn_ltree,e.l_desc.max_code),B(e,e.dyn_dtree,e.d_desc.max_code),x(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?L(e,t,n,r):4===e.strategy||a===i?(I(e,2+(r?1:0),3),k(e,u,l)):(I(e,4+(r?1:0),3),function(e,t,n,r){var i;for(I(e,t-257,5),I(e,n-1,5),I(e,r-4,4),i=0;i<r;i++)I(e,e.bl_tree[2*c[i]+1],3);C(e,e.dyn_ltree,t-1),C(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),k(e,e.dyn_ltree,e.dyn_dtree)),S(e),r&&O(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(d[n]+256+1)]++,e.dyn_dtree[2*y(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){I(e,2,3),w(e,256,u),function(e){16===e.bi_valid?(b(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(279),i=n(48),a=n(123),o=n(125),s=n(104),c=n(124),u=n(282),l=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(s[n]);if(this.header=new u,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[n])}function d(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(e,t){var n,s,c,u,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=a.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===o.Z_BUF_ERROR&&!0===g&&(n=o.Z_OK,g=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==o.Z_STREAM_END&&(0!==d.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(c=a.utf8border(d.output,d.next_out),u=d.next_out-c,h=a.buf2string(d.output,c),d.next_out=u,d.avail_out=f-u,u&&i.arraySet(d.output,d.output,c,u,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=h,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},function(e,t,n){"use strict";var r=n(48),i=n(121),a=n(122),o=n(280),s=n(281);function c(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function l(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):-2}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,l(e)):-2}function d(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,h(e))):-2}function f(e,t){var n,r;return e?(r=new u,e.state=r,r.window=null,0!==(n=d(e,t))&&(e.state=null),n):-2}var p,g,m=!0;function E(e){if(m){var t;for(p=new r.Buf32(512),g=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,g,0,e.work,{bits:5}),m=!1}e.lencode=p,e.lenbits=9,e.distcode=g,e.distbits=5}function v(e,t,n,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),r.arraySet(o.window,t,n-i,a,o.wnext),(i-=a)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=h,t.inflateReset2=d,t.inflateResetKeep=l,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var n,u,l,h,d,f,p,g,m,_,y,b,I,w,T,A,S,O,R,N,k,x,B,C,D=0,L=new r.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),d=e.next_out,l=e.output,p=e.avail_out,h=e.next_in,u=e.input,f=e.avail_in,g=n.hold,m=n.bits,_=f,y=p,x=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;m<16;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(2&n.wrap&&35615===g){n.check=0,L[0]=255&g,L[1]=g>>>8&255,n.check=a(n.check,L,2,0),g=0,m=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&g)){e.msg="unknown compression method",n.mode=30;break}if(m-=4,k=8+(15&(g>>>=4)),0===n.wbits)n.wbits=k;else if(k>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<k,e.adler=n.check=1,n.mode=512&g?10:12,g=0,m=0;break;case 2:for(;m<16;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(n.flags=g,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=g>>8&1),512&n.flags&&(L[0]=255&g,L[1]=g>>>8&255,n.check=a(n.check,L,2,0)),g=0,m=0,n.mode=3;case 3:for(;m<32;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}n.head&&(n.head.time=g),512&n.flags&&(L[0]=255&g,L[1]=g>>>8&255,L[2]=g>>>16&255,L[3]=g>>>24&255,n.check=a(n.check,L,4,0)),g=0,m=0,n.mode=4;case 4:for(;m<16;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&n.flags&&(L[0]=255&g,L[1]=g>>>8&255,n.check=a(n.check,L,2,0)),g=0,m=0,n.mode=5;case 5:if(1024&n.flags){for(;m<16;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}n.length=g,n.head&&(n.head.extra_len=g),512&n.flags&&(L[0]=255&g,L[1]=g>>>8&255,n.check=a(n.check,L,2,0)),g=0,m=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((b=n.length)>f&&(b=f),b&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,u,h,b,k)),512&n.flags&&(n.check=a(n.check,u,b,h)),f-=b,h+=b,n.length-=b),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break e;b=0;do{k=u[h+b++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&b<f);if(512&n.flags&&(n.check=a(n.check,u,b,h)),f-=b,h+=b,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break e;b=0;do{k=u[h+b++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&b<f);if(512&n.flags&&(n.check=a(n.check,u,b,h)),f-=b,h+=b,k)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;m<16;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}g=0,m=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;m<32;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}e.adler=n.check=c(g),g=0,m=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=d,e.avail_out=p,e.next_in=h,e.avail_in=f,n.hold=g,n.bits=m,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){g>>>=7&m,m-=7&m,n.mode=27;break}for(;m<3;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}switch(n.last=1&g,m-=1,3&(g>>>=1)){case 0:n.mode=14;break;case 1:if(E(n),n.mode=20,6===t){g>>>=2,m-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}g>>>=2,m-=2;break;case 14:for(g>>>=7&m,m-=7&m;m<32;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&g,g=0,m=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(b=n.length){if(b>f&&(b=f),b>p&&(b=p),0===b)break e;r.arraySet(l,u,h,b,d),f-=b,h+=b,p-=b,d+=b,n.length-=b;break}n.mode=12;break;case 17:for(;m<14;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(n.nlen=257+(31&g),g>>>=5,m-=5,n.ndist=1+(31&g),g>>>=5,m-=5,n.ncode=4+(15&g),g>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;m<3;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}n.lens[U[n.have++]]=7&g,g>>>=3,m-=3}for(;n.have<19;)n.lens[U[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,B={bits:n.lenbits},x=s(0,n.lens,0,19,n.lencode,0,n.work,B),n.lenbits=B.bits,x){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;A=(D=n.lencode[g&(1<<n.lenbits)-1])>>>16&255,S=65535&D,!((T=D>>>24)<=m);){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(S<16)g>>>=T,m-=T,n.lens[n.have++]=S;else{if(16===S){for(C=T+2;m<C;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(g>>>=T,m-=T,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}k=n.lens[n.have-1],b=3+(3&g),g>>>=2,m-=2}else if(17===S){for(C=T+3;m<C;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}m-=T,k=0,b=3+(7&(g>>>=T)),g>>>=3,m-=3}else{for(C=T+7;m<C;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}m-=T,k=0,b=11+(127&(g>>>=T)),g>>>=7,m-=7}if(n.have+b>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;b--;)n.lens[n.have++]=k}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,B={bits:n.lenbits},x=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,B),n.lenbits=B.bits,x){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,B={bits:n.distbits},x=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,B),n.distbits=B.bits,x){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(f>=6&&p>=258){e.next_out=d,e.avail_out=p,e.next_in=h,e.avail_in=f,n.hold=g,n.bits=m,o(e,y),d=e.next_out,l=e.output,p=e.avail_out,h=e.next_in,u=e.input,f=e.avail_in,g=n.hold,m=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;A=(D=n.lencode[g&(1<<n.lenbits)-1])>>>16&255,S=65535&D,!((T=D>>>24)<=m);){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(A&&0==(240&A)){for(O=T,R=A,N=S;A=(D=n.lencode[N+((g&(1<<O+R)-1)>>O)])>>>16&255,S=65535&D,!(O+(T=D>>>24)<=m);){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}g>>>=O,m-=O,n.back+=O}if(g>>>=T,m-=T,n.back+=T,n.length=S,0===A){n.mode=26;break}if(32&A){n.back=-1,n.mode=12;break}if(64&A){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&A,n.mode=22;case 22:if(n.extra){for(C=n.extra;m<C;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;A=(D=n.distcode[g&(1<<n.distbits)-1])>>>16&255,S=65535&D,!((T=D>>>24)<=m);){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(0==(240&A)){for(O=T,R=A,N=S;A=(D=n.distcode[N+((g&(1<<O+R)-1)>>O)])>>>16&255,S=65535&D,!(O+(T=D>>>24)<=m);){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}g>>>=O,m-=O,n.back+=O}if(g>>>=T,m-=T,n.back+=T,64&A){e.msg="invalid distance code",n.mode=30;break}n.offset=S,n.extra=15&A,n.mode=24;case 24:if(n.extra){for(C=n.extra;m<C;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===p)break e;if(b=y-p,n.offset>b){if((b=n.offset-b)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}b>n.wnext?(b-=n.wnext,I=n.wsize-b):I=n.wnext-b,b>n.length&&(b=n.length),w=n.window}else w=l,I=d-n.offset,b=n.length;b>p&&(b=p),p-=b,n.length-=b;do{l[d++]=w[I++]}while(--b);0===n.length&&(n.mode=21);break;case 26:if(0===p)break e;l[d++]=n.length,p--,n.mode=21;break;case 27:if(n.wrap){for(;m<32;){if(0===f)break e;f--,g|=u[h++]<<m,m+=8}if(y-=p,e.total_out+=y,n.total+=y,y&&(e.adler=n.check=n.flags?a(n.check,l,y,d-y):i(n.check,l,y,d-y)),y=p,(n.flags?g:c(g))!==n.check){e.msg="incorrect data check",n.mode=30;break}g=0,m=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;m<32;){if(0===f)break e;f--,g+=u[h++]<<m,m+=8}if(g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}g=0,m=0}n.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=d,e.avail_out=p,e.next_in=h,e.avail_in=f,n.hold=g,n.bits=m,(n.wsize||y!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,y-e.avail_out)?(n.mode=31,-4):(_-=e.avail_in,y-=e.avail_out,e.total_in+=_,e.total_out+=y,n.total+=y,n.wrap&&y&&(e.adler=n.check=n.flags?a(n.check,l,y,e.next_out-y):i(n.check,l,y,e.next_out-y)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===_&&0===y||4===t)&&0===x&&(x=-5),x)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&i(1,t,r,0)!==n.check?-3:v(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,a,o,s,c,u,l,h,d,f,p,g,m,E,v,_,y,b,I,w,T,A,S;n=e.state,r=e.next_in,A=e.input,i=r+(e.avail_in-5),a=e.next_out,S=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,h=n.wnext,d=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,E=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{p<15&&(f+=A[r++]<<p,p+=8,f+=A[r++]<<p,p+=8),_=g[f&E];t:for(;;){if(f>>>=y=_>>>24,p-=y,0===(y=_>>>16&255))S[a++]=65535&_;else{if(!(16&y)){if(0==(64&y)){_=g[(65535&_)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}b=65535&_,(y&=15)&&(p<y&&(f+=A[r++]<<p,p+=8),b+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=A[r++]<<p,p+=8,f+=A[r++]<<p,p+=8),_=m[f&v];n:for(;;){if(f>>>=y=_>>>24,p-=y,!(16&(y=_>>>16&255))){if(0==(64&y)){_=m[(65535&_)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(I=65535&_,p<(y&=15)&&(f+=A[r++]<<p,(p+=8)<y&&(f+=A[r++]<<p,p+=8)),(I+=f&(1<<y)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,I>(y=a-o)){if((y=I-y)>l&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(w=0,T=d,0===h){if(w+=u-y,y<b){b-=y;do{S[a++]=d[w++]}while(--y);w=a-I,T=S}}else if(h<y){if(w+=u+h-y,(y-=h)<b){b-=y;do{S[a++]=d[w++]}while(--y);if(w=0,h<b){b-=y=h;do{S[a++]=d[w++]}while(--y);w=a-I,T=S}}}else if(w+=h-y,y<b){b-=y;do{S[a++]=d[w++]}while(--y);w=a-I,T=S}for(;b>2;)S[a++]=T[w++],S[a++]=T[w++],S[a++]=T[w++],b-=3;b&&(S[a++]=T[w++],b>1&&(S[a++]=T[w++]))}else{w=a-I;do{S[a++]=S[w++],S[a++]=S[w++],S[a++]=S[w++],b-=3}while(b>2);b&&(S[a++]=S[w++],b>1&&(S[a++]=S[w++]))}break}}break}}while(r<i&&a<s);r-=b=p>>3,f&=(1<<(p-=b<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var r=n(48),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,u,l,h,d){var f,p,g,m,E,v,_,y,b,I=d.bits,w=0,T=0,A=0,S=0,O=0,R=0,N=0,k=0,x=0,B=0,C=null,D=0,L=new r.Buf16(16),U=new r.Buf16(16),P=null,M=0;for(w=0;w<=15;w++)L[w]=0;for(T=0;T<c;T++)L[t[n+T]]++;for(O=I,S=15;S>=1&&0===L[S];S--);if(O>S&&(O=S),0===S)return u[l++]=20971520,u[l++]=20971520,d.bits=1,0;for(A=1;A<S&&0===L[A];A++);for(O<A&&(O=A),k=1,w=1;w<=15;w++)if(k<<=1,(k-=L[w])<0)return-1;if(k>0&&(0===e||1!==S))return-1;for(U[1]=0,w=1;w<15;w++)U[w+1]=U[w]+L[w];for(T=0;T<c;T++)0!==t[n+T]&&(h[U[t[n+T]]++]=T);if(0===e?(C=P=h,v=19):1===e?(C=i,D-=257,P=a,M-=257,v=256):(C=o,P=s,v=-1),B=0,T=0,w=A,E=l,R=O,N=0,g=-1,m=(x=1<<O)-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){_=w-N,h[T]<v?(y=0,b=h[T]):h[T]>v?(y=P[M+h[T]],b=C[D+h[T]]):(y=96,b=0),f=1<<w-N,A=p=1<<R;do{u[E+(B>>N)+(p-=f)]=_<<24|y<<16|b|0}while(0!==p);for(f=1<<w-1;B&f;)f>>=1;if(0!==f?(B&=f-1,B+=f):B=0,T++,0==--L[w]){if(w===S)break;w=t[n+h[T]]}if(w>O&&(B&m)!==g){for(0===N&&(N=O),E+=A,k=1<<(R=w-N);R+N<S&&!((k-=L[R+N])<=0);)R++,k<<=1;if(x+=1<<R,1===e&&x>852||2===e&&x>592)return 1;u[g=B&m]=O<<24|R<<16|E-l|0}}return 0!==B&&(u[E+B]=w-N<<24|64<<16|0),d.bits=O,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(128),i=n(284),a=n(129),o={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function s(e){return"string"!=typeof e?e:("WARN"===(e=e.toUpperCase())&&(e="WARNING"),o[e]?o[e]:e)}var c=function(){function e(){this.defaultLoggerFacade=new d,this.loggers={}}return e.prototype.getLogger=function(e){return e?(this.loggers[e]||(this.loggers[e]=new d({messagePrefix:e})),this.loggers[e]):this.defaultLoggerFacade},e}(),u=function(){function e(e){void 0===e&&(e={}),this.logLevel=a.LogLevel.NOTSET,void 0!==e.logLevel&&i.isValidEnum(a.LogLevel,e.logLevel)&&this.setLogLevel(e.logLevel),this.logToConsole=void 0===e.logToConsole||!!e.logToConsole,this.prefix=void 0!==e.prefix?e.prefix:"[OPTIMIZELY]"}return e.prototype.log=function(e,t){if(this.shouldLog(e)&&this.logToConsole){var n=this.prefix+" - "+this.getLogLevelName(e)+" "+this.getTime()+" "+t;this.consoleLog(e,[n])}},e.prototype.setLogLevel=function(e){e=s(e),i.isValidEnum(a.LogLevel,e)&&void 0!==e?this.logLevel=e:this.logLevel=a.LogLevel.ERROR},e.prototype.getTime=function(){return(new Date).toISOString()},e.prototype.shouldLog=function(e){return e>=this.logLevel},e.prototype.getLogLevelName=function(e){switch(e){case a.LogLevel.DEBUG:return"DEBUG";case a.LogLevel.INFO:return"INFO ";case a.LogLevel.WARNING:return"WARN ";case a.LogLevel.ERROR:return"ERROR";default:return"NOTSET"}},e.prototype.consoleLog=function(e,t){switch(e){case a.LogLevel.DEBUG:case a.LogLevel.INFO:case a.LogLevel.WARNING:case a.LogLevel.ERROR:}},e}();t.ConsoleLogHandler=u;var l=a.LogLevel.NOTSET,h=null,d=function(){function e(e){void 0===e&&(e={}),this.messagePrefix="",e.messagePrefix&&(this.messagePrefix=e.messagePrefix)}return e.prototype.log=function(e,t){this.internalLog(s(e),{message:t,splat:[]})},e.prototype.info=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.namedLog(a.LogLevel.INFO,e,t)},e.prototype.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.namedLog(a.LogLevel.DEBUG,e,t)},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.namedLog(a.LogLevel.WARNING,e,t)},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.namedLog(a.LogLevel.ERROR,e,t)},e.prototype.format=function(e){return(this.messagePrefix?this.messagePrefix+": ":"")+i.sprintf.apply(void 0,[e.message].concat(e.splat))},e.prototype.internalLog=function(e,t){h&&(e<l||(h.log(e,this.format(t)),t.error&&t.error instanceof Error&&r.getErrorHandler().handleError(t.error)))},e.prototype.namedLog=function(e,t,n){var r;if(t instanceof Error)return t=(r=t).message,void this.internalLog(e,{error:r,message:t,splat:n});if(0!==n.length){var i=n[n.length-1];i instanceof Error&&(r=i,n.splice(-1)),this.internalLog(e,{message:t,error:r,splat:n})}else this.internalLog(e,{message:t,splat:n})},e}(),f=new c;t.getLogger=function(e){return f.getLogger(e)},t.setLogHandler=function(e){h=e},t.setLogLevel=function(e){e=s(e),l=i.isValidEnum(a.LogLevel,e)&&void 0!==e?e:a.LogLevel.ERROR},t.getLogLevel=function(){return l},t.resetLogger=function(){f=new c,l=a.LogLevel.NOTSET}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(130);function i(e){return Object.keys(e).map((function(t){return e[t]}))}t.getTimestamp=function(){return(new Date).getTime()},t.generateUUID=function(){return r.v4()},t.isValidEnum=function(e,t){for(var n=!1,r=Object.keys(e),i=0;i<r.length;i++)if(t===e[r[i]]){n=!0;break}return n},t.groupBy=function(e,t){var n={};return e.forEach((function(e){var r=t(e);n[r]=n[r]||[],n[r].push(e)})),i(n)},t.objectValues=i,t.find=function(e,t){for(var n,r=0,i=e;r<i.length;r++){var a=i[r];if(t(a)){n=a;break}}return n},t.keyBy=function(e,t){var n={};return e.forEach((function(e){var r=t(e);n[r]=e})),n},t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=0;return e.replace(/%s/g,(function(){var e=t[r++],n=typeof e;return"function"===n?e():"string"===n?e:String(e)}))}},function(e,t,n){var r,i,a=n(126),o=n(127),s=0,c=0;e.exports=function(e,t,n){var u=t&&n||0,l=t||[],h=(e=e||{}).node||r,d=void 0!==e.clockseq?e.clockseq:i;if(null==h||null==d){var f=a();null==h&&(h=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=i=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:c+1,m=p-s+(g-c)/1e4;if(m<0&&void 0===e.clockseq&&(d=d+1&16383),(m<0||p>s)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=p,c=g,i=d;var E=(1e4*(268435455&(p+=122192928e5))+g)%4294967296;l[u++]=E>>>24&255,l[u++]=E>>>16&255,l[u++]=E>>>8&255,l[u++]=255&E;var v=p/4294967296*1e4&268435455;l[u++]=v>>>8&255,l[u++]=255&v,l[u++]=v>>>24&15|16,l[u++]=v>>>16&255,l[u++]=d>>>8|128,l[u++]=255&d;for(var _=0;_<6;++_)l[u+_]=h[_];return t||o(l)}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(131),t),i(n(132),t),i(n(288),t),i(n(289),t),i(n(290),t),i(n(133),t),i(n(292),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultEventQueue=t.SingleEventQueue=void 0;var r=n(49).getLogger("EventProcessor"),i=function(){function e(e){var t=e.timeout,n=e.callback;this.timeout=Math.max(t,0),this.callback=n}return e.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},e.prototype.refresh=function(){this.stop(),this.start()},e.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},e}(),a=function(){function e(e){var t=e.sink;this.sink=t}return e.prototype.start=function(){},e.prototype.stop=function(){return Promise.resolve()},e.prototype.enqueue=function(e){this.sink([e])},e}();t.SingleEventQueue=a;var o=function(){function e(e){var t=e.flushInterval,n=e.maxQueueSize,r=e.sink,a=e.batchComparator;this.buffer=[],this.maxQueueSize=Math.max(n,1),this.sink=r,this.batchComparator=a,this.timer=new i({callback:this.flush.bind(this),timeout:t}),this.started=!1}return e.prototype.start=function(){this.started=!0},e.prototype.stop=function(){this.started=!1;var e=this.sink(this.buffer);return this.buffer=[],this.timer.stop(),e},e.prototype.enqueue=function(e){if(this.started){var t=this.buffer[0];t&&!this.batchComparator(t,e)&&this.flush(),0===this.buffer.length&&this.timer.refresh(),this.buffer.push(e),this.buffer.length>=this.maxQueueSize&&this.flush()}else r.warn("Queue is stopped, not accepting event")},e.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},e}();t.DefaultEventQueue=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStoragePendingEventsDispatcher=t.PendingEventsDispatcher=void 0;var a=n(49),o=n(291),s=n(66),c=a.getLogger("EventProcessor"),u=function(){function e(e){var t=e.eventDispatcher,n=e.store;this.dispatcher=t,this.store=n}return e.prototype.dispatchEvent=function(e,t){this.send({uuid:s.generateUUID(),timestamp:s.getTimestamp(),request:e},t)},e.prototype.sendPendingEvents=function(){var e=this,t=this.store.values();c.debug("Sending %s pending events from previous page",t.length),t.forEach((function(t){try{e.send(t,(function(){}))}catch(e){}}))},e.prototype.send=function(e,t){var n=this;this.store.set(e.uuid,e),this.dispatcher.dispatchEvent(e.request,(function(r){n.store.remove(e.uuid),t(r)}))},e}();t.PendingEventsDispatcher=u;var l=function(e){function t(t){var n=t.eventDispatcher;return e.call(this,{eventDispatcher:n,store:new o.LocalStorageStore({maxValues:100,key:"fs_optly_pending_events"})})||this}return i(t,e),t}(u);t.LocalStoragePendingEventsDispatcher=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageStore=void 0;var r=n(66),i=n(49).getLogger("EventProcessor"),a=function(){function e(e){var t=e.key,n=e.maxValues,r=void 0===n?1e3:n;this.LS_KEY=t,this.maxValues=r}return e.prototype.get=function(e){return this.getMap()[e]||null},e.prototype.set=function(e,t){var n=this.getMap();n[e]=t,this.replace(n)},e.prototype.remove=function(e){var t=this.getMap();delete t[e],this.replace(t)},e.prototype.values=function(){return r.objectValues(this.getMap())},e.prototype.clear=function(){this.replace({})},e.prototype.replace=function(e){try{window.localStorage&&localStorage.setItem(this.LS_KEY,JSON.stringify(e)),this.clean()}catch(e){i.error(e)}},e.prototype.clean=function(){var e=this.getMap(),t=Object.keys(e),n=t.length-this.maxValues;if(!(n<1)){var r=t.map((function(t){return{key:t,value:e[t]}}));r.sort((function(e,t){return e.value.timestamp-t.value.timestamp}));for(var i=0;i<n;i++)delete e[r[i].key];this.replace(e)}},e.prototype.getMap=function(){try{var e=window.localStorage&&localStorage.getItem(this.LS_KEY);if(e)return JSON.parse(e)||{}}catch(e){i.error(e)}return{}},e}();t.LocalStorageStore=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LogTierV1EventProcessor=void 0;var o=n(49),s=n(132),c=a(n(293)),u=n(131),l=n(133),h=o.getLogger("LogTierV1EventProcessor"),d=function(){function e(e){var t=e.dispatcher,n=e.flushInterval,r=void 0===n?s.DEFAULT_FLUSH_INTERVAL:n,i=e.batchSize,a=void 0===i?s.DEFAULT_BATCH_SIZE:i,o=e.notificationCenter;this.dispatcher=t,this.notificationCenter=o,this.requestTracker=new c.default,r=s.validateAndGetFlushInterval(r),a=s.validateAndGetBatchSize(a),this.queue=s.getQueue(a,r,this.drainQueue.bind(this),u.areEventContextsEqual)}return e.prototype.drainQueue=function(e){var t=this,n=new Promise((function(n){if(h.debug("draining queue with %s events",e.length),0!==e.length){var r=l.formatEvents(e);t.dispatcher.dispatchEvent(r,(function(){n()})),s.sendEventNotification(t.notificationCenter,r)}else n()}));return this.requestTracker.trackRequest(n),n},e.prototype.process=function(e){this.queue.enqueue(e)},e.prototype.stop=function(){try{return this.queue.stop(),this.requestTracker.onRequestsComplete()}catch(e){h.error('Error stopping EventProcessor: "%s"',e.message,e)}return Promise.resolve()},e.prototype.start=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return this.queue.start(),[2]}))}))},e}();t.LogTierV1EventProcessor=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.reqsInFlightCount=0,this.reqsCompleteResolvers=[]}return e.prototype.trackRequest=function(e){var t=this;this.reqsInFlightCount++;var n=function(){t.reqsInFlightCount--,0===t.reqsInFlightCount&&(t.reqsCompleteResolvers.forEach((function(e){return e()})),t.reqsCompleteResolvers=[])};e.then(n,n)},e.prototype.onRequestsComplete=function(){var e=this;return new Promise((function(t){0===e.reqsInFlightCount?t():e.reqsCompleteResolvers.push(t)}))},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(295);t.HttpPollingDatafileManager=r.default},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(296),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.makeGetRequest=function(e,t){return o.makeGetRequest(e,t)},t.prototype.getConfigDefaults=function(){return{autoUpdate:!1}},t}(a(n(297)).default);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(105),i=n(49).getLogger("DatafileManager");t.makeGetRequest=function(e,t){var n=new XMLHttpRequest;return{responsePromise:new Promise((function(a,o){n.open("GET",e,!0),function(e,t){Object.keys(e).forEach((function(n){var r=e[n];t.setRequestHeader(n,r)}))}(t,n),n.onreadystatechange=function(){if(4===n.readyState){if(0===n.status)return void o(new Error("Request error"));var e=function(e){var t=e.getAllResponseHeaders();if(null===t)return{};var n=t.split("\r\n"),r={};return n.forEach((function(e){var t=e.indexOf(": ");if(t>-1){var n=e.slice(0,t),i=e.slice(t+2);i.length>0&&(r[n]=i)}})),r}(n),t={statusCode:n.status,body:n.responseText,headers:e};a(t)}},n.timeout=r.REQUEST_TIMEOUT_MS,n.ontimeout=function(){i.error("Request timed out")},n.send()})),abort:function(){n.abort()}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(49),o=n(66),s=i(n(298)),c=n(105),u=i(n(299)),l=a.getLogger("DatafileManager");function h(e){return e>=200&&e<400}var d={get:function(){return Promise.resolve("")},set:function(){return Promise.resolve()},contains:function(){return Promise.resolve(!1)},remove:function(){return Promise.resolve()}},f=function(){function e(e){var t=this,n=r({},this.getConfigDefaults(),e),i=n.datafile,a=n.autoUpdate,h=void 0!==a&&a,f=n.sdkKey,p=n.updateInterval,g=void 0===p?c.DEFAULT_UPDATE_INTERVAL:p,m=n.urlTemplate,E=void 0===m?c.DEFAULT_URL_TEMPLATE:m,v=n.cache,_=void 0===v?d:v;this.cache=_,this.cacheKey="opt-datafile-"+f,this.isReadyPromiseSettled=!1,this.readyPromiseResolver=function(){},this.readyPromiseRejecter=function(){},this.readyPromise=new Promise((function(e,n){t.readyPromiseResolver=e,t.readyPromiseRejecter=n})),i?(this.currentDatafile=i,f||this.resolveReadyPromise()):this.currentDatafile="",this.isStarted=!1,this.datafileUrl=o.sprintf(E,f),this.emitter=new s.default,this.autoUpdate=h,!function(e){return e>=c.MIN_UPDATE_INTERVAL}(g)?(l.warn("Invalid updateInterval %s, defaulting to %s",g,c.DEFAULT_UPDATE_INTERVAL),this.updateInterval=c.DEFAULT_UPDATE_INTERVAL):this.updateInterval=g,this.currentTimeout=null,this.currentRequest=null,this.backoffController=new u.default,this.syncOnCurrentRequestComplete=!1}return e.prototype.get=function(){return this.currentDatafile},e.prototype.start=function(){this.isStarted||(l.debug("Datafile manager started"),this.isStarted=!0,this.backoffController.reset(),this.setDatafileFromCacheIfAvailable(),this.syncDatafile())},e.prototype.stop=function(){return l.debug("Datafile manager stopped"),this.isStarted=!1,this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.emitter.removeAllListeners(),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),Promise.resolve()},e.prototype.onReady=function(){return this.readyPromise},e.prototype.on=function(e,t){return this.emitter.on(e,t)},e.prototype.onRequestRejected=function(e){this.isStarted&&(this.backoffController.countError(),e instanceof Error?l.error("Error fetching datafile: %s",e.message,e):"string"==typeof e?l.error("Error fetching datafile: %s",e):l.error("Error fetching datafile"))},e.prototype.onRequestResolved=function(e){if(this.isStarted){void 0!==e.statusCode&&h(e.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(e.headers);var t=this.getNextDatafileFromResponse(e);if(""!==t)if(l.info("Updating datafile from response"),this.currentDatafile=t,this.cache.set(this.cacheKey,t),this.isReadyPromiseSettled){var n={datafile:t};this.emitter.emit("update",n)}else this.resolveReadyPromise()}},e.prototype.onRequestComplete=function(){this.isStarted&&(this.currentRequest=null,this.isReadyPromiseSettled||this.autoUpdate||this.rejectReadyPromise(new Error("Failed to become ready")),this.autoUpdate&&this.syncOnCurrentRequestComplete&&this.syncDatafile(),this.syncOnCurrentRequestComplete=!1)},e.prototype.syncDatafile=function(){var e=this,t={};this.lastResponseLastModified&&(t["if-modified-since"]=this.lastResponseLastModified),l.debug("Making datafile request to url %s with headers: %s",this.datafileUrl,(function(){return JSON.stringify(t)})),this.currentRequest=this.makeGetRequest(this.datafileUrl,t);var n=function(){e.onRequestComplete()};this.currentRequest.responsePromise.then((function(t){e.onRequestResolved(t)}),(function(t){e.onRequestRejected(t)})).then(n,n),this.autoUpdate&&this.scheduleNextUpdate()},e.prototype.resolveReadyPromise=function(){this.readyPromiseResolver(),this.isReadyPromiseSettled=!0},e.prototype.rejectReadyPromise=function(e){this.readyPromiseRejecter(e),this.isReadyPromiseSettled=!0},e.prototype.scheduleNextUpdate=function(){var e=this,t=this.backoffController.getDelay(),n=Math.max(t,this.updateInterval);l.debug("Scheduling sync in %s ms",n),this.currentTimeout=setTimeout((function(){e.currentRequest?e.syncOnCurrentRequestComplete=!0:e.syncDatafile()}),n)},e.prototype.getNextDatafileFromResponse=function(e){return l.debug("Response status code: %s",e.statusCode),void 0===e.statusCode||304===e.statusCode?"":h(e.statusCode)?e.body:""},e.prototype.trySavingLastModified=function(e){var t=e["last-modified"]||e["Last-Modified"];void 0!==t&&(this.lastResponseLastModified=t,l.debug("Saved last modified header value from response: %s",this.lastResponseLastModified))},e.prototype.setDatafileFromCacheIfAvailable=function(){var e=this;this.cache.get(this.cacheKey).then((function(t){e.isStarted&&!e.isReadyPromiseSettled&&""!==t&&(l.debug("Using datafile from cache"),e.currentDatafile=t,e.resolveReadyPromise())}))},e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.listeners={},this.listenerId=1}return e.prototype.on=function(e,t){var n=this;this.listeners[e]||(this.listeners[e]={});var r=String(this.listenerId);return this.listenerId++,this.listeners[e][r]=t,function(){n.listeners[e]&&delete n.listeners[e][r]}},e.prototype.emit=function(e,t){var n=this.listeners[e];n&&Object.keys(n).forEach((function(e){(0,n[e])(t)}))},e.prototype.removeAllListeners=function(){this.listeners={}},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(105);var i=function(){function e(){this.errorCount=0}return e.prototype.getDelay=function(){return 0===this.errorCount?0:1e3*r.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT[Math.min(r.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1,this.errorCount)]+Math.round(1e3*Math.random())},e.prototype.countError=function(){this.errorCount<r.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1&&this.errorCount++},e.prototype.reset=function(){this.errorCount=0},e}();t.default=i},function(e,t,n){!function(){function t(e,t){var n,r,i,a,o,s,c,u;for(n=3&e.length,r=e.length-n,i=t,o=3432918353,s=461845907,u=0;u<r;)c=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,i=27492+(65535&(a=5*(65535&(i=(i^=c=(65535&(c=(c=(65535&c)*o+(((c>>>16)*o&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(c=0,n){case 3:c^=(255&e.charCodeAt(u+2))<<16;case 2:c^=(255&e.charCodeAt(u+1))<<8;case 1:i^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(u)))*o+(((c>>>16)*o&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}var n=t;n.v2=function(e,t){for(var n,r=e.length,i=t^r,a=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:i^=(255&e.charCodeAt(a+2))<<16;case 2:i^=(255&e.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0},n.v3=t,e.exports=n}()},function(e,t){(t=e.exports=function(e){return String(e).replace(t.expr,"")}).expr=/\/+$/},function(e,t,n){(function(t){var r=n(307),i=n(308),a=n(309);e.exports=function(e,t){switch(s(e),t=t||e.type,a(t,"You must pass an event type."),t){case"track":return function(e){a(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),a(e.event,'You must pass an "event".')}(e);case"group":return function(e){a(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),a(e.groupId,'You must pass a "groupId".')}(e);case"identify":case"page":case"screen":return function(e){a(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".')}(e);case"alias":return function(e){a(e.userId,'You must pass a "userId".'),a(e.previousId,'You must pass a "previousId".')}(e);default:a(0,'Invalid event type: "'+t+'"')}};var o={anonymousId:["string","number"],category:"string",context:"object",event:"string",groupId:["string","number"],integrations:"object",name:"string",previousId:["string","number"],timestamp:"date",userId:["string","number"],type:"string"};function s(e){a("object"===r(e),"You must pass a message object.");var n=JSON.stringify(e);for(var s in a(t.byteLength(n,"utf8")<32768,"Your message must be < 32kb."),o){var c=e[s];if(c){var u=o[s];"array"!==r(u)&&(u=[u]);var l="object"===u[0]?"an":"a";a(u.some((function(e){return r(c)===e})),'"'+s+'" must be '+l+" "+i(u,"or")+".")}}}}).call(this,n(303).Buffer)},function(e,t,n){"use strict";(function(e){var r=n(304),i=n(305),a=n(306);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=d(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=s(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return j(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return N(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return A(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function E(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var a,o=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(u(e,a)===u(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===c)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+c>s&&(n=s-c),a=n;a>=0;a--){for(var h=!0,d=0;d<c;d++)if(u(e,a+d)!==u(t,d)){h=!1;break}if(h)return a}return-1}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function y(e,t,n,r){return z(j(t,e.length-n),e,n,r)}function b(e,t,n,r){return z(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function I(e,t,n,r){return b(e,t,n,r)}function w(e,t,n,r){return z(V(t),e,n,r)}function T(e,t,n,r){return z(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function A(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,c,u=e[i],l=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=n)switch(h){case 1:u<128&&(l=u);break;case 2:128==(192&(a=e[i+1]))&&(c=(31&u)<<6|63&a)>127&&(l=c);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(c=(15&u)<<12|(63&a)<<6|63&o)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(c=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(r,i),l=e.slice(t,n),h=0;h<s;++h)if(u[h]!==l[h]){a=u[h],o=l[h];break}return a<o?-1:o<a?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return E(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return E(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return b(this,e,t,n);case"latin1":case"binary":return I(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function R(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function N(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=F(e[a]);return i}function k(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function x(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function B(e,t,n,r,i,a){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function C(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function L(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,r,a){return a||L(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function P(e,t,n,r,a){return a||L(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||x(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||x(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||x(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readInt8=function(e,t){return t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||x(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||x(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||x(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||x(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||x(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||x(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||B(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||B(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):C(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):C(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);B(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);B(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):C(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):C(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return P(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return P(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=c.isBuffer(e)?e:j(new c(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var M=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function V(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(27))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),o=r[0],s=r[1],c=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,s=n-i;o<s;o+=16383)a.push(l(e,o,o+16383>s?s:o+16383));1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return a.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=o.length;s<c;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,c=(1<<s)-1,u=c>>1,l=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-l)-1,f>>=-l,l+=s;l>0;a=256*a+e[t+h],h+=d,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=d,l-=8);if(0===a)a=1-u;else{if(a===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=u}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,c,u=8*a-i-1,l=(1<<u)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(o++,c/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*c-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[n+f]=255&o,f+=p,o/=256,u-=8);e[n+f-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){switch(n.call(e)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===e?"null":void 0===e?"undefined":e!=e?"nan":e&&1===e.nodeType?"element":null!=(t=e)&&(t._isBuffer||t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t))?"buffer":typeof(e=e.valueOf?e.valueOf():Object.prototype.valueOf.apply(e));var t}},function(e,t){e.exports=function(e,t,n){return t=t||"and",n=n||", ",e.length<2?e[0]||"":(t.slice(0,2)===n?2==e.length&&(t=t.slice(1)):t=" "+t,e.slice(0,-1).join(n)+t+" "+e[e.length-1])}},function(e,t,n){"use strict";(function(t){var r=n(310);function i(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function a(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=n(311),s=Object.prototype.hasOwnProperty,c=Array.prototype.slice,u="foo"===function(){}.name;function l(e){return Object.prototype.toString.call(e)}function h(e){return!a(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var d=e.exports=v,f=/\s*function\s+([^\(\s]*)\s*/;function p(e){if(o.isFunction(e)){if(u)return e.name;var t=e.toString().match(f);return t&&t[1]}}function g(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(u||!o.isFunction(e))return o.inspect(e);var t=p(e);return"[Function"+(t?": "+t:"")+"]"}function E(e,t,n,r,i){throw new d.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function v(e,t){e||E(e,!0,t,"==",d.ok)}function _(e,t,n,r){if(e===t)return!0;if(a(e)&&a(t))return 0===i(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(h(e)&&h(t)&&l(e)===l(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(a(e)!==a(t))return!1;var s=(r=r||{actual:[],expected:[]}).actual.indexOf(e);return-1!==s&&s===r.expected.indexOf(t)||(r.actual.push(e),r.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=y(e),a=y(t);if(i&&!a||!i&&a)return!1;if(i)return e=c.call(e),t=c.call(t),_(e,t,n);var s,u,l=w(e),h=w(t);if(l.length!==h.length)return!1;for(l.sort(),h.sort(),u=l.length-1;u>=0;u--)if(l[u]!==h[u])return!1;for(u=l.length-1;u>=0;u--)if(s=l[u],!_(e[s],t[s],n,r))return!1;return!0}(e,t,n,r))}return n?e===t:e==t}function y(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function b(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function I(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&E(i,n,"Missing expected exception"+r);var a="string"==typeof r,s=!e&&i&&!n;if((!e&&o.isError(i)&&a&&b(i,n)||s)&&E(i,n,"Got unwanted exception"+r),e&&i&&n&&!b(i,n)||!e&&i)throw i}d.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return g(m(e.actual),128)+" "+e.operator+" "+g(m(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||E;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=p(t),a=r.indexOf("\n"+i);if(a>=0){var o=r.indexOf("\n",a+1);r=r.substring(o+1)}this.stack=r}}},o.inherits(d.AssertionError,Error),d.fail=E,d.ok=v,d.equal=function(e,t,n){e!=t&&E(e,t,n,"==",d.equal)},d.notEqual=function(e,t,n){e==t&&E(e,t,n,"!=",d.notEqual)},d.deepEqual=function(e,t,n){_(e,t,!1)||E(e,t,n,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(e,t,n){_(e,t,!0)||E(e,t,n,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(e,t,n){_(e,t,!1)&&E(e,t,n,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function e(t,n,r){_(t,n,!0)&&E(t,n,r,"notDeepStrictEqual",e)},d.strictEqual=function(e,t,n){e!==t&&E(e,t,n,"===",d.strictEqual)},d.notStrictEqual=function(e,t,n){e===t&&E(e,t,n,"!==",d.notStrictEqual)},d.throws=function(e,t,n){I(!0,e,t,n)},d.doesNotThrow=function(e,t,n){I(!1,e,t,n)},d.ifError=function(e){if(e)throw e},d.strict=r((function e(t,n){t||E(t,!0,n,"==",e)}),d,{equal:d.strictEqual,deepEqual:d.deepStrictEqual,notEqual:d.notStrictEqual,notDeepEqual:d.notDeepStrictEqual}),d.strict.strict=d.strict;var w=Object.keys||function(e){var t=[];for(var n in e)s.call(e,n)&&t.push(n);return t}}).call(this,n(27))},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,c=o(e),u=1;u<arguments.length;u++){for(var l in n=Object(arguments[u]))i.call(n,l)&&(c[l]=n[l]);if(r){s=r(n);for(var h=0;h<s.length;h++)a.call(n,s[h])&&(c[s[h]]=n[s[h]])}}return c}},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!E(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),c=r[n];n<a;c=r[++n])g(c)||!y(c)?o+=" "+c:o+=" "+s(c);return o},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation,i=!0}return n.apply(this,arguments)}};var a,o={};function s(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),l(r,e,r.depth)}function c(e,t){var n=s.styles[t];return n?"\x1b["+s.colors[n][0]+"m"+e+"\x1b["+s.colors[n][1]+"m":e}function u(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return E(i)||(i=l(e,i,r)),i}var a=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(E(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(m(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),I(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(n);if(0===o.length){if(w(n)){var c=n.name?": "+n.name:"";return e.stylize("[Function"+c+"]","special")}if(_(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return e.stylize(Date.prototype.toString.call(n),"date");if(I(n))return h(n)}var u,y="",T=!1,S=["{","}"];(f(n)&&(T=!0,S=["[","]"]),w(n))&&(y=" [Function"+(n.name?": "+n.name:"")+"]");return _(n)&&(y=" "+RegExp.prototype.toString.call(n)),b(n)&&(y=" "+Date.prototype.toUTCString.call(n)),I(n)&&(y=" "+h(n)),0!==o.length||T&&0!=n.length?r<0?_(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),u=T?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)A(t,String(o))?a.push(d(e,t,n,r,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(d(e,t,n,r,i,!0))})),a}(e,n,r,s,o):o.map((function(t){return d(e,n,r,s,t,T)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,y,S)):S[0]+y+S[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i,a){var o,s,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),A(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(c.value)<0?(s=g(n)?l(e,c.value,null):l(e,c.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),v(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function E(e){return"string"==typeof e}function v(e){return void 0===e}function _(e){return y(e)&&"[object RegExp]"===T(e)}function y(e){return"object"==typeof e&&null!==e}function b(e){return y(e)&&"[object Date]"===T(e)}function I(e){return y(e)&&("[object Error]"===T(e)||e instanceof Error)}function w(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}t.debuglog=function(n){if(v(a)&&(a=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!o[n])if(new RegExp("\\b"+n+"\\b","i").test(a)){e.pid;o[n]=function(){t.format.apply(t,arguments)}}else o[n]=function(){};return o[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=E,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=v,t.isRegExp=_,t.isObject=y,t.isDate=b,t.isError=I,t.isFunction=w,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(312);function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){},t.inherits=n(313),t._extend=function(e,t){if(!t||!y(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var S="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function O(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(S&&e[S]){var t;if("function"!=typeof(t=e[S]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,S,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),S&&Object.defineProperty(t,S,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=S,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return i.apply(a,arguments)};t.apply(this,n).then((function(t){e.nextTick(o,null,t)}),(function(t){e.nextTick(O,t,o)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(64))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){var n=1e3,r=6e4,i=60*r,a=24*i;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*a;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=a)return o(e,t,a,"day");if(t>=i)return o(e,t,i,"hour");if(t>=r)return o(e,t,r,"minute");if(t>=n)return o(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=a)return Math.round(e/a)+"d";if(t>=i)return Math.round(e/i)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){var r,i,a,o,s;r=n(316),i=n(134).utf8,a=n(317),o=n(134).bin,(s=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?o.stringToBytes(e):i.stringToBytes(e):a(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var n=r.bytesToWords(e),c=8*e.length,u=1732584193,l=-271733879,h=-1732584194,d=271733878,f=0;f<n.length;f++)n[f]=16711935&(n[f]<<8|n[f]>>>24)|4278255360&(n[f]<<24|n[f]>>>8);n[c>>>5]|=128<<c%32,n[14+(c+64>>>9<<4)]=c;var p=s._ff,g=s._gg,m=s._hh,E=s._ii;for(f=0;f<n.length;f+=16){var v=u,_=l,y=h,b=d;u=p(u,l,h,d,n[f+0],7,-680876936),d=p(d,u,l,h,n[f+1],12,-389564586),h=p(h,d,u,l,n[f+2],17,606105819),l=p(l,h,d,u,n[f+3],22,-1044525330),u=p(u,l,h,d,n[f+4],7,-176418897),d=p(d,u,l,h,n[f+5],12,1200080426),h=p(h,d,u,l,n[f+6],17,-1473231341),l=p(l,h,d,u,n[f+7],22,-45705983),u=p(u,l,h,d,n[f+8],7,1770035416),d=p(d,u,l,h,n[f+9],12,-1958414417),h=p(h,d,u,l,n[f+10],17,-42063),l=p(l,h,d,u,n[f+11],22,-1990404162),u=p(u,l,h,d,n[f+12],7,1804603682),d=p(d,u,l,h,n[f+13],12,-40341101),h=p(h,d,u,l,n[f+14],17,-1502002290),u=g(u,l=p(l,h,d,u,n[f+15],22,1236535329),h,d,n[f+1],5,-165796510),d=g(d,u,l,h,n[f+6],9,-1069501632),h=g(h,d,u,l,n[f+11],14,643717713),l=g(l,h,d,u,n[f+0],20,-373897302),u=g(u,l,h,d,n[f+5],5,-701558691),d=g(d,u,l,h,n[f+10],9,38016083),h=g(h,d,u,l,n[f+15],14,-660478335),l=g(l,h,d,u,n[f+4],20,-405537848),u=g(u,l,h,d,n[f+9],5,568446438),d=g(d,u,l,h,n[f+14],9,-1019803690),h=g(h,d,u,l,n[f+3],14,-187363961),l=g(l,h,d,u,n[f+8],20,1163531501),u=g(u,l,h,d,n[f+13],5,-1444681467),d=g(d,u,l,h,n[f+2],9,-51403784),h=g(h,d,u,l,n[f+7],14,1735328473),u=m(u,l=g(l,h,d,u,n[f+12],20,-1926607734),h,d,n[f+5],4,-378558),d=m(d,u,l,h,n[f+8],11,-2022574463),h=m(h,d,u,l,n[f+11],16,1839030562),l=m(l,h,d,u,n[f+14],23,-35309556),u=m(u,l,h,d,n[f+1],4,-1530992060),d=m(d,u,l,h,n[f+4],11,1272893353),h=m(h,d,u,l,n[f+7],16,-155497632),l=m(l,h,d,u,n[f+10],23,-1094730640),u=m(u,l,h,d,n[f+13],4,681279174),d=m(d,u,l,h,n[f+0],11,-358537222),h=m(h,d,u,l,n[f+3],16,-722521979),l=m(l,h,d,u,n[f+6],23,76029189),u=m(u,l,h,d,n[f+9],4,-640364487),d=m(d,u,l,h,n[f+12],11,-421815835),h=m(h,d,u,l,n[f+15],16,530742520),u=E(u,l=m(l,h,d,u,n[f+2],23,-995338651),h,d,n[f+0],6,-198630844),d=E(d,u,l,h,n[f+7],10,1126891415),h=E(h,d,u,l,n[f+14],15,-1416354905),l=E(l,h,d,u,n[f+5],21,-57434055),u=E(u,l,h,d,n[f+12],6,1700485571),d=E(d,u,l,h,n[f+3],10,-1894986606),h=E(h,d,u,l,n[f+10],15,-1051523),l=E(l,h,d,u,n[f+1],21,-2054922799),u=E(u,l,h,d,n[f+8],6,1873313359),d=E(d,u,l,h,n[f+15],10,-30611744),h=E(h,d,u,l,n[f+6],15,-1560198380),l=E(l,h,d,u,n[f+13],21,1309151649),u=E(u,l,h,d,n[f+4],6,-145523070),d=E(d,u,l,h,n[f+11],10,-1120210379),h=E(h,d,u,l,n[f+2],15,718787259),l=E(l,h,d,u,n[f+9],21,-343485551),u=u+v>>>0,l=l+_>>>0,h=h+y>>>0,d=d+b>>>0}return r.endian([u,l,h,d])})._ff=function(e,t,n,r,i,a,o){var s=e+(t&n|~t&r)+(i>>>0)+o;return(s<<a|s>>>32-a)+t},s._gg=function(e,t,n,r,i,a,o){var s=e+(t&r|n&~r)+(i>>>0)+o;return(s<<a|s>>>32-a)+t},s._hh=function(e,t,n,r,i,a,o){var s=e+(t^n^r)+(i>>>0)+o;return(s<<a|s>>>32-a)+t},s._ii=function(e,t,n,r,i,a,o){var s=e+(n^(t|~r))+(i>>>0)+o;return(s<<a|s>>>32-a)+t},s._blocksize=16,s._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var n=r.wordsToBytes(s(e,t));return t&&t.asBytes?n:t&&t.asString?o.bytesToString(n):r.bytesToHex(n)}},function(e,t){var n,r;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var t=[],r=0;r<e.length;r+=3)for(var i=e[r]<<16|e[r+1]<<8|e[r+2],a=0;a<4;a++)8*r+6*a<=8*e.length?t.push(n.charAt(i>>>6*(3-a)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],r=0,i=0;r<e.length;i=++r%4)0!=i&&t.push((n.indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<2*i|n.indexOf(e.charAt(r))>>>6-2*i);return t}},e.exports=r},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t){var n=Object.prototype.toString,r=Array.isArray;e.exports=function(e){return"string"==typeof e||!r(e)&&function(e){return!!e&&"object"==typeof e}(e)&&"[object String]"==n.call(e)}},function(e,t,n){"use strict";var r=n(0),i=n(1),a=n.n(i),o=n(5),s=n.n(o),c=n(2);let u=n(9).e.extend({key:"yelp.locations",initialize(){c.a.extension.attachEvent("LocationsCollection",(e,t)=>{this.search(e.data.query,e.data.source).then(e=>t(e.toJSON()),()=>{})}),this.fetch()},search(e){return new Promise((t,n)=>{e?e.id?(t(this.add(e)),this.save()):this.get(e)?t(this.get(e)):a.a.ajax({url:"https://maps.google.com/maps/api/geocode/json",data:{address:e},success:n=>{n&&n.results&&n.results.length&&(t(this.add(r.default.extend({id:e},n.results[0].geometry.location))),this.save())}}):n()})}});new(s.a.Collection.extend({url:"https://api.groupon.com/v2/deals/search",initialize(){this.locations=new u,c.a.extension.attachEvent("GrouponDealsCollection",(e,t)=>{e.data.query&&this.search(e.data).then(()=>{t(this.toJSON())})})},search(e){return this.locations.search(e.location,e.source).then(t=>this.fetch({data:{limit:e.limit||100,show:"id,dealUrl,announcementTitle,title,options,merchant,grid4ImageUrl",other_deals:!0,locale:"en_US",offset:0,metadata:!1,client_id:"0c9926ce2479a25adec0c9b3c1e6327c73946fe7",tsToken:"US_AFF_0_200014_200067_0",secure_assets:!1,query:e.query,lng:t.get("lng"),lat:t.get("lat")}}))},parse(e){let t=Object(r.default)(e.deals).filter(e=>e.title.indexOf("Cash Back")<0);return r.default.map(t,e=>r.default.extend({locations:r.default.flatten(r.default.map(e.options,e=>r.default.map(e.redemptionLocations,e=>r.default.pick(e,"streetAddress1","city","state","postalCode","phoneNumber"))))},r.default.pick(e,"id","dealUrl","announcementTitle","title","grid4ImageUrl","options"),r.default.pick(e.merchant,"name","websiteUrl")))}}))},function(e,t,n){"use strict";var r=n(2),i=n(24);const a=new Map;function o(e){i.b.track("CAA",e)}function s(e){let t=a.get(e);t&&(clearTimeout(t.timeoutId),a.delete(e),r.a.browser.detachEvent(r.a.browser.TABCLOSED,c))}function c({tabId:e}){let t=a.get(e);t&&(o({coupon_auto_apply_status:"Terminated",...t.event}),s(e))}r.a.extension.attachEvent("log.caa",({data:e,tabId:t})=>{const{action:n,event:i}=e,{coupon_auto_apply_status:u,...l}=i;if(o(i),"start"===n){const e=l.available_coupons?l.available_coupons.split(", ").length:0;if(e>0){const n=setTimeout(()=>function({tabId:e}){let t=a.get(e);t&&(o({coupon_auto_apply_status:"Timeout",...t.event}),s(e))}({tabId:t}),30*e*1e3);a.set(t,{event:l,timeoutId:n}),r.a.browser.attachEvent(r.a.browser.TABCLOSED,c)}}else["success","error","cancel"].includes(n)&&s(t)})}]);